---
title: Transaction Streaming
description: Stream pending and confirmed transactions with Effect.ts
---

# Transaction Streaming

The `TransactionStream` module provides Effect-native transaction streaming for monitoring pending and confirmed transactions on Ethereum.

## Overview

TransactionStreamService wraps voltaire core's TransactionStream with Effect Stream integration, enabling:

- **Pending transactions**: Watch mempool for new transactions
- **Confirmed transactions**: Stream transactions with confirmation requirements
- **Transaction tracking**: Follow a specific transaction through its lifecycle

## TransactionStreamService

The service provides three streaming methods, each returning an Effect Stream:

```typescript
import { Effect, Stream } from 'effect';
import { TransactionStreamService, TransactionStream, HttpTransport } from 'voltaire-effect';

const program = Effect.gen(function* () {
  const txStream = yield* TransactionStreamService;
  
  yield* Stream.runForEach(
    txStream.watchConfirmed({ confirmations: 3 }),
    (event) => Effect.log(`Confirmed: ${event.transaction.hash}`)
  );
}).pipe(
  Effect.provide(TransactionStream),
  Effect.provide(HttpTransport('https://mainnet.infura.io/v3/YOUR_KEY'))
);
```

## Watching Pending Transactions

Stream pending transactions from the mempool with optional filtering:

```typescript
import { Effect, Stream } from 'effect';
import { TransactionStreamService } from 'voltaire-effect';

const watchPending = Effect.gen(function* () {
  const stream = yield* TransactionStreamService;
  
  yield* Stream.runForEach(
    stream.watchPending({ filter: { to: usdcAddress } }),
    (event) => Effect.log(`Pending: ${event.transaction.hash}`)
  );
});
```

## Streaming Confirmed Transactions

Watch for transactions that meet confirmation requirements:

```typescript
import { Effect, Stream } from 'effect';
import { TransactionStreamService } from 'voltaire-effect';

const watchConfirmed = Effect.gen(function* () {
  const stream = yield* TransactionStreamService;
  
  yield* Stream.runForEach(
    stream.watchConfirmed({ 
      filter: { from: myAddress }, 
      confirmations: 3 
    }),
    (event) => Effect.log(`Confirmed: ${event.transaction.hash}`)
  );
});
```

## Tracking a Specific Transaction

Track a transaction through pending, confirmed, and dropped states:

```typescript
import { Effect, Stream } from 'effect';
import { TransactionStreamService } from 'voltaire-effect';

const trackTransaction = (txHash: string) => Effect.gen(function* () {
  const stream = yield* TransactionStreamService;
  
  yield* Stream.runForEach(
    stream.track(txHash, { confirmations: 3 }),
    (event) => {
      if (event.type === 'confirmed') {
        return Effect.log(`Confirmed in block ${event.transaction.blockNumber}`);
      }
      if (event.type === 'dropped') {
        return Effect.log(`Dropped: ${event.reason}`);
      }
      return Effect.log(`Pending...`);
    }
  );
});
```

## Error Handling

Transaction stream operations can fail with `TransactionStreamError`:

```typescript
import { Effect, pipe } from 'effect';
import { TransactionStreamService } from 'voltaire-effect';

const program = pipe(
  watchConfirmedTransactions(),
  Effect.catchTag("TransactionStreamError", (error) =>
    Effect.gen(function* () {
      yield* Effect.logError(`Stream failed: ${error.message}`);
      // Access cause for underlying error details
      if (error.cause) {
        yield* Effect.logDebug(`Cause: ${error.cause.message}`);
      }
    })
  )
);
```

### TransactionStreamError

Thrown when any transaction stream operation fails:

```typescript
import { TransactionStreamError } from 'voltaire-effect/transaction';

const error = new TransactionStreamError("Connection lost", {
  cause: new Error("WebSocket disconnected"),
  context: { txHash: "0x..." }
});
// error._tag === "TransactionStreamError"
// error.name === "TransactionStreamError"
```

## Integration with BlockStream

TransactionStream's confirmation tracking internally uses BlockStream for monitoring block confirmations. The confirmed transaction stream waits for the specified number of blocks before emitting events:

```typescript
import { Effect, Stream } from 'effect';
import { TransactionStreamService, TransactionStream, HttpTransport } from 'voltaire-effect';

// Confirmations are tracked via internal BlockStream integration
const program = Effect.gen(function* () {
  const txStream = yield* TransactionStreamService;
  
  // Wait for 12 confirmations (common for high-value transactions)
  yield* Stream.runForEach(
    txStream.watchConfirmed({ confirmations: 12 }),
    (event) => Effect.log(`Safe confirmation: ${event.transaction.hash}`)
  );
}).pipe(
  Effect.provide(TransactionStream),
  Effect.provide(HttpTransport('https://...'))
);
```

## Layer Composition

TransactionStream requires TransportService:

```typescript
import { Layer } from 'effect';
import { TransactionStream, HttpTransport, WebSocketTransport } from 'voltaire-effect';

// HTTP transport
const httpLayer = TransactionStream.pipe(
  Layer.provide(HttpTransport('https://mainnet.infura.io/v3/KEY'))
);

// WebSocket transport (better for real-time pending txs)
const wsLayer = TransactionStream.pipe(
  Layer.provide(WebSocketTransport('wss://mainnet.infura.io/ws/v3/KEY'))
);
```

## See Also

- [TransactionStream Service](/services/transaction-stream) — Service API reference
- [Stream Errors](/stream) — Common stream error types
- [BlockStream Service](/services/block-stream) — Block streaming with reorg detection
- [Send Transactions Example](/examples/send-transactions) — Transaction signing and sending
- [Provider Service](/services/provider) — `waitForTransactionReceipt` for simple confirmation
- [Voltaire Transaction](https://voltaire.tevm.sh/primitives/transaction) — Core transaction documentation
