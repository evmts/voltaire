---
title: Transport
description: Effect-based JSON-RPC transport for Ethereum
---

## Quick Start

```typescript
import { TransportService, HttpTransport } from 'voltaire-effect/services'
import { Effect } from 'effect'

const program = Effect.gen(function* () {
  const transport = yield* TransportService
  const blockNumber = yield* transport.request<string>('eth_blockNumber', [])
  return BigInt(blockNumber)
}).pipe(
  Effect.provide(HttpTransport('https://eth.llamarpc.com'))
)
```

## HttpTransport

```typescript
// Simple
HttpTransport('https://eth.example.com')

// With options
HttpTransport({
  url: 'https://eth.example.com',
  headers: { 'X-Api-Key': 'secret' },
  timeout: 60000,      // default: 30000ms
  retries: 5,          // default: 3
  retryDelay: 1000     // default: 1000ms
})
```

## WebSocketTransport

```typescript
import { WebSocketTransport } from 'voltaire-effect/services'

program.pipe(
  Effect.provide(WebSocketTransport('wss://eth.example.com'))
)
```

## BrowserTransport

Uses `window.ethereum` (EIP-1193).

```typescript
import { BrowserTransport } from 'voltaire-effect/services'

const program = Effect.gen(function* () {
  const transport = yield* TransportService
  const accounts = yield* transport.request<string[]>('eth_accounts', [])
  return accounts[0]
}).pipe(
  Effect.provide(BrowserTransport)
)
```

## Testing

```typescript
import { TestTransport, TransportError } from 'voltaire-effect/services'

const mockResponses = new Map([
  ['eth_blockNumber', '0x1234'],
  ['eth_chainId', '0x1'],
])

program.pipe(Effect.provide(TestTransport(mockResponses)))

// Mock errors
const errorResponses = new Map([
  ['eth_call', new TransportError({ code: -32000, message: 'execution reverted' })],
])
```

## Error Handling

```typescript
import { TransportError } from 'voltaire-effect/services'

program.pipe(
  Effect.catchTag("TransportError", (e) => 
    Effect.succeed(`Error ${e.code}: ${e.message}`)
  )
)
```

Error codes: `-32700` parse, `-32600` invalid request, `-32601` method not found, `-32602` invalid params, `-32603` internal, `-32000` to `-32099` server errors.

## Service Interface

```typescript
class TransportService extends Context.Tag("TransportService")<
  TransportService,
  {
    readonly request: <T>(method: string, params?: unknown[]) => Effect.Effect<T, TransportError>
  }
>() {}

class TransportError extends Error {
  readonly _tag = "TransportError"
  readonly code: number
  readonly message: string
  readonly data?: unknown
}
```
