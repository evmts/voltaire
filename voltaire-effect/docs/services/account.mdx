---
title: Account Service
description: Cryptographic signing operations with Effect.ts
---

## Quick Start

```typescript
import { Effect } from 'effect'
import { AccountService, LocalAccount } from 'voltaire-effect/services'
import { Secp256k1Live, KeccakLive } from 'voltaire-effect/crypto'
import { Hex } from '@tevm/voltaire'

const privateKey = Hex.fromHex('0xac0974bec...')

const program = Effect.gen(function* () {
  const account = yield* AccountService
  const signature = yield* account.signMessage(Hex.fromString('Hello!'))
  return signature
}).pipe(
  Effect.provide(LocalAccount(privateKey)),
  Effect.provide(Secp256k1Live),
  Effect.provide(KeccakLive)
)
```

## Browser Wallet

```typescript
import { JsonRpcAccount, BrowserTransport } from 'voltaire-effect/services'

const program = Effect.gen(function* () {
  const account = yield* AccountService
  const signature = yield* account.signMessage(messageHex) // triggers popup
  return signature
}).pipe(
  Effect.provide(JsonRpcAccount(userAddress)),
  Effect.provide(BrowserTransport)
)
```

## Methods

**signMessage** — EIP-191 personal_sign
```typescript
const signature = yield* account.signMessage(Hex.fromString('Hello!'))
```

**signTransaction** — Sign unsigned tx (all fields required)
```typescript
const signature = yield* account.signTransaction({
  to: recipientAddress,
  value: 1000000000000000000n,
  nonce: 5n,
  gasLimit: 21000n,
  gasPrice: 20000000000n,
  chainId: 1n
})
```

**signTypedData** — EIP-712 structured data
```typescript
const signature = yield* account.signTypedData({
  domain: { name: 'App', version: '1', chainId: 1n, verifyingContract },
  primaryType: 'Mail',
  types: { Mail: [{ name: 'to', type: 'address' }, { name: 'contents', type: 'string' }] },
  message: { to: recipient, contents: 'Hello!' }
})
```

### Nested Types

EIP-712 supports nested struct types and arrays:

```typescript
const typedData = {
  domain: { name: 'MyApp', version: '1', chainId: 1n },
  types: {
    Person: [
      { name: 'name', type: 'string' },
      { name: 'wallet', type: 'address' }
    ],
    Mail: [
      { name: 'from', type: 'Person' },
      { name: 'to', type: 'Person' },
      { name: 'contents', type: 'string' }
    ]
  },
  primaryType: 'Mail',
  message: {
    from: { name: 'Alice', wallet: '0xCD2a3d9F938E13CD947Ec05AbC7FE734Df8DD826' },
    to: { name: 'Bob', wallet: '0xbBbBBBBbbBBBbbbBbbBbbbbBBbBbbbbBbBbbBBbB' },
    contents: 'Hello, Bob!'
  }
}
const signature = yield* account.signTypedData(typedData)
```

### Array Types

Arrays of primitives and structs are supported:

```typescript
const typedData = {
  domain: { name: 'Batch', version: '1', chainId: 1n },
  types: {
    Person: [
      { name: 'name', type: 'string' },
      { name: 'wallet', type: 'address' }
    ],
    BatchTransfer: [
      { name: 'recipients', type: 'Person[]' },
      { name: 'amounts', type: 'uint256[]' }
    ]
  },
  primaryType: 'BatchTransfer',
  message: {
    recipients: [
      { name: 'Alice', wallet: '0xCD2a3d9F938E13CD947Ec05AbC7FE734Df8DD826' },
      { name: 'Bob', wallet: '0xbBbBBBBbbBBBbbbBbbBbbbbBBbBbbbbBbBbbBBbB' }
    ],
    amounts: [1000000000000000000n, 2000000000000000000n]
  }
}
```

## HD Wallet / Mnemonic

Create accounts from BIP-39 mnemonics using `MnemonicAccount`:

```typescript
import { MnemonicAccount } from 'voltaire-effect/services'

const mnemonic = "test test test test test test test test test test test junk"

const program = Effect.gen(function* () {
  const account = yield* AccountService
  return account.address
}).pipe(
  Effect.provide(MnemonicAccount(mnemonic)),
  Effect.provide(Secp256k1Live),
  Effect.provide(KeccakLive)
)
```

See the [HD Wallet Guide](/guides/hd-wallet) for derivation paths, passphrases, and manual usage.

## Error Handling

```typescript
import { AccountError } from 'voltaire-effect/services'

program.pipe(
  Effect.catchTag('AccountError', (e) => Effect.succeed({ error: e.message }))
)
```

## Service Interface

```typescript
type AccountShape = {
  readonly address: AddressType
  readonly type: 'local' | 'json-rpc' | 'hardware'
  readonly signMessage: (message: HexType) => Effect.Effect<SignatureType, AccountError>
  readonly signTransaction: (tx: UnsignedTransaction) => Effect.Effect<SignatureType, AccountError>
  readonly signTypedData: (typedData: TypedDataType) => Effect.Effect<SignatureType, AccountError>
}
```
