---
title: TransactionStream
description: Effect-native transaction streaming and tracking
---

## Quick Start

```typescript
import { TransactionStreamService, TransactionStream, HttpTransport } from 'voltaire-effect/services'
import { Effect, Stream } from 'effect'

const program = Effect.gen(function* () {
  const txStream = yield* TransactionStreamService
  
  yield* Stream.runForEach(
    txStream.watchConfirmed({ confirmations: 3 }),
    (event) => Effect.log(`Confirmed: ${event.transaction.hash}`)
  )
}).pipe(
  Effect.provide(TransactionStream),
  Effect.provide(HttpTransport('https://eth.llamarpc.com'))
)
```

## Watch Pending Transactions

Monitor the mempool for pending transactions:

```typescript
const program = Effect.gen(function* () {
  const txStream = yield* TransactionStreamService
  
  yield* Stream.runForEach(
    txStream.watchPending({ filter: { to: usdcAddress } }),
    (event) => Effect.log(`Pending: ${event.transaction.hash}`)
  )
})
```

## Watch Confirmed Transactions

Watch for transactions that reach a confirmation threshold:

```typescript
const program = Effect.gen(function* () {
  const txStream = yield* TransactionStreamService
  
  yield* Stream.runForEach(
    txStream.watchConfirmed({ 
      filter: { from: myAddress }, 
      confirmations: 3 
    }),
    (event) => Effect.log(`Confirmed in block ${event.transaction.blockNumber}`)
  )
})
```

## Track a Specific Transaction

Track a transaction through its full lifecycle (pending → confirmed/dropped):

```typescript
const program = Effect.gen(function* () {
  const txStream = yield* TransactionStreamService
  
  yield* Stream.runForEach(
    txStream.track(txHash, { confirmations: 3 }),
    (event) => {
      if (event.type === 'confirmed') {
        return Effect.log(`Confirmed in block ${event.transaction.blockNumber}`)
      }
      if (event.type === 'dropped') {
        return Effect.log(`Dropped: ${event.reason}`)
      }
      return Effect.log(`Pending...`)
    }
  )
})
```

## Configuration Options

```typescript
interface WatchPendingOptions {
  filter?: TransactionFilter     // Filter by from/to address
  pollingInterval?: number       // Poll interval ms
}

interface WatchConfirmedOptions {
  filter?: TransactionFilter     // Filter by from/to address
  confirmations?: number         // Required confirmations (default: 1)
  pollingInterval?: number       // Poll interval ms
}

interface TrackOptions {
  confirmations?: number         // Required confirmations (default: 1)
  timeout?: number               // Max time to wait ms
  pollingInterval?: number       // Poll interval ms
}
```

## Error Handling

```typescript
import { TransactionStreamError } from 'voltaire-effect/services'

program.pipe(
  Effect.catchTag("TransactionStreamError", (e) =>
    Effect.log(`Stream error: ${e.message}`)
  )
)
```

## Service Interface

```typescript
class TransactionStreamService extends Context.Tag("TransactionStreamService")<
  TransactionStreamService,
  {
    readonly watchPending: (
      options?: WatchPendingOptions
    ) => Stream.Stream<PendingTransactionEvent, TransactionStreamError>
    
    readonly watchConfirmed: (
      options?: WatchConfirmedOptions
    ) => Stream.Stream<ConfirmedTransactionEvent, TransactionStreamError>
    
    readonly track: (
      txHash: Uint8Array | string,
      options?: TrackOptions
    ) => Stream.Stream<TransactionStreamEvent, TransactionStreamError>
  }
>() {}
```

## Layer Dependencies

```
TransactionStream ─── requires ──→ TransportService
```

```typescript
// Compose layers
const AppLayer = TransactionStream.pipe(
  Layer.provide(HttpTransport('https://eth.llamarpc.com'))
)

// Use with program
Effect.runPromise(program.pipe(Effect.provide(AppLayer)))
```
