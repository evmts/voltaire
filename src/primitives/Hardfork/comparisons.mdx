---
title: "Version Comparison"
---

# Version Comparison

Methods for comparing hardfork versions chronologically.

## Overview

Hardforks have chronological ordering based on deployment. Comparison methods enable version checks for feature gating and compatibility.

```typescript
import { Hardfork, CANCUN, LONDON } from '@tevm/voltaire';

// Standard form
Hardfork.isAtLeast(CANCUN, LONDON);  // true

// Convenience form
CANCUN.isAtLeast(LONDON);  // true
```

## Core Comparison Methods

All comparisons use chronological hardfork ordering internally via array index comparison.

### isAtLeast

Check if current hardfork is at least target version (>=).

**Standard Form:**
```typescript
Hardfork.isAtLeast(current: BrandedHardfork, target: BrandedHardfork): boolean
```

**Convenience Form:**
```typescript
current.isAtLeast(target: BrandedHardfork): boolean
```

**Example:**
```typescript
import { Hardfork, CANCUN, LONDON, SHANGHAI } from '@tevm/voltaire';

Hardfork.isAtLeast(CANCUN, LONDON);    // true (Cancun >= London)
Hardfork.isAtLeast(CANCUN, SHANGHAI);  // true (Cancun >= Shanghai)
Hardfork.isAtLeast(LONDON, CANCUN);    // false (London < Cancun)

// Convenience form
CANCUN.isAtLeast(LONDON);    // true
LONDON.isAtLeast(CANCUN);    // false
```

**Use Case:** Minimum version requirements
```typescript
const fork = Hardfork.fromString(config.hardfork);
if (!Hardfork.isAtLeast(fork, LONDON)) {
  throw new Error("Requires London or later for EIP-1559");
}
```

---

### isBefore

Check if current hardfork is before target version (<).

**Standard Form:**
```typescript
Hardfork.isBefore(current: BrandedHardfork, target: BrandedHardfork): boolean
```

**Convenience Form:**
```typescript
current.isBefore(target: BrandedHardfork): boolean
```

**Example:**
```typescript
import { Hardfork, BERLIN, LONDON } from '@tevm/voltaire';

Hardfork.isBefore(BERLIN, LONDON);  // true
Hardfork.isBefore(LONDON, BERLIN);  // false
Hardfork.isBefore(BERLIN, BERLIN);  // false (not strictly before)

// Convenience form
BERLIN.isBefore(LONDON);  // true
```

**Use Case:** Feature exclusion
```typescript
if (Hardfork.isBefore(fork, LONDON)) {
  // Use legacy transaction format (no EIP-1559)
}
```

---

### isAfter

Check if current hardfork is after target version (>).

**Standard Form:**
```typescript
Hardfork.isAfter(current: BrandedHardfork, target: BrandedHardfork): boolean
```

**Convenience Form:**
```typescript
current.isAfter(target: BrandedHardfork): boolean
```

**Example:**
```typescript
import { Hardfork, CANCUN, SHANGHAI } from '@tevm/voltaire';

Hardfork.isAfter(CANCUN, SHANGHAI);    // true
Hardfork.isAfter(SHANGHAI, CANCUN);    // false
Hardfork.isAfter(CANCUN, CANCUN);      // false (not strictly after)

// Convenience form
CANCUN.isAfter(SHANGHAI);  // true
```

**Use Case:** Checking for newer versions
```typescript
if (Hardfork.isAfter(fork, CANCUN)) {
  console.log("Running post-Cancun hardfork");
}
```

---

### isEqual

Check if two hardforks are equal.

**Standard Form:**
```typescript
Hardfork.isEqual(a: BrandedHardfork, b: BrandedHardfork): boolean
```

**Convenience Form:**
```typescript
a.isEqual(b: BrandedHardfork): boolean
```

**Example:**
```typescript
import { Hardfork, MERGE, fromString } from '@tevm/voltaire';

Hardfork.isEqual(MERGE, fromString("merge"));  // true
Hardfork.isEqual(MERGE, fromString("paris"));  // true (alias)
Hardfork.isEqual(MERGE, fromString("london")); // false

// Convenience form
MERGE.isEqual(fromString("paris"));  // true
```

**Use Case:** Alias handling
```typescript
const fork1 = Hardfork.fromString("merge");
const fork2 = Hardfork.fromString("paris");
console.log(Hardfork.isEqual(fork1, fork2));  // true (same hardfork)
```

---

### compare

Three-way comparison returning -1, 0, or 1.

**Standard Form:**
```typescript
Hardfork.compare(a: BrandedHardfork, b: BrandedHardfork): -1 | 0 | 1
```

**Convenience Form:**
```typescript
a.compare(b: BrandedHardfork): -1 | 0 | 1
```

**Returns:**
- `-1` if a < b (a is before b chronologically)
- `0` if a === b (same hardfork)
- `1` if a > b (a is after b chronologically)

**Example:**
```typescript
import { Hardfork, BERLIN, LONDON, CANCUN } from '@tevm/voltaire';

Hardfork.compare(BERLIN, LONDON);   // -1 (Berlin < London)
Hardfork.compare(LONDON, LONDON);   // 0 (equal)
Hardfork.compare(CANCUN, LONDON);   // 1 (Cancun > London)

// Convenience form
BERLIN.compare(LONDON);  // -1
```

**Use Case:** Sorting
```typescript
const forks = [CANCUN, BERLIN, SHANGHAI, LONDON];
forks.sort(Hardfork.compare);
// [BERLIN, LONDON, SHANGHAI, CANCUN]
```

---

## Operator-Style Methods

Convenience methods mimicking comparison operators.

### gte (>=)

Greater than or equal.

```typescript
Hardfork.gte(a: BrandedHardfork, b: BrandedHardfork): boolean
a.gte(b: BrandedHardfork): boolean
```

Equivalent to `isAtLeast`.

**Example:**
```typescript
import { CANCUN, LONDON } from '@tevm/voltaire';

CANCUN.gte(LONDON);  // true
LONDON.gte(CANCUN);  // false
```

---

### lte (<=)

Less than or equal.

```typescript
Hardfork.lte(a: BrandedHardfork, b: BrandedHardfork): boolean
a.lte(b: BrandedHardfork): boolean
```

**Example:**
```typescript
import { LONDON, CANCUN } from '@tevm/voltaire';

LONDON.lte(CANCUN);  // true
CANCUN.lte(LONDON);  // false
LONDON.lte(LONDON);  // true
```

---

### gt (>)

Greater than (strictly).

```typescript
Hardfork.gt(a: BrandedHardfork, b: BrandedHardfork): boolean
a.gt(b: BrandedHardfork): boolean
```

Equivalent to `isAfter`.

**Example:**
```typescript
import { CANCUN, LONDON } from '@tevm/voltaire';

CANCUN.gt(LONDON);  // true
LONDON.gt(CANCUN);  // false
CANCUN.gt(CANCUN);  // false
```

---

### lt (<)

Less than (strictly).

```typescript
Hardfork.lt(a: BrandedHardfork, b: BrandedHardfork): boolean
a.lt(b: BrandedHardfork): boolean
```

Equivalent to `isBefore`.

**Example:**
```typescript
import { BERLIN, LONDON } from '@tevm/voltaire';

BERLIN.lt(LONDON);  // true
LONDON.lt(BERLIN);  // false
BERLIN.lt(BERLIN);  // false
```

---

### eq (===)

Equality check.

```typescript
Hardfork.eq(a: BrandedHardfork, b: BrandedHardfork): boolean
a.eq(b: BrandedHardfork): boolean
```

Equivalent to `isEqual`.

**Example:**
```typescript
import { MERGE, fromString } from '@tevm/voltaire';

MERGE.eq(fromString("paris"));  // true (alias)
MERGE.eq(fromString("london")); // false
```

---

## Min/Max Operations

Find minimum or maximum hardfork from array.

### min

Find earliest (minimum) hardfork.

```typescript
Hardfork.min(forks: BrandedHardfork[]): BrandedHardfork
```

**Example:**
```typescript
import { Hardfork, BERLIN, CANCUN, SHANGHAI } from '@tevm/voltaire';

const oldest = Hardfork.min([CANCUN, BERLIN, SHANGHAI]);
console.log(oldest);  // BERLIN
```

**Use Case:** Find minimum supported version
```typescript
const supported = getSupportedHardforks();
const minSupported = Hardfork.min(supported);
console.log(`Minimum version: ${Hardfork.toString(minSupported)}`);
```

---

### max

Find latest (maximum) hardfork.

```typescript
Hardfork.max(forks: BrandedHardfork[]): BrandedHardfork
```

**Example:**
```typescript
import { Hardfork, BERLIN, CANCUN, SHANGHAI } from '@tevm/voltaire';

const latest = Hardfork.max([BERLIN, SHANGHAI, CANCUN]);
console.log(latest);  // CANCUN
```

**Use Case:** Find latest supported version
```typescript
const supported = getSupportedHardforks();
const maxSupported = Hardfork.max(supported);
console.log(`Latest version: ${Hardfork.toString(maxSupported)}`);
```

---

## Implementation Details

### Internal Ordering

Comparisons use array index in chronological order:

```javascript
const HARDFORK_ORDER = [
  FRONTIER,      // 0
  HOMESTEAD,     // 1
  DAO,           // 2
  ...
  CANCUN,        // 16
  PRAGUE,        // 17
  OSAKA,         // 18
];
```

### Comparison Algorithm

```javascript
function isAtLeast(current, target) {
  return HARDFORK_ORDER.indexOf(current) >= HARDFORK_ORDER.indexOf(target);
}
```

### Performance

- **Time Complexity**: O(1) for all operations
- **Implementation**: Simple array index comparison
- **Speed**: ~10-20ns per operation

---

## Common Patterns

### Version Gating

```typescript
function selectOpcode(fork: BrandedHardfork) {
  if (Hardfork.isAtLeast(fork, SHANGHAI)) {
    return 0x5F;  // PUSH0
  } else {
    return 0x60;  // PUSH1 0x00
  }
}
```

### Range Checking

```typescript
function isInRange(fork: BrandedHardfork, min: BrandedHardfork, max: BrandedHardfork) {
  return Hardfork.isAtLeast(fork, min) && !Hardfork.isAfter(fork, max);
}

// Check if fork is between Berlin and Shanghai (inclusive)
isInRange(LONDON, BERLIN, SHANGHAI);  // true
```

### Sorting Hardforks

```typescript
const forks = [CANCUN, BERLIN, SHANGHAI, LONDON, MERGE];

// Sort chronologically
forks.sort(Hardfork.compare);
// [BERLIN, LONDON, MERGE, SHANGHAI, CANCUN]

// Sort reverse chronological
forks.sort((a, b) => -Hardfork.compare(a, b));
// [CANCUN, SHANGHAI, MERGE, LONDON, BERLIN]
```

### Migration Detection

```typescript
function needsMigration(current: BrandedHardfork, target: BrandedHardfork): boolean {
  return Hardfork.isBefore(current, target);
}

if (needsMigration(currentFork, CANCUN)) {
  console.log("Upgrade required to use blob transactions");
}
```

### Compatibility Checks

```typescript
function isCompatible(clientFork: BrandedHardfork, networkFork: BrandedHardfork): boolean {
  // Client must support at least network's hardfork
  return Hardfork.isAtLeast(clientFork, networkFork);
}

const compatible = isCompatible(PRAGUE, CANCUN);  // true
```

---

## Best Practices

### 1. Use Semantic Method Names

```typescript
// Good - clear intent
if (Hardfork.isAtLeast(fork, LONDON)) {
  // EIP-1559 available
}

// Less clear - what does >= mean here?
if (fork >= LONDON) {
  // Not valid TypeScript anyway
}
```

### 2. Combine with Feature Detection

```typescript
// Good - explicit about requirements
if (Hardfork.isAtLeast(fork, LONDON) && Hardfork.hasEIP1559(fork)) {
  // Double check for clarity
}

// Better - feature detection is more explicit
if (Hardfork.hasEIP1559(fork)) {
  // What we actually care about
}
```

### 3. Handle Equality Carefully

```typescript
// Check equality with aliases
const fork1 = Hardfork.fromString("merge");
const fork2 = Hardfork.fromString("paris");

// Good - uses isEqual
if (Hardfork.isEqual(fork1, fork2)) { /* ... */ }

// Bad - string comparison
if (fork1 === fork2) { /* ... */ }  // false (different strings)
```

### 4. Use Convenience Forms for Readability

```typescript
// More readable with instance method
if (currentFork.gte(requiredFork)) {
  // ...
}

// Less readable
if (Hardfork.gte(currentFork, requiredFork)) {
  // ...
}
```

---

## Related

- [features.mdx](./features.mdx) - Feature detection (often better than version checks)
- [utilities.mdx](./utilities.mdx) - Range and collection utilities
- [hardforks.mdx](./hardforks.mdx) - Complete hardfork list
- [index.mdx](./index.mdx) - Main documentation
