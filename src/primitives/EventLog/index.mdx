---
title: EventLog
description: EVM event log representation with filtering and matching utilities
---

import { Tabs, TabItem, Card, CardGrid, Aside, Steps } from '@astrojs/starlight/components';

# EventLog

EVM event log representation with comprehensive filtering, matching, and sorting utilities.

## Overview

EventLog provides a complete API for working with Ethereum event logs emitted by smart contracts. Supports log creation, filtering by topics and addresses, handling chain reorganizations, and sorting logs by block/transaction position.

## Event Log Structure

Event logs have up to 4 indexed topics plus non-indexed data:

```
┌─────────────────────────────────────────────────────────────────┐
│ Event Log Structure                                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  address: 0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e           │
│  (20-byte contract address that emitted the log)                │
│                                                                  │
│  ┌──────────────────────── TOPICS ──────────────────────────┐   │
│  │                                                           │   │
│  │  topic0 (required):  0xddf252ad... (event signature)     │   │
│  │                      keccak256("Transfer(address,address,uint256)") │
│  │                                                           │   │
│  │  topic1 (indexed):   0x000...f39f (from address)         │   │
│  │  topic2 (indexed):   0x000...7099 (to address)           │   │
│  │  topic3 (indexed):   [optional 3rd indexed param]        │   │
│  │                                                           │   │
│  └───────────────────────────────────────────────────────────┘   │
│                                                                  │
│  data: 0x00...03e8 (non-indexed parameters, abi-encoded)        │
│        └─ Contains: amount = 1000 (uint256)                    │
│                                                                  │
│  Position metadata:                                              │
│  ├─ blockNumber: 12345678                                      │
│  ├─ blockHash: 0xabc...                                         │
│  ├─ transactionHash: 0x123...                                   │
│  ├─ transactionIndex: 42                                        │
│  ├─ logIndex: 7                                                 │
│  └─ removed: false (true if chain reorg)                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

<Aside type="tip" title="Topic Encoding">
Indexed parameters are encoded as 32-byte hashes (keccak256 for dynamic types). Address parameters are padded to 32 bytes: `0x000...{20-byte address}`.
</Aside>

## Quick Start

<Tabs>
<TabItem label="Basic Usage">
```typescript
import * as EventLog from '@tevm/primitives/EventLog'
import * as Hash from '@tevm/primitives/Hash'
import * as Address from '@tevm/primitives/Address'

// Create event log
const log = EventLog.create({
  address: Address.from("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
  topics: [
    Hash.from("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
    Hash.from("0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266"),
    Hash.from("0x00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c8")
  ],
  data: new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 232]),
  blockNumber: 12345678n,
  transactionHash: Hash.from("0x1234..."),
  transactionIndex: 42,
  logIndex: 7
})

// Get event signature (topic0)
const signature = EventLog.getTopic0(log)

// Get indexed topics (topic1, topic2, topic3)
const indexed = EventLog.getIndexedTopics(log)
// [Hash("0x000...f39f"), Hash("0x000...7099")]
```
</TabItem>
<TabItem label="Filtering">
```typescript
import * as EventLog from '@tevm/primitives/EventLog'

// Filter array of logs
const filter = {
  address: Address.from("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
  topics: [
    transferSignature,  // topic0: event signature
    fromAddress,        // topic1: indexed from
    null,               // topic2: any value (to address)
  ]
}

const matchingLogs = EventLog.filterLogs(allLogs, filter)

// Check single log against filter
const matches = EventLog.matchesFilter(log, filter)  // boolean

// Match specific criteria
const matchesTopic = EventLog.matchesTopics(log, [transferSignature])
const matchesAddr = EventLog.matchesAddress(log, contractAddress)
```
</TabItem>
<TabItem label="Reorganizations">
```typescript
import * as EventLog from '@tevm/primitives/EventLog'

// Check if log was removed due to reorg
const removed = EventLog.isRemoved(log)      // checks removed flag
const was = EventLog.wasRemoved(log)         // alias

// Logs marked removed=true indicate chain reorg
const reorgLog = EventLog.create({
  address: contractAddress,
  topics: [signature],
  data: eventData,
  removed: true  // This log is no longer valid
})
```
</TabItem>
<TabItem label="Sorting">
```typescript
import * as EventLog from '@tevm/primitives/EventLog'

// Sort logs by block number, transaction index, log index
const unsortedLogs = [log3, log1, log2]
const sorted = EventLog.sortLogs(unsortedLogs)
// Sorted by blockNumber asc, then transactionIndex asc, then logIndex asc

// Alias
const sorted2 = EventLog.sort(unsortedLogs)
```
</TabItem>
</Tabs>

## Topic Calculation & Bloom Filters

### Event Signature (topic0)

To find events, you need the event signature hash:

```typescript
// Solidity event declaration
event Transfer(address indexed from, address indexed to, uint256 value);

// Event signature calculation
const sig = keccak256("Transfer(address,address,uint256)");
// Result: 0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef

// Use in EventLog to filter
const logs = EventLog.filterLogs(allLogs, {
  topics: [sig]  // Match all Transfer events
})
```

<Aside type="note" title="Event Signature Naming">
Use the Solidity signature string exactly as declared: include parameter types (not names), separate with commas, no spaces.
</Aside>

### Bloom Filter Optimization

Ethereum blocks include a log bloom filter for fast event lookup:

```
┌────────────────────────────────────────────────────────┐
│ Block Bloom Filter (2048 bits for event indexing)      │
├────────────────────────────────────────────────────────┤
│                                                         │
│ Contract addresses and topics are hashed into the      │
│ filter using 3 hash functions per value                │
│                                                         │
│  Hash(address, 0) → bit 512                            │
│  Hash(address, 1) → bit 1024                           │
│  Hash(address, 2) → bit 1536                           │
│         ↓                                               │
│  1 = address mentioned in block ✓                      │
│                                                         │
│  Can query: "Any Transfer events from block X?"        │
│  Response: "Probably" (bloom) → fetch logs to confirm  │
│                                                         │
└────────────────────────────────────────────────────────┘
```

This allows light clients to quickly determine if a block *might* contain events matching a filter, reducing RPC calls.

## Type Definition

```typescript
export type BrandedEventLog<
  TAddress extends BrandedAddress = BrandedAddress,
  TTopics extends readonly BrandedHash[] = readonly BrandedHash[],
> = {
  /** Contract address that emitted the log */
  address: TAddress
  /** Event topics (topic0 = event signature, topic1-3 = indexed parameters) */
  topics: TTopics
  /** Event data (non-indexed parameters) */
  data: Uint8Array
  /** Block number where log was emitted */
  blockNumber?: bigint
  /** Transaction hash that generated the log */
  transactionHash?: BrandedHash
  /** Transaction index in block */
  transactionIndex?: number
  /** Block hash */
  blockHash?: BrandedHash
  /** Log index in block */
  logIndex?: number
  /** Log removed due to chain reorganization */
  removed?: boolean
} & { readonly __tag: "EventLog" }
```

Source: [BrandedEventLog.ts:7-29](https://github.com/evmts/voltaire/blob/main/src/primitives/EventLog/BrandedEventLog/BrandedEventLog.ts#L7-L29)

## Filter Type

```typescript
export type Filter<
  TAddress extends BrandedAddress | BrandedAddress[] | undefined =
    | BrandedAddress
    | BrandedAddress[]
    | undefined,
  TTopics extends readonly (BrandedHash | BrandedHash[] | null)[] | undefined =
    | readonly (BrandedHash | BrandedHash[] | null)[]
    | undefined,
> = {
  /** Contract address(es) to filter by */
  address?: TAddress
  /** Topic filters (null entries match any topic, arrays match any of the hashes) */
  topics?: TTopics
  /** Starting block number */
  fromBlock?: bigint
  /** Ending block number */
  toBlock?: bigint
  /** Block hash to filter by (alternative to fromBlock/toBlock) */
  blockHash?: BrandedHash
}
```

Source: [BrandedEventLog.ts:34-53](https://github.com/evmts/voltaire/blob/main/src/primitives/EventLog/BrandedEventLog/BrandedEventLog.ts#L34-L53)

## Core Methods

### create()

Create new EventLog from parameters.

```typescript
const log = EventLog.create({
  address: Address.from("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
  topics: [eventSignature, indexedParam1],
  data: nonIndexedData,
  blockNumber: 12345678n,
  transactionHash: txHash,
  transactionIndex: 42,
  logIndex: 7
})
```

### from()

Flexible constructor accepting various input formats.

```typescript
const log = EventLog.from({
  address: "0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e",
  topics: ["0xddf252ad...", "0x000..."],
  data: eventDataBytes
})
```

### getTopic0()

Extract event signature (first topic).

```typescript
const signature = EventLog.getTopic0(log)
// Hash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef")
```

### getIndexedTopics()

Extract indexed parameters (topics 1-3).

```typescript
const indexed = EventLog.getIndexedTopics(log)
// [Hash("0x000...from"), Hash("0x000...to")]
```

### getSignature()

Alias for getTopic0().

```typescript
const sig = EventLog.getSignature(log)
```

### getIndexed()

Alias for getIndexedTopics().

```typescript
const indexed = EventLog.getIndexed(log)
```

### matchesTopics()

Check if log topics match filter pattern.

```typescript
const matches = EventLog.matchesTopics(log, [
  transferSignature,  // Must match
  fromAddress,        // Must match
  null,               // Any value accepted
])
```

### matchesAddress()

Check if log address matches filter.

```typescript
// Single address
const matches = EventLog.matchesAddress(log, contractAddress)

// Multiple addresses (OR logic)
const matches = EventLog.matchesAddress(log, [addr1, addr2, addr3])
```

### matchesFilter()

Check if log matches complete filter.

```typescript
const filter = {
  address: contractAddress,
  topics: [signature, fromAddr, null],
  fromBlock: 1000000n,
  toBlock: 2000000n
}

const matches = EventLog.matchesFilter(log, filter)
```

### filterLogs()

Filter array of logs by criteria.

```typescript
const matching = EventLog.filterLogs(allLogs, {
  address: tokenContract,
  topics: [transferSignature]
})
```

### sortLogs()

Sort logs by block/transaction/log position.

```typescript
const sorted = EventLog.sortLogs(unsortedLogs)
// Sorted by blockNumber, transactionIndex, logIndex (all ascending)
```

### isRemoved() / wasRemoved()

Check if log was removed due to chain reorganization.

```typescript
if (EventLog.isRemoved(log)) {
  console.log("Log invalidated by reorg")
}
```

### clone()

Create deep copy of log.

```typescript
const copy = EventLog.clone(log)
```

### copy()

Alias for clone().

```typescript
const copy = EventLog.copy(log)
```

## Use Cases

### Parsing Transfer Events

```typescript
import * as EventLog from '@tevm/primitives/EventLog'
import * as Abi from '@tevm/primitives/Abi'

// Transfer event signature: keccak256("Transfer(address,address,uint256)")
const transferSig = Hash.from("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef")

// Filter for all transfers
const transfers = EventLog.filterLogs(allLogs, {
  topics: [transferSig]
})

// Decode each transfer
for (const log of transfers) {
  const [from, to] = EventLog.getIndexedTopics(log)
  const [amount] = Abi.decodeParameters(
    [{ type: "uint256" }],
    log.data
  )
  console.log(`Transfer: ${from} -> ${to}: ${amount}`)
}
```

### Monitoring Specific Contract

```typescript
const contractLogs = EventLog.filterLogs(logs, {
  address: myContract,
  fromBlock: lastProcessedBlock,
  toBlock: currentBlock
})

// Process new logs
for (const log of contractLogs) {
  if (!EventLog.isRemoved(log)) {
    await processLog(log)
  }
}
```

### Topic Filtering with Wildcards

```typescript
// Match any Transfer where 'to' is specific address
const receivedTransfers = EventLog.filterLogs(logs, {
  topics: [
    transferSignature,
    null,              // Any 'from'
    myAddressHash,     // Specific 'to'
  ]
})

// Match any Transfer where 'from' is one of several addresses
const sentTransfers = EventLog.filterLogs(logs, {
  topics: [
    transferSignature,
    [addr1Hash, addr2Hash, addr3Hash],  // OR logic
    null,
  ]
})
```

### Handling Reorganizations

```typescript
// Track valid logs, excluding removed ones
const validLogs = allLogs.filter(log => !EventLog.isRemoved(log))

// When reorg detected, refetch logs for affected blocks
const reorgLogs = await fetchLogs(reorgStartBlock, reorgEndBlock)

// Merge and sort
const allValidLogs = EventLog.sortLogs([
  ...validLogs,
  ...reorgLogs.filter(log => !log.removed)
])
```

## Tree-Shaking

Import only what you need for optimal bundle size:

```typescript
// Import specific methods
import { filterLogs, matchesFilter, getTopic0 } from '@tevm/primitives/EventLog'

// Or import entire namespace
import * as EventLog from '@tevm/primitives/EventLog'

// Selective imports minimize bundle size
const transfers = filterLogs(allLogs, { topics: [transferSig] })
const signature = getTopic0(log)
```

Each function is independently exported, allowing bundlers to eliminate unused filtering, sorting, and comparison utilities when not needed.

## Topic Structure

Ethereum event logs use up to 4 topics:

- **topic0**: Event signature hash (keccak256 of event signature)
- **topic1-3**: Indexed parameters (up to 3)

```solidity
event Transfer(address indexed from, address indexed to, uint256 value);
```

Maps to:
- topic0: keccak256("Transfer(address,address,uint256)")
- topic1: from address (indexed)
- topic2: to address (indexed)
- data: abi.encode(value) (non-indexed)

## Standard Event Signatures

Common ERC standard events and their topic0 hashes:

| Event | Signature | topic0 |
|-------|-----------|--------|
| Transfer (ERC-20/721) | `Transfer(address indexed from, address indexed to, uint256 value/tokenId)` | `0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef` |
| Approval (ERC-20/721) | `Approval(address indexed owner, address indexed spender, uint256 value/tokenId)` | `0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925` |
| ApprovalForAll (ERC-721) | `ApprovalForAll(address indexed owner, address indexed operator, bool approved)` | `0x17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31` |
| TransferSingle (ERC-1155) | `TransferSingle(address indexed operator, address indexed from, address indexed to, uint256 id, uint256 value)` | `0xc3d58168c5ae7397731d063d5bbf3d657706970af1a1347f45eba0eb68571231` |
| TransferBatch (ERC-1155) | `TransferBatch(address indexed operator, address indexed from, address indexed to, uint256[] ids, uint256[] values)` | `0x4a39dc06d4c0dbc64b70af90fd698a233a518aa5d07e595a9738d51b54614b51` |
| Swap (Uniswap V2) | `Swap(address indexed sender, uint amount0In, uint amount1In, uint amount0Out, uint amount1Out, address indexed to)` | `0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822` |

## API Documentation

<CardGrid>
  <Card title="Constructors" icon="rocket">
    Creating EventLog instances from transaction log data.

    [View constructors →](/primitives/eventlog/constructors)
  </Card>

  <Card title="Validation" icon="warning">
    Filter matching, address/topic validation, and reorg detection.

    [View validation →](/primitives/eventlog/validation)
  </Card>

  <Card title="Utilities" icon="puzzle">
    Topic extraction, filtering arrays, sorting, and cloning.

    [View utilities →](/primitives/eventlog/utilities)
  </Card>

  <Card title="Usage Patterns" icon="open-book">
    Real-world examples: ERC-20 transfers, NFTs, Uniswap swaps, indexing.

    [View usage patterns →](/primitives/eventlog/usage-patterns)
  </Card>

  <Card title="Interactive Guide" icon="laptop">
    Step-by-step event indexing setup, log filtering, and integration patterns.

    [View interactive guide →](/primitives/eventlog/interactive-guide)
  </Card>

  <Card title="WASM Implementation" icon="rocket">
    WebAssembly acceleration for high-performance log filtering.

    [View WASM →](/primitives/eventlog/wasm)
  </Card>
</CardGrid>

## Related Types

<CardGrid stagger>
  <Card title="Hash" icon="seti:text">
    32-byte hashes used for topics and transaction hashes.

    [View Hash →](/primitives/hash)
  </Card>

  <Card title="Address" icon="document">
    20-byte addresses for log sources and indexed parameters.

    [View Address →](/primitives/address)
  </Card>

  <Card title="Abi" icon="puzzle">
    ABI encoding/decoding for event data and topics.

    [View Abi →](/primitives/abi)
  </Card>

  <Card title="Transaction" icon="rocket">
    Transactions that generate event logs.

    [View Transaction →](/primitives/transaction)
  </Card>
</CardGrid>

## Specification References

- [JSON-RPC eth_getLogs](https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_getlogs) - Log filtering specification
- [Solidity Events](https://docs.soliditylang.org/en/latest/contracts.html#events) - Event declaration and emission
- [Log Bloom Filters](https://ethereum.org/en/developers/docs/data-structures-and-encoding/patricia-merkle-trie/#log-bloom-filter) - Efficient log filtering in blocks
