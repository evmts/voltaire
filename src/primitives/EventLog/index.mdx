---
title: EventLog
description: EVM event log representation with filtering and matching utilities
---

import { Tabs, TabItem, Card, CardGrid, Aside } from '@astrojs/starlight/components';

# EventLog

EVM event log representation with comprehensive filtering, matching, and sorting utilities.

## Overview

EventLog provides a complete API for working with Ethereum event logs emitted by smart contracts. Supports log creation, filtering by topics and addresses, handling chain reorganizations, and sorting logs by block/transaction position.

## Quick Start

<Tabs>
<TabItem label="Basic Usage">
```typescript
import * as EventLog from '@tevm/primitives/EventLog'
import * as Hash from '@tevm/primitives/Hash'
import * as Address from '@tevm/primitives/Address'

// Create event log
const log = EventLog.create({
  address: Address.from("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
  topics: [
    Hash.from("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"),
    Hash.from("0x000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb92266"),
    Hash.from("0x00000000000000000000000070997970c51812dc3a010c7d01b50e0d17dc79c8")
  ],
  data: new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 232]),
  blockNumber: 12345678n,
  transactionHash: Hash.from("0x1234..."),
  transactionIndex: 42,
  logIndex: 7
})

// Get event signature (topic0)
const signature = EventLog.getTopic0(log)

// Get indexed topics (topic1, topic2, topic3)
const indexed = EventLog.getIndexedTopics(log)
// [Hash("0x000...f39f"), Hash("0x000...7099")]
```
</TabItem>
<TabItem label="Filtering">
```typescript
import * as EventLog from '@tevm/primitives/EventLog'

// Filter array of logs
const filter = {
  address: Address.from("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
  topics: [
    transferSignature,  // topic0: event signature
    fromAddress,        // topic1: indexed from
    null,               // topic2: any value (to address)
  ]
}

const matchingLogs = EventLog.filterLogs(allLogs, filter)

// Check single log against filter
const matches = EventLog.matchesFilter(log, filter)  // boolean

// Match specific criteria
const matchesTopic = EventLog.matchesTopics(log, [transferSignature])
const matchesAddr = EventLog.matchesAddress(log, contractAddress)
```
</TabItem>
<TabItem label="Reorganizations">
```typescript
import * as EventLog from '@tevm/primitives/EventLog'

// Check if log was removed due to reorg
const removed = EventLog.isRemoved(log)      // checks removed flag
const was = EventLog.wasRemoved(log)         // alias

// Logs marked removed=true indicate chain reorg
const reorgLog = EventLog.create({
  address: contractAddress,
  topics: [signature],
  data: eventData,
  removed: true  // This log is no longer valid
})
```
</TabItem>
<TabItem label="Sorting">
```typescript
import * as EventLog from '@tevm/primitives/EventLog'

// Sort logs by block number, transaction index, log index
const unsortedLogs = [log3, log1, log2]
const sorted = EventLog.sortLogs(unsortedLogs)
// Sorted by blockNumber asc, then transactionIndex asc, then logIndex asc

// Alias
const sorted2 = EventLog.sort(unsortedLogs)
```
</TabItem>
</Tabs>

## Type Definition

```typescript
export type BrandedEventLog<
  TAddress extends BrandedAddress = BrandedAddress,
  TTopics extends readonly BrandedHash[] = readonly BrandedHash[],
> = {
  /** Contract address that emitted the log */
  address: TAddress
  /** Event topics (topic0 = event signature, topic1-3 = indexed parameters) */
  topics: TTopics
  /** Event data (non-indexed parameters) */
  data: Uint8Array
  /** Block number where log was emitted */
  blockNumber?: bigint
  /** Transaction hash that generated the log */
  transactionHash?: BrandedHash
  /** Transaction index in block */
  transactionIndex?: number
  /** Block hash */
  blockHash?: BrandedHash
  /** Log index in block */
  logIndex?: number
  /** Log removed due to chain reorganization */
  removed?: boolean
} & { readonly __tag: "EventLog" }
```

Source: [BrandedEventLog.ts:7-29](https://github.com/evmts/primitives/blob/main/src/primitives/EventLog/BrandedEventLog/BrandedEventLog.ts#L7-L29)

## Filter Type

```typescript
export type Filter<
  TAddress extends BrandedAddress | BrandedAddress[] | undefined =
    | BrandedAddress
    | BrandedAddress[]
    | undefined,
  TTopics extends readonly (BrandedHash | BrandedHash[] | null)[] | undefined =
    | readonly (BrandedHash | BrandedHash[] | null)[]
    | undefined,
> = {
  /** Contract address(es) to filter by */
  address?: TAddress
  /** Topic filters (null entries match any topic, arrays match any of the hashes) */
  topics?: TTopics
  /** Starting block number */
  fromBlock?: bigint
  /** Ending block number */
  toBlock?: bigint
  /** Block hash to filter by (alternative to fromBlock/toBlock) */
  blockHash?: BrandedHash
}
```

Source: [BrandedEventLog.ts:34-53](https://github.com/evmts/primitives/blob/main/src/primitives/EventLog/BrandedEventLog/BrandedEventLog.ts#L34-L53)

## Core Methods

### create()

Create new EventLog from parameters.

```typescript
const log = EventLog.create({
  address: Address.from("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
  topics: [eventSignature, indexedParam1],
  data: nonIndexedData,
  blockNumber: 12345678n,
  transactionHash: txHash,
  transactionIndex: 42,
  logIndex: 7
})
```

### from()

Flexible constructor accepting various input formats.

```typescript
const log = EventLog.from({
  address: "0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e",
  topics: ["0xddf252ad...", "0x000..."],
  data: eventDataBytes
})
```

### getTopic0()

Extract event signature (first topic).

```typescript
const signature = EventLog.getTopic0(log)
// Hash("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef")
```

### getIndexedTopics()

Extract indexed parameters (topics 1-3).

```typescript
const indexed = EventLog.getIndexedTopics(log)
// [Hash("0x000...from"), Hash("0x000...to")]
```

### getSignature()

Alias for getTopic0().

```typescript
const sig = EventLog.getSignature(log)
```

### getIndexed()

Alias for getIndexedTopics().

```typescript
const indexed = EventLog.getIndexed(log)
```

### matchesTopics()

Check if log topics match filter pattern.

```typescript
const matches = EventLog.matchesTopics(log, [
  transferSignature,  // Must match
  fromAddress,        // Must match
  null,               // Any value accepted
])
```

### matchesAddress()

Check if log address matches filter.

```typescript
// Single address
const matches = EventLog.matchesAddress(log, contractAddress)

// Multiple addresses (OR logic)
const matches = EventLog.matchesAddress(log, [addr1, addr2, addr3])
```

### matchesFilter()

Check if log matches complete filter.

```typescript
const filter = {
  address: contractAddress,
  topics: [signature, fromAddr, null],
  fromBlock: 1000000n,
  toBlock: 2000000n
}

const matches = EventLog.matchesFilter(log, filter)
```

### filterLogs()

Filter array of logs by criteria.

```typescript
const matching = EventLog.filterLogs(allLogs, {
  address: tokenContract,
  topics: [transferSignature]
})
```

### sortLogs()

Sort logs by block/transaction/log position.

```typescript
const sorted = EventLog.sortLogs(unsortedLogs)
// Sorted by blockNumber, transactionIndex, logIndex (all ascending)
```

### isRemoved() / wasRemoved()

Check if log was removed due to chain reorganization.

```typescript
if (EventLog.isRemoved(log)) {
  console.log("Log invalidated by reorg")
}
```

### clone()

Create deep copy of log.

```typescript
const copy = EventLog.clone(log)
```

### copy()

Alias for clone().

```typescript
const copy = EventLog.copy(log)
```

## Use Cases

### Parsing Transfer Events

```typescript
import * as EventLog from '@tevm/primitives/EventLog'
import * as Abi from '@tevm/primitives/Abi'

// Transfer event signature: keccak256("Transfer(address,address,uint256)")
const transferSig = Hash.from("0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef")

// Filter for all transfers
const transfers = EventLog.filterLogs(allLogs, {
  topics: [transferSig]
})

// Decode each transfer
for (const log of transfers) {
  const [from, to] = EventLog.getIndexedTopics(log)
  const [amount] = Abi.decodeParameters(
    [{ type: "uint256" }],
    log.data
  )
  console.log(`Transfer: ${from} -> ${to}: ${amount}`)
}
```

### Monitoring Specific Contract

```typescript
const contractLogs = EventLog.filterLogs(logs, {
  address: myContract,
  fromBlock: lastProcessedBlock,
  toBlock: currentBlock
})

// Process new logs
for (const log of contractLogs) {
  if (!EventLog.isRemoved(log)) {
    await processLog(log)
  }
}
```

### Topic Filtering with Wildcards

```typescript
// Match any Transfer where 'to' is specific address
const receivedTransfers = EventLog.filterLogs(logs, {
  topics: [
    transferSignature,
    null,              // Any 'from'
    myAddressHash,     // Specific 'to'
  ]
})

// Match any Transfer where 'from' is one of several addresses
const sentTransfers = EventLog.filterLogs(logs, {
  topics: [
    transferSignature,
    [addr1Hash, addr2Hash, addr3Hash],  // OR logic
    null,
  ]
})
```

### Handling Reorganizations

```typescript
// Track valid logs, excluding removed ones
const validLogs = allLogs.filter(log => !EventLog.isRemoved(log))

// When reorg detected, refetch logs for affected blocks
const reorgLogs = await fetchLogs(reorgStartBlock, reorgEndBlock)

// Merge and sort
const allValidLogs = EventLog.sortLogs([
  ...validLogs,
  ...reorgLogs.filter(log => !log.removed)
])
```

## Topic Structure

Ethereum event logs use up to 4 topics:

- **topic0**: Event signature hash (keccak256 of event signature)
- **topic1-3**: Indexed parameters (up to 3)

```solidity
event Transfer(address indexed from, address indexed to, uint256 value);
```

Maps to:
- topic0: keccak256("Transfer(address,address,uint256)")
- topic1: from address (indexed)
- topic2: to address (indexed)
- data: abi.encode(value) (non-indexed)

## Related Types

<CardGrid stagger>
  <Card title="Hash" icon="seti:text">
    32-byte hashes used for topics and transaction hashes.

    [View Hash →](/primitives/hash)
  </Card>

  <Card title="Address" icon="document">
    20-byte addresses for log sources and indexed parameters.

    [View Address →](/primitives/address)
  </Card>

  <Card title="Abi" icon="puzzle">
    ABI encoding/decoding for event data and topics.

    [View Abi →](/primitives/abi)
  </Card>

  <Card title="Transaction" icon="rocket">
    Transactions that generate event logs.

    [View Transaction →](/primitives/transaction)
  </Card>
</CardGrid>

## Specification References

- [JSON-RPC eth_getLogs](https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_getlogs) - Log filtering specification
- [Solidity Events](https://docs.soliditylang.org/en/latest/contracts.html#events) - Event declaration and emission
- [Log Bloom Filters](https://ethereum.org/en/developers/docs/data-structures-and-encoding/patricia-merkle-trie/#log-bloom-filter) - Efficient log filtering in blocks
