---
title: Ens
description: Ethereum Name Service (ENS) normalization, encoding, and validation
---

import { Tabs, TabItem, Card, CardGrid, Aside } from '@astrojs/starlight/components';

# ENS (Ethereum Name Service)

ENSIP-15 compliant ENS name normalization with WASM acceleration. Prevents homograph attacks, validates names, and ensures consistent canonical representation.

## Overview

Voltaire provides complete ENS support:

- **Normalization** - ENSIP-15 compliant name normalization and beautification
- **Validation** - Character set, script mixing, and confusable detection
- **Security** - Homograph attack prevention and security best practices
- **Performance** - 5-6x faster normalization via WebAssembly
- **Standards** - Full ENSIP-1, 10, and 15 compliance

## Quick Start

<Tabs>
<TabItem label="Namespace API">
```typescript
import * as Ens from '@tevm/voltaire/Ens';

// Normalize ENS name
const normalized = Ens.normalize("Nick.ETH");
// Returns: "nick.eth"

// Beautify (preserve emoji)
const beautified = Ens.beautify("ðŸ’©.eth");

// Type guard
if (Ens.is(value)) {
  // value is BrandedEns
}

// Convert to/from string
const branded = Ens.from("vitalik.eth");
const plain = Ens.toString(branded);
```
</TabItem>

<TabItem label="Functional API">
```typescript
import {
  normalize,
  beautify,
  is,
  from,
  toString
} from '@tevm/voltaire/Ens';

// Normalize ENS name
const normalized = normalize("Nick.ETH");
// Returns: "nick.eth"

// Beautify (preserve emoji)
const beautified = beautify("ðŸ’©.eth");

// Type guard
if (is(value)) {
  // value is BrandedEns
}

// Convert to/from string
const branded = from("vitalik.eth");
const plain = toString(branded);
```
</TabItem>

<TabItem label="Name Resolution">
```typescript
import * as Ens from '@tevm/voltaire/Ens';
import * as Hash from '@tevm/voltaire/Hash';
import * as Keccak from '@tevm/voltaire/crypto/Keccak';

// 1. Normalize name
const normalized = Ens.normalize('Vitalik.ETH');
// "vitalik.eth"

// 2. Compute namehash
function namehash(name: string): Hash.Hash {
  const labels = name.split('.').reverse();
  let node = new Uint8Array(32);

  for (const label of labels) {
    const labelHash = Keccak.keccak256(
      new TextEncoder().encode(label)
    );
    const combined = new Uint8Array(64);
    combined.set(node, 0);
    combined.set(labelHash, 32);
    node = Keccak.keccak256(combined);
  }

  return Hash.from(node);
}

// 3. Resolve via registry
const node = namehash(normalized);
const resolver = await registry.resolver(node);
const address = await resolver.addr(node);
```
</TabItem>
</Tabs>

## Type

```typescript
type BrandedEns = string & { readonly __tag: "Ens" }
```

Branded string type for normalized ENS names.

## Documentation

<CardGrid>
<Card title="Normalization" icon="approve-check">
ENSIP-15 normalization and beautification. Convert names to canonical form, handle emoji, and ensure uniqueness.

[Learn about normalization â†’](/primitives/ens/normalization)
</Card>

<Card title="Encoding" icon="puzzle">
Namehash, labelhash, and DNS wire format encoding. Convert names to hashes for registry lookups.

[Learn about encoding â†’](/primitives/ens/encoding)
</Card>

<Card title="Validation" icon="list-format">
Character sets, label constraints, and script validation. Understand what makes a valid ENS name.

[Learn about validation â†’](/primitives/ens/validation)
</Card>

<Card title="Errors" icon="warning">
Error types and handling patterns. Handle validation failures gracefully with specific error types.

[Learn about errors â†’](/primitives/ens/errors)
</Card>

<Card title="Security" icon="seti:lock">
Homograph attack prevention, confusable detection, and security best practices for safe ENS integration.

[Learn about security â†’](/primitives/ens/security)
</Card>

<Card title="ENSIP Standards" icon="document">
ENSIP-1 (namehash), ENSIP-10 (wildcard resolution), and ENSIP-15 (normalization) specifications.

[Learn about ENSIPs â†’](/primitives/ens/ensip-standards)
</Card>

<Card title="Usage Patterns" icon="seti:config">
Real-world integration examples for dApps, wallets, and services. Name resolution, reverse resolution, and more.

[Learn about usage patterns â†’](/primitives/ens/usage-patterns)
</Card>

<Card title="WASM Optimization" icon="rocket">
WebAssembly acceleration for 5-6x faster normalization. Performance benchmarks and optimization tips.

[Learn about WASM â†’](/primitives/ens/wasm)
</Card>
</CardGrid>

## Core API

### normalize()

Normalize ENS name to canonical lowercase form per ENSIP-15.

```typescript
normalize(name: string | BrandedEns): BrandedEns
```

**Example:**
```typescript
import { Ens } from "@tevm/voltaire";

const normalized = Ens.normalize("Nick.ETH");
// Returns: "nick.eth"

const preserved = Ens.normalize("vitalik.eth");
// Returns: "vitalik.eth"
```

**Throws:**
- `DisallowedCharacterError` - Invalid characters
- `IllegalMixtureError` - Mixed scripts
- `WholeConfusableError` - Homograph attack
- `EmptyLabelError` - Empty label segment
- `InvalidLabelExtensionError` - Invalid extension

### beautify()

Beautify ENS name (normalize but preserve emoji presentation).

```typescript
beautify(name: string | BrandedEns): BrandedEns
```

**Example:**
```typescript
const beautified = Ens.beautify("ðŸ’©.eth");
// Returns: normalized form with emoji preserved
```

### is()

Check if value is a branded ENS name.

```typescript
is(value: unknown): value is BrandedEns
```

**Example:**
```typescript
if (Ens.is(value)) {
  // value is BrandedEns
}
```

### from()

Create branded ENS name without validation.

```typescript
from(name: string): BrandedEns
```

### toString()

Convert branded ENS name to string.

```typescript
toString(name: BrandedEns): string
```

## Error Types

All errors inherit from `EnsError` base class:

| Error | Description |
|-------|-------------|
| `EnsError` | Base class for all ENS errors |
| `DisallowedCharacterError` | Prohibited characters |
| `InvalidLabelExtensionError` | Double-dash at positions 2-3 |
| `IllegalMixtureError` | Incompatible script combinations |
| `WholeConfusableError` | Homograph attack detected |
| `EmptyLabelError` | Zero-length label segment |
| `InvalidUtf8Error` | Malformed UTF-8 encoding |

**Example:**
```typescript
import { Ens, DisallowedCharacterError } from "@tevm/voltaire";

try {
  const name = Ens.normalize("invalid\x00.eth");
} catch (err) {
  if (err instanceof DisallowedCharacterError) {
    console.error("Name contains disallowed characters");
  }
}
```

[See all error types â†’](/primitives/ens/errors)

## Zig API

```zig
const primitives = @import("primitives");

// Normalize ENS name
const normalized = try primitives.Ens.normalize(allocator, "Nick.ETH");
defer allocator.free(normalized);
// Returns: "nick.eth"

// Beautify (preserve emoji)
const beautified = try primitives.Ens.beautify(allocator, "ðŸ’©.eth");
defer allocator.free(beautified);
```

### Error Handling

```zig
const name = primitives.Ens.normalize(allocator, "invalid..eth") catch |err| {
    switch (err) {
        error.DisallowedCharacter => std.debug.print("Invalid character\n", .{}),
        error.IllegalMixture => std.debug.print("Mixed scripts\n", .{}),
        error.EmptyLabel => std.debug.print("Empty label\n", .{}),
        error.OutOfMemory => return err,
        else => return err,
    }
};
```

## Security Considerations

<Aside type="caution">
Always normalize ENS names before any operations (resolution, comparison, storage). Skipping normalization enables homograph attacks and name confusion.
</Aside>

### Critical Security Rules

1. **Normalize before resolution** - Prevents homograph attacks
2. **Normalize before storage** - Ensures consistent lookups
3. **Normalize before comparison** - Avoids case/unicode mismatches
4. **Use ENSIP-15 implementation** - Never implement custom normalization
5. **Handle errors as security events** - Log suspicious validation failures

**Example:**
```typescript
// âœ“ CORRECT
const normalized = Ens.normalize(userInput);
const address = await registry.resolve(namehash(normalized));

// âœ— WRONG - Vulnerable to attacks!
const address = await registry.resolve(namehash(userInput));
```

### Threat Prevention

| Attack | Prevention |
|--------|-----------|
| **Homograph** | Whole confusable detection |
| **Mixed scripts** | Script combination validation |
| **Zero-width** | Invisible character rejection |
| **Case confusion** | Lowercase normalization |
| **Unicode variation** | NFC normalization |

[Learn about security â†’](/primitives/ens/security)

## Performance

### WASM Acceleration

Normalization uses WebAssembly for 5-6x performance improvement:

| Operation | JavaScript | WASM | Speedup |
|-----------|-----------|------|---------|
| normalize (short) | 15Î¼s | 3Î¼s | **5.0x** |
| normalize (long) | 120Î¼s | 20Î¼s | **6.0x** |
| beautify (emoji) | 25Î¼s | 5Î¼s | **5.0x** |
| Bulk (1000 names) | 18ms | 3.5ms | **5.1x** |

WASM loads automatically when available, falls back to JavaScript implementation on unsupported platforms.

[Learn about WASM optimization â†’](/primitives/ens/wasm)

## Tree-Shaking

Import only what you need for optimal bundle size:

```typescript
// Import specific methods
import { normalize, beautify } from '@tevm/voltaire/Ens'

// Or import entire namespace
import { Ens } from '@tevm/voltaire'

// Selective imports minimize bundle size
const normalized = normalize("Nick.ETH")
// beautify() not included in bundle if unused
```

Each normalization method is independently exported. Import only `normalize` if you don't need `beautify` or type guards, reducing bundle size by excluding unused Unicode handling logic.

## Common Patterns

### Name Resolution

```typescript
import * as Ens from '@tevm/voltaire/Ens';

async function resolveEns(name: string): Promise<Address> {
  const normalized = Ens.normalize(name);
  const node = namehash(normalized);
  const resolver = await registry.resolver(node);
  return await resolver.addr(node);
}
```

### Input Validation

```typescript
function validateEnsInput(input: string): {
  valid: boolean;
  normalized?: string;
  error?: string;
} {
  try {
    const normalized = Ens.normalize(input);
    return { valid: true, normalized };
  } catch (err) {
    return {
      valid: false,
      error: err instanceof Error ? err.message : 'Invalid',
    };
  }
}
```

### Comparison

```typescript
function isSameName(name1: string, name2: string): boolean {
  try {
    return Ens.normalize(name1) === Ens.normalize(name2);
  } catch {
    return false;
  }
}
```

[See more usage patterns â†’](/primitives/ens/usage-patterns)

## Examples

### Basic Normalization

```typescript
import { Ens } from "@tevm/voltaire";

// Uppercase to lowercase
const name1 = Ens.normalize("VITALIK.eth");
// "vitalik.eth"

// Mixed case
const name2 = Ens.normalize("Nick.ETH");
// "nick.eth"

// Already normalized
const name3 = Ens.normalize("vitalik.eth");
// "vitalik.eth"
```

### Error Handling

```typescript
import { Ens, DisallowedCharacterError } from "@tevm/voltaire";

try {
  const name = Ens.normalize("invalid\x00.eth");
} catch (err) {
  if (err instanceof DisallowedCharacterError) {
    console.error("Name contains disallowed characters");
  }
}
```

### With Address Resolution

```typescript
import { Ens, Address } from "@tevm/voltaire";

// Normalize before resolution
const normalizedName = Ens.normalize("Nick.ETH");
// Use normalizedName for address lookup via ENS registry
```

## ENSIP Compliance

Voltaire implements full ENSIP-15 specification:

- **Unicode normalization** - NFC normalization with confusable detection
- **Script validation** - Prevents mixed-script attacks
- **Emoji handling** - Proper emoji presentation sequence support
- **Label validation** - Empty label and extension checks
- **Zero-width characters** - Proper handling of ZWJ/ZWNJ

[Learn about ENSIP standards â†’](/primitives/ens/ensip-standards)

## References

### ENS Documentation

- [ENSIP-15: ENS Name Normalization](https://docs.ens.domains/ensip/15)
- [ENSIP-1: ENS Specification](https://docs.ens.domains/ensip/1)
- [ENSIP-10: Wildcard Resolution](https://docs.ens.domains/ensip/10)
- [ENS Official Docs](https://docs.ens.domains/)

### Security

- [Unicode Security (TR39)](https://www.unicode.org/reports/tr39/)
- [Homograph Attack](https://en.wikipedia.org/wiki/IDN_homograph_attack)

### Implementation

- [z-ens-normalize](https://github.com/evmts/z-ens-normalize) - Zig implementation
- [@adraffy/ens-normalize](https://github.com/adraffy/ens-normalize.js) - JavaScript implementation

## Related Primitives

- [Hash](/primitives/hash) - Hash type for namehash/labelhash results
- [Address](/primitives/address) - Ethereum address resolution
- [Hex](/primitives/hex) - Hex encoding for registry interaction
