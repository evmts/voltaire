---
title: Event Encoding
description: Event log encoding, decoding, signatures, and topic generation
---

import { Tabs, TabItem, Aside } from '@astrojs/starlight/components';

# Event Encoding

Complete event ABI encoding and decoding operations for Ethereum smart contract event logs.

## Overview

Event encoding enables:
- Computing event signatures and selectors (keccak256 hash)
- Encoding indexed parameters into topics
- Decoding event logs back into structured data
- Filtering events by indexed parameters

## Event Type

```typescript
export type Event<
  TName extends string = string,
  TInputs extends readonly Parameter[] = readonly Parameter[]
> = {
  type: "event"
  name: TName
  inputs: TInputs
  anonymous?: boolean
}
```

Source: [BrandedEvent.ts:3-11](https://github.com/evmts/primitives/blob/main/src/primitives/Abi/event/BrandedEvent.ts#L3-L11)

## Quick Start

```typescript
import { Event } from '@tevm/primitives/Abi'

// Define event
const transferEvent = {
  type: "event",
  name: "Transfer",
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address", name: "to", indexed: true },
    { type: "uint256", name: "value", indexed: false }
  ]
}

// Decode event log
const decoded = Event.decodeLog(transferEvent, logData, logTopics)
// { from: "0x...", to: "0x...", value: 1000n }

// Encode topics for filtering
const topics = Event.encodeTopics(transferEvent, {
  from: "0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"
})
```

## API Reference

### getSignature

Get event signature string in canonical format `EventName(type1,type2,...)`.

```typescript
function getSignature(event: Event): string
```

**Parameters:**
- `event: Event` - Event ABI item

**Returns:** `string` - Event signature

**Example:**
```typescript
const transferEvent = {
  type: "event",
  name: "Transfer",
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address", name: "to", indexed: true },
    { type: "uint256", name: "value", indexed: false }
  ]
}

const signature = Event.getSignature(transferEvent)
// "Transfer(address,address,uint256)"

const approvalEvent = {
  type: "event",
  name: "Approval",
  inputs: [
    { type: "address", name: "owner", indexed: true },
    { type: "address", name: "spender", indexed: true },
    { type: "uint256", name: "value", indexed: false }
  ]
}

const signature2 = Event.getSignature(approvalEvent)
// "Approval(address,address,uint256)"
```

**Notes:**
- Parameter names are excluded
- Indexed flag is excluded
- Only types matter for signature computation
- Format: `EventName(type1,type2,...)`

Source: [getSignature.js:13-16](https://github.com/evmts/primitives/blob/main/src/primitives/Abi/event/getSignature.js#L13-L16)

### getSelector

Compute event selector (full 32-byte keccak256 hash of signature).

```typescript
function getSelector(event: Event): BrandedHash
```

**Parameters:**
- `event: Event` - Event ABI item

**Returns:** `BrandedHash` - 32-byte event selector

**Example:**
```typescript
const transferEvent = {
  type: "event",
  name: "Transfer",
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address", name: "to", indexed: true },
    { type: "uint256", name: "value" }
  ]
}

const selector = Event.getSelector(transferEvent)
// 32-byte Uint8Array: keccak256("Transfer(address,address,uint256)")

// This becomes topic[0] for non-anonymous events
```

**Implementation:**
1. Get event signature: `Transfer(address,address,uint256)`
2. Hash with keccak256: full 32-byte hash (unlike function selectors which use 4 bytes)
3. Used as topic[0] in logs

**Note:** Event selectors are 32 bytes (full hash), unlike function selectors which are 4 bytes.

Source: [getSelector.js:16-19](https://github.com/evmts/primitives/blob/main/src/primitives/Abi/event/getSelector.js#L16-L19)

### encodeTopics

Encode event arguments into topics array for filtering.

```typescript
function encodeTopics<TInputs extends readonly Parameter[]>(
  event: Event<string, TInputs>,
  args: Partial<ParametersToObject<TInputs>>
): (BrandedHash | null)[]
```

**Parameters:**
- `event: Event` - Event ABI item
- `args` - Partial object with indexed parameter values

**Returns:** Array of topics (nulls for unspecified indexed params)

**Example:**
```typescript
const transferEvent = {
  type: "event",
  name: "Transfer",
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address", name: "to", indexed: true },
    { type: "uint256", name: "value", indexed: false }
  ]
}

// Filter for transfers from specific address
const topics1 = Event.encodeTopics(transferEvent, {
  from: "0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"
})
// [selector, encodedFrom, null]

// Filter for transfers to specific address
const topics2 = Event.encodeTopics(transferEvent, {
  to: "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045"
})
// [selector, null, encodedTo]

// Filter for specific sender and recipient
const topics3 = Event.encodeTopics(transferEvent, {
  from: "0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e",
  to: "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045"
})
// [selector, encodedFrom, encodedTo]
```

**Topics Structure:**
- Topic 0: Event selector (for non-anonymous events)
- Topic 1-3: Indexed parameters (dynamic types are hashed)

**Dynamic Type Handling:**
For dynamic types (string, bytes, arrays), the topic contains keccak256 hash:
```typescript
const dataEvent = {
  type: "event",
  name: "Data",
  inputs: [
    { type: "bytes", name: "data", indexed: true },
    { type: "string", name: "text", indexed: true }
  ]
}

const topics = Event.encodeTopics(dataEvent, {
  data: new Uint8Array([1, 2, 3]),
  text: "hello"
})
// Topics contain hashes of the values, not the raw values
```

Source: [encodeTopics.js:19-47](https://github.com/evmts/primitives/blob/main/src/primitives/Abi/event/encodeTopics.js#L19-L47)

### decodeLog

Decode event log data and topics into structured event arguments.

```typescript
function decodeLog<TInputs extends readonly Parameter[]>(
  event: Event<string, TInputs>,
  data: Uint8Array,
  topics: readonly BrandedHash[]
): ParametersToObject<TInputs>
```

**Parameters:**
- `event: Event` - Event ABI item
- `data: Uint8Array` - Log data bytes (non-indexed parameters)
- `topics: readonly BrandedHash[]` - Log topics array

**Returns:** Object with decoded event arguments

**Throws:**
- `AbiDecodingError` - If topics are missing or data is invalid
- `AbiInvalidSelectorError` - If event selector doesn't match topic[0]

**Example:**
```typescript
const transferEvent = {
  type: "event",
  name: "Transfer",
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address", name: "to", indexed: true },
    { type: "uint256", name: "value", indexed: false }
  ]
}

// Decode from blockchain log
const log = await provider.getLogs({...})

const decoded = Event.decodeLog(
  transferEvent,
  log.data,
  log.topics
)
// {
//   from: "0x742d35cc6634c0532925a3b844bc9e7595f51e3e",
//   to: "0xd8da6bf26964af9d7eed9e03e53415d37aa96045",
//   value: 1000n
// }
```

**Decoding Process:**
1. Verify topic[0] matches event selector (unless anonymous)
2. Extract indexed parameters from topics
3. Decode non-indexed parameters from data
4. Return object with all parameters

**Dynamic Indexed Parameters:**
For dynamic types that are indexed, the topic contains the hash, not the value:
```typescript
const dataEvent = {
  type: "event",
  name: "Data",
  inputs: [
    { type: "bytes", name: "data", indexed: true }
  ]
}

const decoded = Event.decodeLog(dataEvent, logData, logTopics)
// { data: Uint8Array (32-byte hash, not original data) }
```

Source: [decodeLog.js:22-88](https://github.com/evmts/primitives/blob/main/src/primitives/Abi/event/decodeLog.js#L22-L88)

## Event Topics

### Topic Layout

Events use up to 4 topics (topic0 through topic3):

```
topic[0]: Event selector (keccak256 of signature)
topic[1]: First indexed parameter
topic[2]: Second indexed parameter
topic[3]: Third indexed parameter
```

**Non-anonymous event:**
```typescript
const transferEvent = {
  type: "event",
  name: "Transfer",
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address", name: "to", indexed: true },
    { type: "uint256", name: "value" }  // not indexed
  ]
}

// Topics: [selector, from, to]
// Data: [value]
```

**Anonymous event:**
```typescript
const anonymousEvent = {
  type: "event",
  name: "Transfer",
  anonymous: true,
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address", name: "to", indexed: true },
    { type: "uint256", name: "value", indexed: true }
  ]
}

// Topics: [from, to, value]  (no selector)
// Data: []
```

### Indexed vs Non-Indexed

**Indexed parameters** (up to 3):
- Stored in topics
- Can be filtered efficiently
- Dynamic types (string, bytes, arrays) are hashed

**Non-indexed parameters**:
- Stored in data field
- Cannot be filtered
- Dynamic types stored as-is (not hashed)

```typescript
const event = {
  type: "event",
  name: "Transfer",
  inputs: [
    { type: "address", name: "from", indexed: true },    // filterable
    { type: "address", name: "to", indexed: true },      // filterable
    { type: "uint256", name: "value", indexed: false }   // not filterable
  ]
}
```

## Anonymous Events

Anonymous events omit the event selector from topics, allowing 4 indexed parameters:

```typescript
const anonymousTransfer = {
  type: "event",
  name: "Transfer",
  anonymous: true,
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address", name: "to", indexed: true },
    { type: "uint256", name: "amount", indexed: true },
    { type: "uint256", name: "timestamp", indexed: true }
  ]
}

// All 4 topics available for indexed parameters
// No topic[0] for selector
```

**Decoding anonymous events:**
```typescript
const decoded = Event.decodeLog(
  anonymousTransfer,
  logData,
  logTopics
)
// Skips selector verification since anonymous: true
```

## Complete Workflow

<Tabs>
<TabItem label="Filtering Events">
```typescript
import { Event } from '@tevm/primitives/Abi'

// Define event
const transferEvent = {
  type: "event",
  name: "Transfer",
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address", name: "to", indexed: true },
    { type: "uint256", name: "value" }
  ]
}

// Create filter topics
const topics = Event.encodeTopics(transferEvent, {
  from: "0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"
})

// Get logs
const logs = await provider.getLogs({
  address: contractAddress,
  topics: topics,
  fromBlock: startBlock,
  toBlock: endBlock
})

// Decode each log
const transfers = logs.map(log =>
  Event.decodeLog(transferEvent, log.data, log.topics)
)
```
</TabItem>
<TabItem label="Multi-Event Decoding">
```typescript
import { Event } from '@tevm/primitives/Abi'

// Define multiple events
const transferEvent = {...}
const approvalEvent = {...}

// Create selector map
const eventMap = new Map([
  [Event.getSelector(transferEvent).toString(), transferEvent],
  [Event.getSelector(approvalEvent).toString(), approvalEvent]
])

// Decode logs
const logs = await provider.getLogs({address: contractAddress})

const decoded = logs.map(log => {
  const selector = log.topics[0].toString()
  const event = eventMap.get(selector)

  if (!event) return null

  return {
    name: event.name,
    args: Event.decodeLog(event, log.data, log.topics)
  }
}).filter(Boolean)
```
</TabItem>
<TabItem label="Real-time Monitoring">
```typescript
import { Event } from '@tevm/primitives/Abi'

const transferEvent = {...}

// Subscribe to new logs
const topics = Event.encodeTopics(transferEvent, {})

provider.on({
  address: contractAddress,
  topics: topics
}, (log) => {
  const decoded = Event.decodeLog(
    transferEvent,
    log.data,
    log.topics
  )

  console.log(`Transfer: ${decoded.from} -> ${decoded.to}`, decoded.value)
})
```
</TabItem>
</Tabs>

## Advanced Examples

### Complex Indexed Types

```typescript
const complexEvent = {
  type: "event",
  name: "DataUpdated",
  inputs: [
    { type: "bytes32", name: "id", indexed: true },
    { type: "string", name: "key", indexed: true },  // hashed
    { type: "bytes", name: "value" }  // not indexed, full data
  ]
}

// Encode topics - string is hashed
const topics = Event.encodeTopics(complexEvent, {
  id: "0x1234...",
  key: "myKey"  // will be keccak256("myKey")
})

// Decode log
const decoded = Event.decodeLog(complexEvent, logData, logTopics)
// {
//   id: "0x1234...",
//   key: Uint8Array(32),  // hash, not original "myKey"
//   value: Uint8Array  // original bytes
// }
```

### Multiple Filters

```typescript
const transferEvent = {...}

// Get transfers FROM specific address
const topicsFrom = Event.encodeTopics(transferEvent, {
  from: "0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"
})

// Get transfers TO specific address
const topicsTo = Event.encodeTopics(transferEvent, {
  to: "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045"
})

// Get transfers between two addresses
const topicsBoth = Event.encodeTopics(transferEvent, {
  from: "0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e",
  to: "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045"
})
```

### Array Events

```typescript
const batchTransferEvent = {
  type: "event",
  name: "BatchTransfer",
  inputs: [
    { type: "address", name: "from", indexed: true },
    { type: "address[]", name: "recipients" },
    { type: "uint256[]", name: "amounts" }
  ]
}

const decoded = Event.decodeLog(
  batchTransferEvent,
  logData,
  logTopics
)
// {
//   from: "0x...",
//   recipients: ["0x...", "0x...", "0x..."],
//   amounts: [100n, 200n, 300n]
// }
```

### Tuple Events

```typescript
const userUpdatedEvent = {
  type: "event",
  name: "UserUpdated",
  inputs: [
    { type: "address", name: "user", indexed: true },
    {
      type: "tuple",
      name: "profile",
      components: [
        { type: "string", name: "name" },
        { type: "uint256", name: "age" },
        { type: "bool", name: "active" }
      ]
    }
  ]
}

const decoded = Event.decodeLog(userUpdatedEvent, logData, logTopics)
// {
//   user: "0x...",
//   profile: { name: "Alice", age: 30n, active: true }
// }
```

## Error Handling

```typescript
import {
  AbiDecodingError,
  AbiInvalidSelectorError
} from '@tevm/primitives/Abi'

try {
  const decoded = Event.decodeLog(transferEvent, logData, logTopics)
} catch (error) {
  if (error instanceof AbiInvalidSelectorError) {
    console.error("Event selector mismatch - wrong event type")
  } else if (error instanceof AbiDecodingError) {
    console.error("Invalid log data:", error.message)
  }
}
```

## Type Utilities

```typescript
// Encode topics args type
type EncodeTopicsArgs<TInputs extends readonly Parameter[]> =
  Partial<ParametersToObject<TInputs>>

// Decode log result type
type DecodeLogResult<TInputs extends readonly Parameter[]> =
  ParametersToObject<TInputs>

// Usage with specific event
const transferEvent = {...} as const

type TransferArgs = EncodeTopicsArgs<typeof transferEvent.inputs>
// { from?: BrandedAddress, to?: BrandedAddress }

type TransferData = DecodeLogResult<typeof transferEvent.inputs>
// { from: BrandedAddress, to: BrandedAddress, value: bigint }
```

Source: [BrandedEvent.ts:13-18](https://github.com/evmts/primitives/blob/main/src/primitives/Abi/event/BrandedEvent.ts#L13-L18)

## Related

- [Abi](/primitives/abi) - Main ABI documentation
- [Types](/primitives/abi/types) - ABI type system
- [Function](/primitives/abi/function) - Function encoding
- [Usage Patterns](/primitives/abi/usage-patterns) - Common patterns
- [Hash](/primitives/hash) - Keccak256 hashing

## Specification

- [Solidity Events](https://docs.soliditylang.org/en/latest/abi-spec.html#events) - Event specification
- [Log Topics](https://docs.soliditylang.org/en/latest/abi-spec.html#indexed-event-encoding) - Indexed parameter encoding
