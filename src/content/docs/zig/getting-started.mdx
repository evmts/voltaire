---
title: Getting Started with Zig
description: Build, test, and develop Voltaire's Zig implementation
---

# Getting Started with Zig

This guide covers building, testing, and developing Voltaire's Zig implementation.

## Prerequisites

- **Zig 0.15.1**: [Download from ziglang.org](https://ziglang.org/download/)
- **Bun**: For TypeScript integration and testing
- **Git**: For dependency management (submodules)

## Quick Start

```bash
# Clone and install dependencies
git clone https://github.com/evmts/voltaire.git
cd voltaire
bun install
git submodule update --init

# Build everything (Zig + TypeScript + C libs)
zig build

# Run all Zig tests
zig build test
```

## Build Commands

### Core Commands

```bash
# Full build (Zig + TS typecheck + C libs)
zig build

# All Zig tests (primitives + crypto + precompiles)
zig build test

# Filter tests by pattern
zig build -Dtest-filter=address

# Release build
zig build --release=fast
```

### Multi-Target Builds

```bash
# Native FFI (.dylib/.so) - ReleaseFast
zig build build-ts-native

# WASM - ReleaseSmall (size-optimized)
zig build build-ts-wasm

# WASM - ReleaseFast (perf-optimized)
zig build build-ts-wasm-fast

# Individual crypto WASM (tree-shaking)
zig build crypto-wasm
```

### Quality Checks

```bash
# Format Zig + TypeScript
zig build format

# Check formatting
zig build format-check

# Lint TypeScript (auto-fix)
zig build lint

# Quick validation (format + lint + typecheck)
zig build check

# Complete CI pipeline
zig build ci
```

### Testing Variants

```bash
# All TypeScript tests (vitest)
zig build test-ts

# Native FFI tests
zig build test-ts-native

# WASM tests
zig build test-ts-wasm

# Integration tests
zig build test-integration

# Security tests
zig build test-security
```

### Benchmarks

```bash
# zbench Zig benchmarks
zig build bench

# Filter benchmarks by pattern
zig build -Dbench-filter=keccak

# TypeScript comparison benchmarks
zig build bench-ts
```

### Examples

```bash
# Run examples from examples/ directory
zig build example-keccak256
zig build example-address
zig build example-secp256k1
```

### Utilities

```bash
# Clean artifacts (keep node_modules)
zig build clean

# Deep clean + node_modules
zig build clean-all

# Install/update all dependencies
zig build deps

# Generate C header from c_api.zig
zig build generate-header
```

## Project Structure

```
src/
├── primitives/         # Core Ethereum types
│   ├── root.zig        # Module entry point
│   ├── address.zig     # Address type
│   ├── hash.zig        # Hash32 type
│   └── ...
├── crypto/             # Cryptographic operations
│   ├── root.zig        # Module entry point
│   ├── keccak256.zig   # Keccak hashing
│   ├── secp256k1.zig   # ECDSA signatures
│   └── ...
└── precompiles/        # EVM precompile implementations
    ├── root.zig        # Module entry point
    ├── ecrecover.zig   # 0x01: Signature recovery
    ├── sha256.zig      # 0x02: SHA-256 hash
    └── ...
```

## Module Imports

Always use module imports (NOT relative paths):

```zig
// ✅ Correct
const primitives = @import("primitives");
const crypto = @import("crypto");
const precompiles = @import("precompiles");

// ❌ Wrong
const address = @import("../primitives/address.zig");
```

## Development Workflow (TDD)

Voltaire uses Test-Driven Development:

```bash
# Run from repo root (never cd)
zig build && zig build test

# Watch mode (use external tool like watchexec)
watchexec -e zig 'zig build test'
```

**Philosophy**: Run `zig build && zig build test` frequently. Know immediately if build breaks.

## Testing

### Zig Tests

Tests are inline in source files:

```zig
test "address from hex" {
    const addr = try Address.fromHex("0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb");
    try std.testing.expectEqual(20, addr.len);
}
```

Run with:
```bash
zig build test                    # All tests
zig build -Dtest-filter=address   # Filtered
```

**No output = passed**. For debugging:
```zig
std.testing.log_level = .debug;
```

### TypeScript Integration Tests

```bash
bun run test:native   # Native FFI tests
bun run test:wasm     # WASM tests
```

## Common Tasks

### Adding a New Primitive

1. Create `src/primitives/yourtype.zig`
2. Export from `src/primitives/root.zig`
3. Add tests inline
4. Run `zig build test`
5. Add TypeScript bindings if needed

### Adding Cryptography

1. Create `src/crypto/youralgo.zig`
2. Export from `src/crypto/root.zig`
3. Add security tests (known vectors, edge cases)
4. Verify constant-time properties
5. Benchmark against reference implementations

### Adding a Precompile

1. Create `src/precompiles/yourprecompile.zig`
2. Export from `src/precompiles/root.zig`
3. Test against Ethereum test vectors
4. Add gas cost calculations
5. Document precompile address and spec

## Dependencies

### C Libraries (lib/)
- **blst**: BLS12-381 signatures
- **c-kzg-4844**: KZG commitments (EIP-4844)
- **libwally-core**: Wallet utilities (git submodule)

Built automatically by `zig build`.

### Rust (Cargo.toml → libcrypto_wrappers.a)
- **arkworks**: ark-bn254, ark-bls12-381
- **keccak-asm**: Assembly-optimized (native)
- **tiny-keccak**: Pure Rust (WASM)

### Zig (build.zig.zon)
- **zbench**: Performance benchmarking
- **clap**: CLI argument parsing

## Troubleshooting

### Build Errors

```bash
# Clean and rebuild
zig build clean
zig build

# Check Zig version
zig version  # Should be 0.15.1
```

### Test Failures

```bash
# Run specific test
zig build -Dtest-filter=yourtest

# Enable debug logging in test
std.testing.log_level = .debug;
```

### WASM Issues

```bash
# Rebuild WASM
zig build build-ts-wasm

# Test WASM specifically
bun run test:wasm
```

## Next Steps

- [Contributing](/zig/contributing/) - Code style and guidelines
- [Primitives](/zig/primitives/) - Core types documentation
- [Cryptography](/zig/crypto/) - Crypto operations
- [Precompiles](/zig/precompiles/) - EVM precompiles
