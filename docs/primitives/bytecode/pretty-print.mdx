---
title: Bytecode.prettyPrint
description: Generate annotated, human-readable disassembly with colors and metadata
icon: code
---

<Tabs>
<Tab title="Class API">

## `bytecode.prettyPrint(options?: PrettyPrintOptions): string`

Generate beautifully formatted, annotated bytecode disassembly with ANSI colors, block boundaries, jump visualization, gas costs, and stack effects.

Returns multi-line string suitable for terminal output or debugging.

**Parameters:**
- `options?: PrettyPrintOptions` - Formatting configuration

**Returns:** `string` - Formatted disassembly

**Example:**

```typescript
import { Bytecode } from '@tevm/voltaire';

const code = Bytecode.fromHex("0x60016002015b00");
console.log(code.prettyPrint({
  colors: true,
  showGas: true,
  showStack: true
}));
```

**Defined in:** [BrandedBytecode/prettyPrint.js](https://github.com/evmts/voltaire/blob/main/src/primitives/Bytecode/BrandedBytecode/prettyPrint.js)

</Tab>
<Tab title="Namespace API">

## `prettyPrint(code: BrandedBytecode, options?: PrettyPrintOptions): string`

Generate beautifully formatted, annotated bytecode disassembly.

**Parameters:**
- `code: BrandedBytecode` - Bytecode to disassemble
- `options?: PrettyPrintOptions` - Formatting configuration

**Returns:** `string` - Formatted disassembly

**Example:**

```typescript
import * as Bytecode from '@tevm/voltaire/Bytecode';

const code = Bytecode.fromHex("0x60016002015b00");
const disassembly = Bytecode.prettyPrint(code);
console.log(disassembly);
```

**Tree-shakeable import:**

```typescript
import { prettyPrint } from '@tevm/voltaire/BrandedBytecode';

const output = prettyPrint(code, { colors: true });
```

**Defined in:** [BrandedBytecode/prettyPrint.js](https://github.com/evmts/voltaire/blob/main/src/primitives/Bytecode/BrandedBytecode/prettyPrint.js)

</Tab>
</Tabs>

## Output Format

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     EVM Bytecode Disassembly         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š Length: 145 bytes
ğŸ“ Legend: â—=JUMPDEST  âš¡=Fusion  âœ—=Invalid Jump

 #   | PC   | Stack | Hex          | Opcode    | Jump | Details
-----|------|-------|--------------|-----------|------|------------------
   1 |    0 |     0 | 60 01        | PUSH1     |      | 0x1 (1) [gas: 3]
   2 |    2 |     1 | 60 02        | PUSH1     |      | 0x2 (2) [gas: 3]
   3 |    4 |     2 | 01           | ADD       |      | [gas: 3] [stack: -2, +1]

[Block 0] gas: 9 stack: [0, 2] len: 3

   4 |    5 |     1 | â— 5b         | JUMPDEST  | â†â—   | [target: PC=5] [gas: 1]
   5 |    6 |     1 | 00           | STOP      |      | [gas: 0]

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘            Summary                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ˆ Basic blocks: 2
ğŸ¯ Jump destinations: 1
â¡ï¸  Unconditional jumps: 0
â“ Conditional jumps: 0
âš¡ Fusion candidates: 0
ğŸ“ Total instructions: 5
```

## Options

```typescript
interface PrettyPrintOptions {
  /** Use ANSI colors (default: true if terminal supports) */
  colors?: boolean

  /** Show gas costs inline (default: true) */
  showGas?: boolean

  /** Show stack depth column (default: true) */
  showStack?: boolean

  /** Show block boundaries and metadata (default: true) */
  showBlocks?: boolean

  /** Show jump arrows and targets (default: true) */
  showJumpArrows?: boolean

  /** Show fusion annotations (default: true) */
  showFusions?: boolean

  /** Show line numbers (default: true) */
  lineNumbers?: boolean

  /** Include summary footer (default: true) */
  showSummary?: boolean

  /** Maximum width for output (default: 120) */
  maxWidth?: number

  /** Compact mode (fewer columns) (default: false) */
  compact?: boolean
}
```

## Usage Patterns

### Basic Disassembly

```typescript
const code = Bytecode.fromHex("0x60016002015b00");

// Simple output (no colors, no annotations)
console.log(code.prettyPrint({
  colors: false,
  showGas: false,
  showStack: false,
  showBlocks: false
}));

// Full output (all annotations)
console.log(code.prettyPrint());
```

### Gas-Focused View

```typescript
const output = code.prettyPrint({
  showGas: true,
  showStack: false,
  showJumpArrows: false,
  showFusions: false
});

// Highlights gas costs for optimization analysis
```

### Stack-Focused View

```typescript
const output = code.prettyPrint({
  showStack: true,
  showGas: false,
  showBlocks: true
});

// Shows stack depth evolution for validation
```

### Compact Mode

```typescript
const output = code.prettyPrint({
  compact: true,
  maxWidth: 80
});

// Fits in narrow terminals (80 columns)
```

### Save to File

```typescript
import { writeFileSync } from 'fs';

const disassembly = code.prettyPrint({ colors: false });
writeFileSync('bytecode.asm', disassembly);
```

<Note>
Disable colors when saving to file to avoid ANSI escape sequences in text files.
</Note>

## Color Coding

Instructions are color-coded by category:

| Category | Color | Opcodes |
|----------|-------|---------|
| **PUSH** | Blue | PUSH0-PUSH32 |
| **Arithmetic** | Cyan | ADD, SUB, MUL, DIV, MOD, EXP |
| **Comparison** | Magenta | LT, GT, EQ, ISZERO |
| **Bitwise** | Bright Cyan | AND, OR, XOR, NOT, SHL, SHR |
| **Memory** | Bright Blue | MLOAD, MSTORE, MSTORE8 |
| **Storage** | Bright Magenta | SLOAD, SSTORE, TLOAD, TSTORE |
| **Stack** | Green | DUP1-16, SWAP1-16, POP |
| **Jump (JUMP)** | Yellow | JUMP |
| **Jump (JUMPI)** | Gold | JUMPI |
| **JUMPDEST** | Green BG | JUMPDEST (green background) |
| **Flow Control** | Red | STOP, RETURN, REVERT, INVALID |
| **System** | Bright Yellow | CALL, CREATE, SELFDESTRUCT, etc. |

<Tip>
Color scheme optimized for dark terminals. Colors automatically disabled if stdout is not a TTY.
</Tip>

## Block Visualization

Basic blocks shown with metadata header:

```
[Block 0] gas: 21 stack: [0, 3] len: 7
   1 |    0 |     0 | 60 01        | PUSH1     |      | ...
   2 |    2 |     1 | 60 02        | PUSH1     |      | ...
   ...

[Block 1] gas: 156 stack: [1, 5] len: 12
 â— Begin
   8 |   23 |     1 | â— 5b         | JUMPDEST  | â†â—   | ...
   ...
```

**Block Header Format:**
- `gas: N` - Total gas for block (sequential execution)
- `stack: [min, max]` - Min required, max reached
- `len: N` - Instruction count

**Block Markers:**
- `â— Begin` - Marks JUMPDEST blocks (entry points)
- Blank line separates blocks visually

## Jump Visualization

Jump instructions show arrows connecting to targets:

```
  12 |   45 |     2 | 60 32        | PUSH1     | â”â†’50 | 0x32 (50)
  13 |   47 |     3 | 56           | JUMP      |     | [unconditional jump]
  ...
  15 |   50 |     2 | â— 5b         | JUMPDEST  | â†â—  | [target: PC=50]
```

**Jump Symbols:**
- `â”â†’N` - Forward jump (down in code) to PC N
- `â”˜â†’N` - Backward jump (up in code) to PC N
- `â†â—` - Jump target (valid JUMPDEST)
- `â†âœ—` - **Invalid jump target** (not JUMPDEST) - highlights bugs!
- `â†’?` - Jump target unknown or outside bytecode

<Warning title="Invalid Jump Detection">
Pretty print highlights jumps to non-JUMPDEST locations with red `âœ—` marker. This indicates malformed bytecode that will revert at runtime.
</Warning>

## Fusion Annotations

Detected fusion patterns annotated inline:

```
   1 |    0 |     0 | âš¡ 60 01        | PUSH1     |      | 0x1 âš¡ PUSH+ADD
   2 |    2 |     1 | 01             | ADD       |      | [gas: 3]
```

**Fusion Markers:**
- `âš¡` prefix on hex column - Fusion opportunity
- `âš¡ PUSH+ADD` suffix - Pattern type
- Green background for fusion marker

See [Fusion Detection](/primitives/bytecode/detect-fusions) for all 20+ patterns.

## Inline Metadata

### PUSH Values

```
PUSH1     |      | 0x42 (66) [gas: 3]
```

Shows both hex (`0x42`) and decimal (`66`) for values â‰¤ 0xFFFF.

### Gas Costs

```
SSTORE    |      | [gas: 20000]
```

Base gas cost from [Opcode.getGasCost()](/primitives/opcode/getGasCost).

### Stack Effects

```
ADD       |      | [gas: 3] [stack: -2, +1]
```

Shows inputs consumed (`-2`) and outputs produced (`+1`).

### Jump Targets

```
JUMPDEST  | â†â—   | [target: PC=50] [gas: 1]
```

Shows this is a valid jump destination at PC 50.

## Summary Section

Footer shows aggregate statistics:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘            Summary                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ˆ Basic blocks: 5
ğŸ¯ Jump destinations: 3
â¡ï¸  Unconditional jumps: 2
â“ Conditional jumps: 1
âš ï¸  Invalid jumps: 1 (!)
âš¡ Fusion candidates: 4
ğŸ“ Total instructions: 47
âš ï¸  Final stack depth: 2 (expected 0)
```

**Warnings:**
- `âš ï¸ Invalid jumps` - Jumps to non-JUMPDEST (red, critical)
- `âš ï¸ Final stack depth` - Non-zero final depth (yellow, warning)
- `âŒ Stack underflow` - Popping from empty stack (red, critical)

## Comparison with formatInstructions

| Feature | prettyPrint() | formatInstructions() |
|---------|---------------|---------------------|
| ANSI colors | âœ… | âŒ |
| Gas costs | âœ… | âŒ |
| Stack depth | âœ… | âŒ |
| Block boundaries | âœ… | âŒ |
| Jump arrows | âœ… | âŒ |
| Fusion detection | âœ… | âŒ |
| Summary stats | âœ… | âŒ |
| Array output | âŒ | âœ… |
| Parseable | âŒ | âœ… |

**Use `prettyPrint()` for:**
- Debugging and visualization
- Terminal output
- Understanding control flow
- Gas analysis
- Educational purposes

**Use `formatInstructions()` for:**
- Programmatic parsing
- Simple disassembly
- Integration with other tools
- Machine-readable output

## Advanced Usage

### Debug Specific Range

```typescript
// Extract and print specific block
const instructions = code.parseInstructions();
const blockInsts = instructions.filter(inst =>
  inst.position >= 100 && inst.position < 150
);

// Create temporary bytecode from range
const range = code.raw().slice(100, 150);
const blockCode = Bytecode.from(range);
console.log(blockCode.prettyPrint());
```

### Compare Bytecode Versions

```typescript
const v1 = Bytecode.fromHex(contractV1Bytecode);
const v2 = Bytecode.fromHex(contractV2Bytecode);

console.log("=== Version 1 ===");
console.log(v1.prettyPrint({ colors: false }));

console.log("\n=== Version 2 ===");
console.log(v2.prettyPrint({ colors: false }));
```

### Extract Function Bodies

```typescript
// Find function dispatch pattern
const functions = new Map<number, number>();
for (const inst of code.scan({ detectFusions: true })) {
  if (inst.type === 'function_dispatch') {
    functions.set(inst.selector, Number(inst.target));
  }
}

// Print each function
functions.forEach((target, selector) => {
  console.log(`\n=== Function 0x${selector.toString(16)} ===`);

  // Find block ending at target
  const blocks = code.analyzeBlocks();
  const funcBlock = blocks.find(b => b.startPc === target);

  if (funcBlock) {
    const funcCode = code.raw().slice(funcBlock.startPc, funcBlock.endPc);
    console.log(Bytecode.from(funcCode).prettyPrint());
  }
});
```

### Integration with Logger

```typescript
import { createLogger } from 'your-logger';

const logger = createLogger();

// Conditional pretty print based on log level
if (logger.level === 'debug') {
  logger.debug('Bytecode analysis:\n' + code.prettyPrint());
} else {
  logger.info(`Bytecode size: ${code.size()} bytes`);
}
```

## Terminal Compatibility

### Color Support Detection

```typescript
import { supportsColor } from 'supports-color';

const useColors = supportsColor.stdout !== false;

const output = code.prettyPrint({ colors: useColors });
```

### Width Detection

```typescript
const termWidth = process.stdout.columns || 120;

const output = code.prettyPrint({
  maxWidth: termWidth,
  compact: termWidth < 100
});
```

### Unicode Fallback

If terminal doesn't support Unicode box-drawing characters:

```typescript
const output = code.prettyPrint({ unicode: false });

// Uses ASCII instead:
// +======================================+
// |     EVM Bytecode Disassembly         |
// +======================================+
```

## Performance

Pretty printing is optimized for readability over speed:

- **Small bytecode (<1KB)**: <5ms
- **Medium bytecode (10KB)**: ~50ms
- **Large bytecode (24KB)**: ~120ms

<Note>
Use `formatInstructions()` if performance is critical and visual output not needed.
</Note>

## See Also

- [formatInstructions](/primitives/bytecode/formatInstructions) - Simple array-based disassembly
- [analyzeBlocks](/primitives/bytecode/analyze-blocks) - Block metadata used in output
- [detectFusions](/primitives/bytecode/detect-fusions) - Fusion patterns annotated
- [scan](/primitives/bytecode/scan) - Underlying iterator
