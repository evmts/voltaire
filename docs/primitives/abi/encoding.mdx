---
title: ABI Encoding & Decoding
description: Understanding Ethereum ABI encoding and decoding mechanics
---

<Card title="Try it Live" icon="play" href="https://playground.tevm.sh?example=primitives/abi.ts">
  Run ABI examples in the interactive playground
</Card>

<Info>
**Conceptual guide** - For API reference, see [ABI API](/primitives/abi/index). For item shapes and parameters, see [ABI Types](/primitives/abi/types).
</Info>

## Overview

ABI encoding serializes typed values into 32-byte words so the EVM can interpret calldata, return data, events, and errors. The encoding model uses a **head** (static data and offsets) plus an optional **tail** (dynamic data).

## Head/Tail Layout

Static values encode directly in the head. Dynamic values encode as offsets to their data in the tail.

```
[ head (N * 32 bytes) ] [ tail (dynamic data) ]
   | static values
   | offsets for dynamic values -> point into tail (relative to head start)
```

Offsets are **byte offsets** from the start of the arguments block (right after the function selector, if present).

## Static Types

Static types always occupy a full 32-byte word:

- Integers (`uint*`, `int*`) are **left-padded** with zeros
- `address` is **left-padded** (20 bytes right-aligned in a 32-byte word)
- `bool` is `0` or `1` in a 32-byte word
- `bytesN` (N <= 32) are **right-padded** with zeros

```typescript
import { Abi } from '@tevm/voltaire/Abi';

const params = [
  { type: 'address' },
  { type: 'uint256' },
  { type: 'bytes32' }
] as const;

const encoded = Abi.encodeParameters(params, [
  '0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e',
  42n,
  '0x' + 'ab'.repeat(32)
]);
```

## Dynamic Types

Dynamic types store an offset in the head, and the tail holds `length + data`:

- `bytes`, `string`
- Dynamic arrays (`T[]`)
- Tuples that contain dynamic components

```typescript
import { Abi } from '@tevm/voltaire/Abi';

const params = [
  { type: 'string' },
  { type: 'bytes' },
  { type: 'uint256[]' }
] as const;

const encoded = Abi.encodeParameters(params, [
  'hello',
  new Uint8Array([0xaa, 0xbb]),
  [1n, 2n, 3n]
]);
```

## Offsets and Padding (Worked Example)

Encoding `register(address,string,uint256)`:

```typescript
import { Abi } from '@tevm/voltaire/Abi';

const params = [
  { type: 'address', name: 'user' },
  { type: 'string', name: 'name' },
  { type: 'uint256', name: 'age' }
] as const;

const encoded = Abi.encodeParameters(params, [
  '0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e',
  'alice',
  25n
]);
```

Layout (offsets relative to the start of the args block):

```
0x00: address (32 bytes)
0x20: offset to string data (0x60)
0x40: uint256 age
0x60: string length (5)
0x80: string bytes ("alice") padded to 32-byte boundary
```

## Arrays and Tuples

### Arrays

- Fixed arrays (`T[3]`) encode elements sequentially
- Dynamic arrays (`T[]`) encode length + elements
- Arrays of dynamic types store **offsets per element**

```typescript
import { Abi } from '@tevm/voltaire/Abi';

const params = [
  { type: 'uint256[3]' },
  { type: 'string[]' }
] as const;

const encoded = Abi.encodeParameters(params, [
  [1n, 2n, 3n],
  ['a', 'bb']
]);
```

### Tuples

Tuples use `components` to describe struct fields. A tuple is static only if all components are static.

```typescript
import { Abi } from '@tevm/voltaire/Abi';

const params = [
  {
    type: 'tuple',
    components: [
      { type: 'address', name: 'owner' },
      { type: 'uint256', name: 'amount' }
    ]
  }
] as const;

const encoded = Abi.encodeParameters(params, [
  { owner: '0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e', amount: 1000n }
]);
```

## Function Calldata and Return Data

Function calls prepend the selector (first 4 bytes of the signature hash) to the encoded parameters.

```typescript
import { Abi } from '@tevm/voltaire/Abi';

const transfer = {
  type: 'function',
  name: 'transfer',
  inputs: [
    { type: 'address', name: 'to' },
    { type: 'uint256', name: 'amount' }
  ],
  outputs: [{ type: 'bool' }]
} as const;

const calldata = Abi.Function.encodeParams(transfer, [
  '0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e',
  1000n
]);
```

Return data does **not** include a selector. It is just ABI-encoded outputs:

```typescript
const result = Abi.Function.decodeResult(transfer, returnData);
```

## Events and Topics

Events split data into indexed topics and non-indexed data:

- `topic0` is the event selector (unless `anonymous: true`)
- Indexed parameters become topics
- Dynamic indexed types are **keccak256-hashed** and stored as topics

```typescript
import { Abi } from '@tevm/voltaire/Abi';

const transferEvent = {
  type: 'event',
  name: 'Transfer',
  inputs: [
    { type: 'address', name: 'from', indexed: true },
    { type: 'address', name: 'to', indexed: true },
    { type: 'uint256', name: 'value' }
  ]
} as const;

const topics = Abi.Event.encodeTopics(transferEvent, {
  from: '0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e',
  to: '0x5B38Da6a701c568545dCfcB03FcB875f56beddC4'
});
```

## Errors

Custom errors encode like functions: `selector (4 bytes) + params`.

```typescript
import { Abi } from '@tevm/voltaire/Abi';

const InsufficientBalance = {
  type: 'error',
  name: 'InsufficientBalance',
  inputs: [
    { type: 'uint256', name: 'balance' },
    { type: 'uint256', name: 'required' }
  ]
} as const;

const errorData = Abi.Error.encodeParams(InsufficientBalance, [100n, 1000n]);
```

## Packed Encoding

Standard ABI encoding pads values to 32-byte words. Packed encoding (Solidity `abi.encodePacked`) removes padding and uses tighter concatenation. If you need packed encoding, use `Abi.encodePacked` or encode manually depending on your constraints.

## Common Pitfalls

- Offsets are relative to the **start of the args block**, not the start of calldata
- `uint` and `int` should be normalized to `uint256` and `int256` in signatures
- Fixed bytes (`bytesN`) are right-padded, integers and addresses are left-padded
- Indexed **dynamic** event params are hashed (you cannot recover the original value from a topic alone)
- Overloaded function names require selecting the exact ABI item

## See Also

- [ABI Types](/primitives/abi/types)
- [Selectors](/primitives/abi/selectors)
- [Abi.encode](/primitives/abi/encode)
- [Abi.decode](/primitives/abi/decode)
- [Function.encodeParams](/primitives/abi/function-encode-params)
- [Event.decodeLog](/primitives/abi/event-decode-log)
