---
title: "DUP13 (0x8C)"
description: "Duplicate 13th stack item"
---

## Overview

**Opcode:** `0x8C`
**Introduced:** Frontier (EVM genesis)

DUP13 duplicates the 13th stack item and pushes it to the top of the stack. The original 13th item remains in place.

## Specification

**Stack Input:**
```
[..., value, item12, ..., item1]
```

**Stack Output:**
```
[..., value, item12, ..., item1, value]
```

**Gas Cost:** 3 (GasFastestStep)

**Operation:**
```
value = stack[depth - 13]
stack.push(value)
```

## Behavior

DUP13 copies the 13th-from-top stack item without removing it. Requires stack depth ≥ 13.

Key characteristics:
- Requires stack depth ≥ 13
- Original value unchanged
- New copy pushed to top
- StackUnderflow if depth < 13
- Stack depth increases by 1

## Examples

### Basic Usage

```typescript
import { handler_0x8C_DUP13 } from '@tevm/voltaire/evm/stack/handlers';
import { createFrame } from '@tevm/voltaire/evm/Frame';

// Duplicate 13th item
const frame = createFrame({
  stack: [1300n, 1200n, 1100n, 1000n, 900n, 800n, 700n, 600n, 500n, 400n, 300n, 200n, 100n],
  gasRemaining: 1000n
});

const err = handler_0x8C_DUP13(frame);

console.log(frame.stack); // [1300n, 1200n, 1100n, 1000n, 900n, 800n, 700n, 600n, 500n, 400n, 300n, 200n, 100n, 100n] - 13th item duplicated
console.log(frame.gasRemaining); // 997n (3 gas consumed)
```

### Solidity Compilation

```solidity
contract Example {
    function deepAccess() public pure {
        // Access deep stack value
        assembly {
            // Stack has 13 items
            dup13  // Duplicate 13th item to top
        }
    }
}
```

### Assembly Usage

```solidity
assembly {
    push1 0x01
    push1 0x02
    push1 0x03
    push1 0x04
    push1 0x05
    push1 0x06
    push1 0x07
    push1 0x08
    push1 0x09
    push1 0x0a
    push1 0x0b
    push1 0x0c
    push1 0x0d
    // Stack: [0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d]

    dup13
    // Stack: [0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x01] - first item duplicated
}
```

## Gas Cost

**Cost:** 3 gas (GasFastestStep)

All DUP1-16 operations cost the same despite different stack depths accessed.

**Comparison:**
| Operation | Gas | Note |
|-----------|-----|------|
| DUP13 | 3 | Duplicate 13th item |
| PUSH1-32 | 3 | Same cost tier |
| POP | 2 | Cheaper |

## Common Usage

### Deep Stack Access

```solidity
function complex() public pure {
    assembly {
        // Build deep stack
        let v1 := 1
        let v2 := 2
        let v3 := 3
        let v4 := 4
        let v5 := 5
        let v6 := 6
        let v7 := 7
        let v8 := 8
        let v9 := 9
        let v10 := 10
        let v11 := 11
        let v12 := 12
        let v13 := 13

        // Access v1 from depth 13
        dup13
    }
}```

### Efficient Copies

```solidity
// Instead of multiple loads
assembly {
    let value := sload(slot)  // Expensive
    // Use value
    let value2 := sload(slot) // Wasteful!
}

// Use DUP to reuse
assembly {
    let value := sload(slot)  // Load once
    dup1                       // Copy
    // Use both copies
}
```

### Conditional Logic

```solidity
assembly {
    let condition := calldataload(0)
    dup1  // Keep condition for later
    iszero
    jumpi(skip)
    // Use condition again
    skip:
}
```

## Stack Depth Requirements

### Minimum Depth

```solidity
// DUP13 requires 13 items on stack
assembly {
    push1 0x01
    push1 0x02
    push1 0x03
    push1 0x04
    push1 0x05
    push1 0x06
    push1 0x07
    push1 0x08
    push1 0x09
    push1 0x0a
    push1 0x0b
    push1 0x0c
    // Only 12 items - DUP13 will fail!
    dup13  // StackUnderflow
}
```

### Safe Usage

```solidity
assembly {
    push1 0x01
    push1 0x02
    push1 0x03
    push1 0x04
    push1 0x05
    push1 0x06
    push1 0x07
    push1 0x08
    push1 0x09
    push1 0x0a
    push1 0x0b
    push1 0x0c
    push1 0x0d
    // Exactly 13 items - safe
    dup13  // Success
}
```

## Implementation

<Tabs>
<Tab title="TypeScript">
```typescript
/**
 * DUP13 opcode (0x8C) - Duplicate 13th stack item
 *
 * Stack: [..., value, ...] => [..., value, ..., value]
 * Gas: 3 (GasFastestStep)
 */
export function handler_0x8C_DUP13(frame: BrandedFrame): EvmError | null {
  const gasErr = consumeGas(frame, FastestStep);
  if (gasErr) return gasErr;

  if (frame.stack.length < 13) {
    return { type: "StackUnderflow" };
  }

  const value = frame.stack[frame.stack.length - 13];
  const pushErr = pushStack(frame, value);
  if (pushErr) return pushErr;

  frame.pc += 1;
  return null;
}
```
</Tab>

<Tab title="Zig">
```zig
/// DUP13 opcode (0x8C) - Duplicate 13th stack item
pub fn dup(frame: *FrameType, opcode: u8) FrameType.EvmError!void {
    try frame.consumeGas(GasConstants.GasFastestStep);
    const n = opcode - 0x7f;
    if (frame.stack.items.len < n) {
        return error.StackUnderflow;
    }
    const value = frame.stack.items[frame.stack.items.len - n];
    try frame.pushStack(value);
    frame.pc += 1;
}
```
</Tab>
</Tabs>

## Edge Cases

### Stack Underflow

```typescript
// Insufficient stack depth
const frame = createFrame({
  stack: [100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n]  // Only 12 items
});

const err = handler_0x8C_DUP13(frame);
console.log(err); // { type: "StackUnderflow" }
```

### Stack Overflow

```typescript
// Stack at maximum, can't add more
const frame = createFrame({
  stack: new Array(1024).fill(0n)
});

const err = handler_0x8C_DUP13(frame);
console.log(err); // { type: "StackOverflow" }
```

### Out of Gas

```typescript
// Insufficient gas
const frame = createFrame({
  stack: [100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n, 100n],
  gasRemaining: 2n  // Need 3
});

const err = handler_0x8C_DUP13(frame);
console.log(err); // { type: "OutOfGas" }
```

### Maximum Value

```typescript
// Duplicate max uint256
const MAX = (1n << 256n) - 1n;
const frame = createFrame({
  stack: [0n, 0n, 0n, 0n, 0n, 0n, 0n, 0n, 0n, 0n, 0n, 0n, MAX]
});

handler_0x8C_DUP13(frame);
console.log(frame.stack[frame.stack.length - 1]); // MAX (duplicated)
```

## References

- [Yellow Paper](https://ethereum.github.io/yellowpaper/paper.pdf) - Section 9.1 (Stack Operations)
- [EVM Codes - DUP13](https://www.evm.codes/#8c?fork=cancun)
- [Solidity Assembly - dup13](https://docs.soliditylang.org/en/latest/yul.html#evm-opcodes)
