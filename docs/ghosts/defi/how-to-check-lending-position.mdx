---
title: How to Check Lending Position
description: Query lending protocol positions on Aave and Compound to check collateral, debt, and health factor.
---

## Goal

Check your current lending position including supplied assets, borrowed amounts, and health factor.

Return as:

ANSWER: Collateral: $X | Debt: $Y | Health Factor: Z

## Concepts

Lending protocols like Aave and Compound allow:
- **Supplying**: Deposit assets to earn interest
- **Borrowing**: Borrow against your collateral
- **Health Factor**: Ratio of collateral value to debt (< 1 = liquidatable)

**Key metrics**:
- Total Collateral (in base currency)
- Total Debt (in base currency)
- Available to Borrow
- Liquidation Threshold
- Health Factor (Aave) or Account Liquidity (Compound)

## Aave V3 Example

```ts
import { Contract } from '@tevm/voltaire/contract'

const poolAbi = [
  {
    type: 'function',
    name: 'getUserAccountData',
    stateMutability: 'view',
    inputs: [{ name: 'user', type: 'address' }],
    outputs: [
      { name: 'totalCollateralBase', type: 'uint256' },
      { name: 'totalDebtBase', type: 'uint256' },
      { name: 'availableBorrowsBase', type: 'uint256' },
      { name: 'currentLiquidationThreshold', type: 'uint256' },
      { name: 'ltv', type: 'uint256' },
      { name: 'healthFactor', type: 'uint256' }
    ]
  }
] as const

// Aave V3 Pool on Ethereum Mainnet
const AAVE_POOL = '0x87870Bca3F3fD6335C3F4ce8392D69350B4fA4E2'

const pool = Contract({
  address: AAVE_POOL,
  abi: poolAbi,
  provider
})

const userData = await pool.read.getUserAccountData(myAddress)

const collateral = Number(userData[0]) / 1e8 // Base currency has 8 decimals
const debt = Number(userData[1]) / 1e8
const healthFactor = Number(userData[5]) / 1e18

console.log(`ANSWER: Collateral: $${collateral.toFixed(2)} | Debt: $${debt.toFixed(2)} | Health Factor: ${healthFactor.toFixed(2)}`)
```

## Compound V3 Example

```ts
const cometAbi = [
  {
    type: 'function',
    name: 'balanceOf',
    stateMutability: 'view',
    inputs: [{ name: 'account', type: 'address' }],
    outputs: [{ name: '', type: 'uint256' }]
  },
  {
    type: 'function',
    name: 'borrowBalanceOf',
    stateMutability: 'view',
    inputs: [{ name: 'account', type: 'address' }],
    outputs: [{ name: '', type: 'uint256' }]
  },
  {
    type: 'function',
    name: 'collateralBalanceOf',
    stateMutability: 'view',
    inputs: [
      { name: 'account', type: 'address' },
      { name: 'asset', type: 'address' }
    ],
    outputs: [{ name: '', type: 'uint128' }]
  },
  {
    type: 'function',
    name: 'isLiquidatable',
    stateMutability: 'view',
    inputs: [{ name: 'account', type: 'address' }],
    outputs: [{ name: '', type: 'bool' }]
  }
] as const

// Compound V3 USDC Comet on Mainnet
const COMET_USDC = '0xc3d688B66703497DAA19211EEdff47f25384cdc3'

const comet = Contract({
  address: COMET_USDC,
  abi: cometAbi,
  provider
})

const supplied = await comet.read.balanceOf(myAddress)
const borrowed = await comet.read.borrowBalanceOf(myAddress)
const isLiquidatable = await comet.read.isLiquidatable(myAddress)

console.log(`Supplied: ${Number(supplied) / 1e6} USDC`)
console.log(`Borrowed: ${Number(borrowed) / 1e6} USDC`)
console.log(`Liquidatable: ${isLiquidatable}`)
```

## Get All Aave Positions

```ts
const dataProviderAbi = [
  {
    type: 'function',
    name: 'getUserReservesData',
    stateMutability: 'view',
    inputs: [
      { name: 'provider', type: 'address' },
      { name: 'user', type: 'address' }
    ],
    outputs: [
      {
        name: '',
        type: 'tuple[]',
        components: [
          { name: 'underlyingAsset', type: 'address' },
          { name: 'scaledATokenBalance', type: 'uint256' },
          { name: 'usageAsCollateralEnabledOnUser', type: 'bool' },
          { name: 'scaledVariableDebt', type: 'uint256' }
        ]
      }
    ]
  }
] as const

const DATA_PROVIDER = '0x7B4EB56E7CD4b454BA8ff71E4518426369a138a3'
const POOL_PROVIDER = '0x2f39d218133AFaB8F2B819B1066c7E434Ad94E9e'

const dataProvider = Contract({
  address: DATA_PROVIDER,
  abi: dataProviderAbi,
  provider
})

const reserves = await dataProvider.read.getUserReservesData(POOL_PROVIDER, myAddress)
// Filter for positions with balance
const activePositions = reserves.filter(
  r => r.scaledATokenBalance > 0n || r.scaledVariableDebt > 0n
)
```

## Notes

- Health Factor < 1 means position can be liquidated
- Aave uses 8 decimals for base currency (USD)
- Monitor positions and set up alerts for low health factor
- Consider automating rebalancing or adding collateral when health drops
