---
title: '[TS/JS] voltaire-effect/src/services/Transport/TransportConfig.test.ts'
source: 'voltaire-effect/src/services/Transport/TransportConfig.test.ts'
---

> Auto-generated from test file: voltaire-effect/src/services/Transport/TransportConfig.test.ts

```typescript
import { describe, expect, it } from "@effect/vitest";
import * as ConfigProvider from "effect/ConfigProvider";
import * as Duration from "effect/Duration";
import * as Effect from "effect/Effect";
import * as Layer from "effect/Layer";
import * as Secret from "effect/Secret";
import { QuickConfig, TransportConfig } from "./index.js";

describe("TransportConfig", () => {
	it("parses config from provider", async () => {
		const configProvider = ConfigProvider.fromMap(
			new Map([
				["rpc.url", "https://mainnet.infura.io/v3/KEY"],
				["rpc.timeout", "60 seconds"],
				["rpc.retryMaxAttempts", "5"],
				["rpc.retryBaseDelay", "2 seconds"],
			]),
		);

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("https://mainnet.infura.io/v3/KEY");
		expect(Duration.toMillis(config.timeout)).toBe(60000);
		expect(config.retryMaxAttempts).toBe(5);
		expect(Duration.toMillis(config.retryBaseDelay)).toBe(2000);
	});

	it("uses defaults for optional fields", async () => {
		const configProvider = ConfigProvider.fromMap(
			new Map([["rpc.url", "https://rpc.example.com"]]),
		);

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("https://rpc.example.com");
		expect(Duration.toMillis(config.timeout)).toBe(30000);
		expect(config.retryMaxAttempts).toBe(3);
		expect(Duration.toMillis(config.retryBaseDelay)).toBe(1000);
	});

	it("validates URL scheme", async () => {
		const configProvider = ConfigProvider.fromMap(
			new Map([["rpc.url", "ftp://invalid.com"]]),
		);

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const exit = await Effect.runPromiseExit(program);
		expect(exit._tag).toBe("Failure");
	});

	it("accepts http scheme", async () => {
		const configProvider = ConfigProvider.fromMap(
			new Map([["rpc.url", "http://localhost:8545"]]),
		);

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("http://localhost:8545");
	});

	it("accepts https scheme", async () => {
		const configProvider = ConfigProvider.fromMap(
			new Map([["rpc.url", "https://mainnet.infura.io"]]),
		);

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("https://mainnet.infura.io");
	});

	it("accepts ws scheme", async () => {
		const configProvider = ConfigProvider.fromMap(
			new Map([["rpc.url", "ws://localhost:8545"]]),
		);

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("ws://localhost:8545");
	});

	it("accepts wss scheme", async () => {
		const configProvider = ConfigProvider.fromMap(
			new Map([["rpc.url", "wss://mainnet.infura.io/ws/v3/KEY"]]),
		);

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("wss://mainnet.infura.io/ws/v3/KEY");
	});

	it("handles optional apiKey as Secret", async () => {
		const configProvider = ConfigProvider.fromMap(
			new Map([
				["rpc.url", "https://rpc.example.com"],
				["rpc.apiKey", "my-secret-key"],
			]),
		);

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.apiKey._tag).toBe("Some");
		if (config.apiKey._tag === "Some") {
			expect(Secret.value(config.apiKey.value)).toBe("my-secret-key");
		}
	});
});

describe("QuickConfig", () => {
	it("creates infura mainnet config", async () => {
		const configProvider = QuickConfig.infuraMainnet("MY_KEY");

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("https://mainnet.infura.io/v3/MY_KEY");
	});

	it("creates alchemy mainnet config", async () => {
		const configProvider = QuickConfig.alchemyMainnet("MY_KEY");

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("https://eth-mainnet.g.alchemy.com/v2/MY_KEY");
	});

	it("creates localhost config", async () => {
		const configProvider = QuickConfig.localhost();

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("http://localhost:8545");
	});

	it("creates localhost config with custom port", async () => {
		const configProvider = QuickConfig.localhost(9545);

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("http://localhost:9545");
	});

	it("creates anvil config", async () => {
		const configProvider = QuickConfig.anvil();

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("http://localhost:8545");
	});

	it("creates hardhat config", async () => {
		const configProvider = QuickConfig.hardhat();

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("http://localhost:8545");
	});

	it("creates ganache config", async () => {
		const configProvider = QuickConfig.ganache();

		const program = Effect.gen(function* () {
			const config = yield* TransportConfig;
			return config;
		}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)));

		const config = await Effect.runPromise(program);
		expect(config.url).toBe("http://localhost:7545");
	});
});

```
