---
title: P256 Tests
description: Test examples for P256 (secp256r1) showing ECDSA signing and verification.
---

## Sign a Message Hash

Signs a 32-byte message hash with a P256 private key, returning r and s values.

```typescript
import { Effect } from 'effect'
import * as P256Effect from 'voltaire-effect/crypto/P256'
import * as VoltaireP256 from '@tevm/voltaire/P256'
import { Hash } from '@tevm/voltaire'

const testPrivateKey = VoltaireP256.randomPrivateKey()
const testMessageHashBytes = new Uint8Array(32).fill(0xab)
const testMessageHash = Hash.from(testMessageHashBytes)

const program = Effect.gen(function* () {
  const result = yield* P256Effect.sign(testMessageHash, testPrivateKey)
  // result.r is Uint8Array of length 32
  // result.s is Uint8Array of length 32
})
```

## Deterministic Signatures (RFC 6979)

P256 produces deterministic signatures per RFC 6979.

```typescript
import { Effect } from 'effect'
import * as P256Effect from 'voltaire-effect/crypto/P256'
import * as VoltaireP256 from '@tevm/voltaire/P256'
import { Hash } from '@tevm/voltaire'

const testPrivateKey = VoltaireP256.randomPrivateKey()
const testMessageHash = Hash.from(new Uint8Array(32).fill(0xab))

const program = Effect.gen(function* () {
  const sig1 = yield* P256Effect.sign(testMessageHash, testPrivateKey)
  const sig2 = yield* P256Effect.sign(testMessageHash, testPrivateKey)
  // sig1.r equals sig2.r
  // sig1.s equals sig2.s
})
```

## Verify a Signature

Verifies a P256 signature against a message hash and public key.

```typescript
import { Effect } from 'effect'
import * as P256Effect from 'voltaire-effect/crypto/P256'
import * as VoltaireP256 from '@tevm/voltaire/P256'
import { Hash } from '@tevm/voltaire'

const testPrivateKey = VoltaireP256.randomPrivateKey()
const testPublicKey = VoltaireP256.derivePublicKey(testPrivateKey)
const testMessageHash = Hash.from(new Uint8Array(32).fill(0xab))

const program = Effect.gen(function* () {
  const signature = yield* P256Effect.sign(testMessageHash, testPrivateKey)
  const isValid = yield* P256Effect.verify(signature, testMessageHash, testPublicKey)
  // isValid is true
})
```

## Service Layer Usage

Uses the P256Service with dependency injection.

```typescript
import { Effect } from 'effect'
import { P256Service, P256Live } from 'voltaire-effect/crypto/P256'
import * as VoltaireP256 from '@tevm/voltaire/P256'
import { Hash } from '@tevm/voltaire'

const testPrivateKey = VoltaireP256.randomPrivateKey()
const testPublicKey = VoltaireP256.derivePublicKey(testPrivateKey)
const testMessageHash = Hash.from(new Uint8Array(32).fill(0xab))

const program = Effect.gen(function* () {
  const p256 = yield* P256Service
  const sig = yield* p256.sign(testMessageHash, testPrivateKey)
  const result = yield* p256.verify(sig, testMessageHash, testPublicKey)
  // result is true
}).pipe(Effect.provide(P256Live))
```

## Full Sign-Verify Round Trip

Demonstrates a complete signing and verification flow with random keys.

```typescript
import { Effect } from 'effect'
import * as P256Effect from 'voltaire-effect/crypto/P256'
import * as VoltaireP256 from '@tevm/voltaire/P256'
import { Hash } from '@tevm/voltaire'

const program = Effect.gen(function* () {
  const privateKey = VoltaireP256.randomPrivateKey()
  const publicKey = VoltaireP256.derivePublicKey(privateKey)
  const messageHash = Hash.from(new Uint8Array(32).fill(0xcd))
  
  const signature = yield* P256Effect.sign(messageHash, privateKey)
  const isValid = yield* P256Effect.verify(signature, messageHash, publicKey)
  // isValid is true
})
```

## Accept Raw Uint8Array Hash

P256 sign and verify accept raw Uint8Array in addition to Hash type.

```typescript
import { Effect } from 'effect'
import * as P256Effect from 'voltaire-effect/crypto/P256'
import * as VoltaireP256 from '@tevm/voltaire/P256'

const testPrivateKey = VoltaireP256.randomPrivateKey()
const testPublicKey = VoltaireP256.derivePublicKey(testPrivateKey)

const program = Effect.gen(function* () {
  const rawHash = new Uint8Array(32).fill(0xef)
  const result = yield* P256Effect.sign(rawHash, testPrivateKey)
  const isValid = yield* P256Effect.verify(result, rawHash, testPublicKey)
  // isValid is true
})
```
