---
title: decodeError Tests
description: Test examples for decoding error data from ABI-encoded hex.
---

## Round-trips InsufficientBalance error

Encodes then decodes custom error with uint256 arguments.

```typescript
import { describe, expect, it } from "@effect/vitest"
import { Hex } from "voltaire"
import * as Effect from "effect/Effect"
import * as S from "effect/Schema"
import * as Abi from "voltaire-effect/primitives/Abi"

const customAbi = S.decodeUnknownSync(Abi.fromArray)([
  {
    type: "error",
    name: "InsufficientBalance",
    inputs: [
      { name: "available", type: "uint256" },
      { name: "required", type: "uint256" },
    ],
  },
  {
    type: "error",
    name: "Unauthorized",
    inputs: [{ name: "caller", type: "address" }],
  },
  {
    type: "error",
    name: "InvalidAmount",
    inputs: [],
  },
])

it.effect("round-trips InsufficientBalance error", () =>
  Effect.gen(function* () {
    const available = 100n
    const required = 200n
    const encoded = yield* Abi.encodeError(customAbi, "InsufficientBalance", [
      available,
      required,
    ])
    const decoded = yield* Abi.decodeError(
      customAbi,
      "InsufficientBalance",
      encoded,
    )
    expect(decoded[0]).toBe(available)
    expect(decoded[1]).toBe(required)
  }),
)
```

## Round-trips Unauthorized error with address

Encodes then decodes error with address argument.

```typescript
it.effect("round-trips Unauthorized error with address", () =>
  Effect.gen(function* () {
    const caller = "0x742d35Cc6634C0532925a3b844Bc9e7595f251e3"
    const encoded = yield* Abi.encodeError(customAbi, "Unauthorized", [caller])
    const decoded = yield* Abi.decodeError(customAbi, "Unauthorized", encoded)
    expect((decoded[0] as string).toLowerCase()).toBe(caller.toLowerCase())
  }),
)
```

## Round-trips error with no inputs

Handles errors that have no input parameters.

```typescript
it.effect("round-trips error with no inputs", () =>
  Effect.gen(function* () {
    const encoded = yield* Abi.encodeError(customAbi, "InvalidAmount", [])
    const decoded = yield* Abi.decodeError(customAbi, "InvalidAmount", encoded)
    expect(decoded.length).toBe(0)
  }),
)
```

## Fails for unknown error

Returns failure when error name doesn't exist in ABI.

```typescript
import * as Exit from "effect/Exit"

it("fails for unknown error", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.decodeError(customAbi, "UnknownError", Hex("0x00000000")),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})
```
