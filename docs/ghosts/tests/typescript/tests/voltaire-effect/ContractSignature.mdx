---
title: ContractSignature Tests
description: Test examples for ContractSignature showing ERC-1271 smart contract signature verification.
---

## Validate Input Structure

Validates contract signature verification input with hash, signature, and expected signer.

```typescript
import * as Schema from "effect/Schema"
import * as ContractSignature from "voltaire-effect/primitives/ContractSignature"

const input = {
  hash: new Uint8Array(32).fill(1),
  signature: new Uint8Array(65).fill(2),
  expectedSigner: new Uint8Array(20).fill(3),
  returnData: new Uint8Array(32).fill(4),
}
const result = Schema.decodeSync(ContractSignature.Struct)(input)
expect(result.hash).toEqual(input.hash)
expect(result.signature).toEqual(input.signature)
```

## Check ERC-1271 Magic Value

Verifies that return data matches the ERC-1271 magic value (0x1626ba7e).

```typescript
import * as ContractSignature from "voltaire-effect/primitives/ContractSignature"

const magicValue = new Uint8Array([0x16, 0x26, 0xba, 0x7e])
expect(ContractSignature.checkReturnData(magicValue)).toBe(true)

const wrongValue = new Uint8Array([0x00, 0x00, 0x00, 0x00])
expect(ContractSignature.checkReturnData(wrongValue)).toBe(false)

const shortData = new Uint8Array([0x16, 0x26])
expect(ContractSignature.checkReturnData(shortData)).toBe(false)
```

## Error Types

SignatureVerificationError and InvalidSignatureFormatError are catchable Effect errors.

```typescript
import * as Effect from "effect/Effect"
import * as ContractSignature from "voltaire-effect/primitives/ContractSignature"

const error = new ContractSignature.SignatureVerificationError({
  input: { address: "0x123", hash: new Uint8Array(32) },
  message: "test error",
})

const program = Effect.fail(error).pipe(
  Effect.catchTag("SignatureVerificationError", (e) =>
    Effect.succeed(`caught: ${e.message}`)
  ),
)

const result = await Effect.runPromise(program)
expect(result).toBe("caught: test error")
```

## Error Tag Verification

Errors have correct _tag for Effect error handling.

```typescript
import * as ContractSignature from "voltaire-effect/primitives/ContractSignature"

const formatError = new ContractSignature.InvalidSignatureFormatError({
  message: "bad format",
})
expect(formatError._tag).toBe("InvalidSignatureFormatError")

const verifyError = new ContractSignature.SignatureVerificationError({
  input: { address: "0x123", hash: new Uint8Array(32) },
  message: "verification failed",
})
expect(verifyError._tag).toBe("SignatureVerificationError")
```
