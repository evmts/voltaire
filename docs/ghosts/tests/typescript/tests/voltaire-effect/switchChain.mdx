---
title: switchChain Tests
description: Test examples for switchChain showing EIP-3326 wallet_switchEthereumChain requests.
---

## Sends wallet_switchEthereumChain request with correct chainId

Demonstrates requesting the wallet to switch to a different chain.

```typescript
import { Effect, Layer } from 'effect'
import { switchChain } from 'voltaire-effect'
import { TransportService } from 'voltaire-effect'

const mockTransport = {
  request: <T>(method: string, params?: unknown[]) => {
    expect(method).toBe("wallet_switchEthereumChain")
    const p = params?.[0] as { chainId: string }
    expect(p.chainId).toBe("0x89") // 137 in hex
    return Effect.succeed(null as T)
  },
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

await Effect.runPromise(Effect.provide(switchChain(137), TestLayer))
```

## Converts mainnet chain ID correctly

Shows that chain ID 1 is converted to "0x1".

```typescript
import { Effect, Layer } from 'effect'
import { switchChain } from 'voltaire-effect'
import { TransportService } from 'voltaire-effect'

let capturedParams: unknown[] | undefined

const mockTransport = {
  request: <T>(_method: string, params?: unknown[]) => {
    capturedParams = params
    return Effect.succeed(null as T)
  },
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

await Effect.runPromise(Effect.provide(switchChain(1), TestLayer))

const params = capturedParams?.[0] as { chainId: string }
expect(params.chainId).toBe("0x1")
```

## Converts large chain IDs correctly

Demonstrates correct hex conversion for large chain IDs like Sepolia.

```typescript
import { Effect, Layer } from 'effect'
import { switchChain } from 'voltaire-effect'
import { TransportService } from 'voltaire-effect'

let capturedParams: unknown[] | undefined

const mockTransport = {
  request: <T>(_method: string, params?: unknown[]) => {
    capturedParams = params
    return Effect.succeed(null as T)
  },
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

// Sepolia chain ID: 11155111
await Effect.runPromise(Effect.provide(switchChain(11155111), TestLayer))

const params = capturedParams?.[0] as { chainId: string }
expect(params.chainId).toBe("0xaa36a7") // 11155111 in hex
```

## Handles chain not added error

Shows proper error handling when the requested chain is not in the wallet.

```typescript
import { Effect, Layer } from 'effect'
import { switchChain } from 'voltaire-effect'
import { TransportService, TransportError } from 'voltaire-effect'

const mockTransport = {
  request: <T>() =>
    Effect.fail(
      new TransportError({ code: 4902, message: "Unrecognized chain ID" }),
    ) as never,
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

const result = await Effect.runPromiseExit(
  Effect.provide(switchChain(999999), TestLayer),
)

expect(result._tag).toBe("Failure")
```

## Handles user rejection

Demonstrates error handling when user rejects the chain switch.

```typescript
import { Effect, Layer, Cause, Chunk, Option } from 'effect'
import { switchChain } from 'voltaire-effect'
import { TransportService, TransportError } from 'voltaire-effect'

const mockTransport = {
  request: <T>() =>
    Effect.fail(
      new TransportError({
        code: 4001,
        message: "User rejected the request",
      }),
    ) as never,
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

const result = await Effect.runPromiseExit(
  Effect.provide(switchChain(137), TestLayer),
)

expect(result._tag).toBe("Failure")
if (result._tag === "Failure") {
  const failures = Cause.failures(result.cause)
  const firstFailure = Chunk.head(failures)
  expect(Option.isSome(firstFailure) && firstFailure.value.code).toBe(4001)
}
```
