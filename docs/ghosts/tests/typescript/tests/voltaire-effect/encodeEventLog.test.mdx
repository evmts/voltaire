---
title: encodeEventLog Tests
description: Test examples for ABI event log encoding showing topic generation for ERC20 events.
---

## Encodes Transfer event topics

Demonstrates encoding indexed event parameters into topics.

```typescript
import { describe, expect, it } from "@effect/vitest"
import * as Effect from "effect/Effect"
import * as S from "effect/Schema"
import * as Abi from "voltaire-effect/primitives/Abi"

const erc20Abi = S.decodeUnknownSync(Abi.fromArray)([
  {
    type: "event",
    name: "Transfer",
    inputs: [
      { name: "from", type: "address", indexed: true },
      { name: "to", type: "address", indexed: true },
      { name: "value", type: "uint256", indexed: false },
    ],
  },
])

it.effect("encodes Transfer event topics", () =>
  Effect.gen(function* () {
    const topics = yield* Abi.encodeEventLog(erc20Abi, "Transfer", [
      "0x742d35Cc6634C0532925a3b844Bc9e7595f251e3",
      "0x1234567890123456789012345678901234567890",
    ])
    expect(topics.length).toBeGreaterThanOrEqual(1)
    const topic0 = topics[0]
    expect(topic0).not.toBeNull()
    if (topic0) {
      expect(topic0.startsWith("0x")).toBe(true)
    }
  }),
)
```

## Encodes Approval event topics

Demonstrates encoding Approval event with indexed owner and spender.

```typescript
import * as Effect from "effect/Effect"
import * as S from "effect/Schema"
import * as Abi from "voltaire-effect/primitives/Abi"

const erc20Abi = S.decodeUnknownSync(Abi.fromArray)([
  {
    type: "event",
    name: "Approval",
    inputs: [
      { name: "owner", type: "address", indexed: true },
      { name: "spender", type: "address", indexed: true },
      { name: "value", type: "uint256", indexed: false },
    ],
  },
])

it.effect("encodes Approval event topics", () =>
  Effect.gen(function* () {
    const topics = yield* Abi.encodeEventLog(erc20Abi, "Approval", [
      "0x742d35Cc6634C0532925a3b844Bc9e7595f251e3",
      "0x1234567890123456789012345678901234567890",
    ])
    expect(topics.length).toBeGreaterThanOrEqual(1)
  }),
)
```

## Returns 32-byte topic0

Demonstrates that topic0 is the 32-byte event signature hash.

```typescript
import * as Effect from "effect/Effect"
import * as Abi from "voltaire-effect/primitives/Abi"

it.effect("returns 32-byte topic0 for event signature", () =>
  Effect.gen(function* () {
    const topics = yield* Abi.encodeEventLog(erc20Abi, "Transfer", [
      "0x742d35Cc6634C0532925a3b844Bc9e7595f251e3",
      "0x1234567890123456789012345678901234567890",
    ])
    const topic0 = topics[0]
    expect(topic0).not.toBeNull()
    if (topic0) {
      expect(topic0.length).toBe(66) // 0x + 64 hex chars
    }
  }),
)
```

## Error cases

Demonstrates failures for unknown events and empty ABIs.

```typescript
import * as Effect from "effect/Effect"
import * as Exit from "effect/Exit"
import * as Abi from "voltaire-effect/primitives/Abi"

it("fails for unknown event", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.encodeEventLog(erc20Abi, "UnknownEvent", []),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})

it("fails with empty ABI", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.encodeEventLog([], "Transfer", []),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})
```
