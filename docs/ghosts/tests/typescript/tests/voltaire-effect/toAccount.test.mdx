---
title: toAccount Tests
description: Test examples for toAccount showing custom signer creation for hardware wallets and external signers.
---

## Create custom account with signers

Creates an account with custom signing functions.

```typescript
import * as Effect from 'effect/Effect'
import { Address, Signature } from 'voltaire'
import { AccountService, toAccount } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const account = yield* AccountService
  
  const sigMessage = yield* account.signMessage('0x48656c6c6f')
  const sigTx = yield* account.signTransaction({
    to: Address.fromHex('0x0000000000000000000000000000000000000002'),
    value: 1000000000000000000n,
    nonce: 0n,
    gasLimit: 21000n,
    chainId: 1n,
  })
  
  return {
    type: account.type,
    address: Address.toHex(account.address),
    sigMessage: Signature.toHex(sigMessage),
  }
}).pipe(
  Effect.provide(
    toAccount({
      address: '0x0000000000000000000000000000000000000001',
      signMessage: (message) => Effect.succeed('0x' + '11'.repeat(64) + '1b'),
      signTransaction: (tx) => Effect.succeed(new Uint8Array(65).fill(0x22)),
      signTypedData: (data) => Effect.succeed('0x' + '11'.repeat(64) + '1b'),
    })
  )
)

const result = await Effect.runPromise(program)
expect(result.type).toBe('hardware')
expect(result.address).toBe('0x0000000000000000000000000000000000000001')
```

## Unsupported operations fail by default

Sign and signAuthorization fail unless explicitly provided.

```typescript
import * as Effect from 'effect/Effect'
import { AccountService, toAccount } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const account = yield* AccountService
  
  const signResult = yield* Effect.either(account.sign({ hash: TEST_HASH }))
  const authResult = yield* Effect.either(
    account.signAuthorization({
      contractAddress: TEST_ADDRESS,
      chainId: 1n,
      nonce: 0n,
    })
  )
  
  return { signFailed: signResult._tag === 'Left', authFailed: authResult._tag === 'Left' }
}).pipe(
  Effect.provide(
    toAccount({
      address: TEST_ADDRESS,
      signMessage: () => Effect.succeed(TEST_SIGNATURE_HEX),
      signTransaction: () => Effect.succeed(TEST_SIGNATURE_HEX),
      signTypedData: () => Effect.succeed(TEST_SIGNATURE_HEX),
    })
  )
)

const result = await Effect.runPromise(program)
expect(result.signFailed).toBe(true)
expect(result.authFailed).toBe(true)
```

## Signature normalization

Accepts both hex string and Uint8Array signatures.

```typescript
import * as Effect from 'effect/Effect'
import { Signature } from 'voltaire'
import { AccountService, toAccount } from 'voltaire-effect'

const hexSig = '0x' + '11'.repeat(64) + '1b'
const bytesSig = new Uint8Array(65).fill(0x22)

const program = Effect.gen(function* () {
  const account = yield* AccountService
  const sigMessage = yield* account.signMessage('0x')
  const sigTx = yield* account.signTransaction({ /* ... */ })
  return {
    hexResult: Signature.toHex(sigMessage),
    bytesResult: Signature.toHex(sigTx),
  }
}).pipe(
  Effect.provide(
    toAccount({
      address: '0x0000000000000000000000000000000000000001',
      signMessage: () => Effect.succeed(hexSig),
      signTransaction: () => Effect.succeed(bytesSig),
      signTypedData: () => Effect.succeed(hexSig),
    })
  )
)

const result = await Effect.runPromise(program)
expect(result.hexResult).toBe(hexSig)
```
