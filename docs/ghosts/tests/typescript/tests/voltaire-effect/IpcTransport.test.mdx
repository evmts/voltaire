---
title: IpcTransport Tests
description: Test examples for IPC (Unix socket) transport with request correlation, timeout handling, and reconnection.
---

## Accepts string path configuration

Shows the simplest IPC transport configuration using just a socket path.

```typescript
import * as Layer from "effect/Layer";
import { IpcTransport } from "voltaire-effect";

const layer = IpcTransport("/tmp/geth.ipc");
expect(Layer.isLayer(layer)).toBe(true);
```

## Accepts object configuration with options

Demonstrates full IPC configuration with timeout and reconnect settings.

```typescript
import * as Layer from "effect/Layer";
import { IpcTransport } from "voltaire-effect";

const layer = IpcTransport({
  path: "/tmp/geth.ipc",
  timeout: 60000,
  reconnect: { maxAttempts: 2, delay: 1000 },
});
expect(Layer.isLayer(layer)).toBe(true);
```

## Matches responses to requests by ID (out of order)

Verifies that concurrent requests are correctly matched to their responses even when delivered out of order.

```typescript
import { NodeFileSystem } from "@effect/platform-node";
import * as Effect from "effect/Effect";
import * as Fiber from "effect/Fiber";
import * as Layer from "effect/Layer";
import { IpcTransport, TransportService } from "voltaire-effect";

const program = Effect.gen(function* () {
  const transport = yield* TransportService;

  const fiber1 = yield* Effect.fork(transport.request<string>("eth_blockNumber"));
  const fiber2 = yield* Effect.fork(transport.request<string>("eth_chainId"));

  // Responses arrive out of order but are matched correctly
  const [result1, result2] = yield* Effect.all([
    Fiber.join(fiber1),
    Fiber.join(fiber2),
  ]);

  return { result1, result2 };
}).pipe(
  Effect.provide(
    Layer.provide(
      IpcTransport({ path: "/tmp/geth.ipc", reconnect: false }),
      NodeFileSystem.layer,
    ),
  ),
  Effect.scoped,
);
```

## Fails with timeout when no response received

Demonstrates timeout error handling when the IPC socket doesn't respond.

```typescript
import { NodeFileSystem } from "@effect/platform-node";
import * as Effect from "effect/Effect";
import * as Layer from "effect/Layer";
import { IpcTransport, TransportError, TransportService } from "voltaire-effect";

const program = Effect.gen(function* () {
  const transport = yield* TransportService;
  return yield* transport.request<string>("eth_blockNumber");
}).pipe(
  Effect.provide(
    Layer.provide(
      IpcTransport({ path: "/tmp/geth.ipc", timeout: 20, reconnect: false }),
      NodeFileSystem.layer,
    ),
  ),
  Effect.scoped,
);

const exit = await Effect.runPromiseExit(program);
expect(exit._tag).toBe("Failure");
// Error message contains "timeout"
```

## Propagates error code, message, and data

Shows how JSON-RPC errors from the node are surfaced with full details.

```typescript
import * as Effect from "effect/Effect";
import { TransportError, TransportService } from "voltaire-effect";

// When server returns: { error: { code: -32602, message: "Invalid params", data: { hint: "bad address" } } }
const exit = await Effect.runPromiseExit(program);
if (exit._tag === "Failure" && exit.cause._tag === "Fail") {
  expect(exit.cause.error).toBeInstanceOf(TransportError);
  expect(exit.cause.error.input.code).toBe(-32602);
  expect(exit.cause.error.message).toBe("Invalid params");
  expect(exit.cause.error.data).toEqual({ hint: "bad address" });
}
```
