---
title: getFunction Tests
description: Test examples for ABI getFunction showing function lookup by name from ABI arrays.
---

## Gets function by name

Demonstrates retrieving a function definition from an ABI by name.

```typescript
import { describe, expect, it } from "@effect/vitest"
import * as Effect from "effect/Effect"
import * as S from "effect/Schema"
import * as Abi from "voltaire-effect/primitives/Abi"

const erc20Abi = S.decodeUnknownSync(Abi.fromArray)([
  {
    type: "function",
    name: "transfer",
    inputs: [
      { name: "to", type: "address" },
      { name: "amount", type: "uint256" },
    ],
    outputs: [{ type: "bool" }],
    stateMutability: "nonpayable",
  },
  {
    type: "function",
    name: "balanceOf",
    inputs: [{ name: "account", type: "address" }],
    outputs: [{ type: "uint256" }],
    stateMutability: "view",
  },
])

it.effect("gets transfer function", () =>
  Effect.gen(function* () {
    const fn = yield* Abi.getFunction(erc20Abi, "transfer")
    expect(fn.name).toBe("transfer")
    expect(fn.type).toBe("function")
    expect(fn.inputs.length).toBe(2)
    expect(fn.outputs?.length).toBe(1)
  }),
)

it.effect("gets balanceOf function", () =>
  Effect.gen(function* () {
    const fn = yield* Abi.getFunction(erc20Abi, "balanceOf")
    expect(fn.name).toBe("balanceOf")
    expect(fn.stateMutability).toBe("view")
  }),
)
```

## Fails for unknown function

Demonstrates that looking up a non-existent function fails.

```typescript
import * as Effect from "effect/Effect"
import * as Exit from "effect/Exit"
import * as Abi from "voltaire-effect/primitives/Abi"

it("fails for unknown function", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.getFunction(erc20Abi, "unknownFunction"),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})
```

## Fails for event name

Demonstrates that events are not returned when looking for functions.

```typescript
import * as Effect from "effect/Effect"
import * as Exit from "effect/Exit"
import * as S from "effect/Schema"
import * as Abi from "voltaire-effect/primitives/Abi"

const abiWithEvent = S.decodeUnknownSync(Abi.fromArray)([
  {
    type: "event",
    name: "Transfer",
    inputs: [
      { name: "from", type: "address", indexed: true },
      { name: "to", type: "address", indexed: true },
      { name: "value", type: "uint256", indexed: false },
    ],
  },
])

it("fails for event name (not a function)", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.getFunction(abiWithEvent, "Transfer"),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})
```

## Error handling with Effect.catchAll

Demonstrates catching errors with Effect combinators.

```typescript
import * as Effect from "effect/Effect"
import * as Abi from "voltaire-effect/primitives/Abi"

it.effect("can catch error with Effect.catchAll", () =>
  Effect.gen(function* () {
    const result = yield* Abi.getFunction(erc20Abi, "unknown").pipe(
      Effect.catchAll(() =>
        Effect.succeed({ name: "fallback", type: "function" as const }),
      ),
    )
    expect(result.name).toBe("fallback")
  }),
)
```
