---
title: Transaction Tests
description: Test examples for Transaction showing serialization, deserialization, and utility functions for all transaction types (Legacy, EIP-2930, EIP-1559, EIP-4844, EIP-7702).
---

## Legacy Transaction Serialization

Serializes and deserializes legacy transactions with gas price.

```typescript
import { describe, expect, it } from "@effect/vitest"
import type { AddressType } from "voltaire-effect/primitives/Address"
import type { HashType } from "voltaire-effect/primitives/Hash"
import * as S from "effect/Schema"
import * as Transaction from "voltaire-effect/primitives/Transaction"

function createAddress(byte: number): AddressType {
  const addr = new Uint8Array(20)
  addr.fill(byte)
  return addr as AddressType
}

function createBytes(length: number, fill = 0): Uint8Array {
  const bytes = new Uint8Array(length)
  bytes.fill(fill)
  return bytes
}

const testAddress = createAddress(0x42)
const testSignature = {
  r: createBytes(32, 1),
  s: createBytes(32, 2),
}

const legacyTx: Transaction.Legacy = {
  type: Transaction.Type.Legacy,
  nonce: 5n,
  gasPrice: 25000000000n,
  gasLimit: 50000n,
  to: testAddress,
  value: 100n,
  data: new Uint8Array([1, 2, 3]),
  v: 27n,
  r: testSignature.r,
  s: testSignature.s,
}

const bytes = S.encodeSync(Transaction.Serialized)(legacyTx)
expect(bytes).toBeInstanceOf(Uint8Array)

const decoded = S.decodeSync(Transaction.Serialized)(bytes)
expect(decoded.type).toBe(Transaction.Type.Legacy)
expect(decoded.nonce).toBe(legacyTx.nonce)
```

## EIP-1559 Transaction Serialization

Serializes and deserializes EIP-1559 transactions with maxFeePerGas and maxPriorityFeePerGas.

```typescript
import * as S from "effect/Schema"
import * as Transaction from "voltaire-effect/primitives/Transaction"

const eip1559Tx: Transaction.EIP1559 = {
  type: Transaction.Type.EIP1559,
  chainId: 1n,
  nonce: 42n,
  maxPriorityFeePerGas: 2000000000n,
  maxFeePerGas: 30000000000n,
  gasLimit: 21000n,
  to: testAddress,
  value: 1000000000000000000n,
  data: new Uint8Array([0xab, 0xcd]),
  accessList: [],
  yParity: 1,
  r: testSignature.r,
  s: testSignature.s,
}

const bytes = S.encodeSync(Transaction.Serialized)(eip1559Tx)
expect(bytes[0]).toBe(0x02) // EIP-1559 type prefix

const decoded = S.decodeSync(Transaction.Serialized)(bytes)
expect(decoded.type).toBe(Transaction.Type.EIP1559)
expect((decoded as Transaction.EIP1559).maxFeePerGas).toBe(30000000000n)
```

## EIP-4844 Blob Transaction

Handles EIP-4844 blob transactions with versioned hashes.

```typescript
import * as S from "effect/Schema"
import * as Transaction from "voltaire-effect/primitives/Transaction"
import type { HashType } from "voltaire-effect/primitives/Hash"

const blobHash = new Uint8Array(32)
blobHash[0] = 0x01

const eip4844Tx: Transaction.EIP4844 = {
  type: Transaction.Type.EIP4844,
  chainId: 1n,
  nonce: 0n,
  maxPriorityFeePerGas: 1000000000n,
  maxFeePerGas: 20000000000n,
  gasLimit: 21000n,
  to: testAddress,
  value: 0n,
  data: new Uint8Array(),
  accessList: [],
  maxFeePerBlobGas: 1000000000n,
  blobVersionedHashes: [blobHash as HashType],
  yParity: 0,
  r: testSignature.r,
  s: testSignature.s,
}

const bytes = S.encodeSync(Transaction.Serialized)(eip4844Tx)
expect(bytes[0]).toBe(0x03) // EIP-4844 type prefix
```

## Contract Creation Transaction

Handles transactions with null `to` address for contract deployment.

```typescript
import * as S from "effect/Schema"
import * as Transaction from "voltaire-effect/primitives/Transaction"

const contractTx: Transaction.Legacy = {
  ...legacyTx,
  to: null,
  data: new Uint8Array([0x60, 0x80, 0x60, 0x40]),
}
const bytes = S.encodeSync(Transaction.Serialized)(contractTx)
const decoded = S.decodeSync(Transaction.Serialized)(bytes)
expect(decoded.to).toBeNull()
expect(Transaction.isContractCreation(decoded)).toBe(true)
```

## Transaction Hash

Produces consistent keccak256 hashes for transactions.

```typescript
import * as Transaction from "voltaire-effect/primitives/Transaction"

const h1 = Transaction.hash(legacyTx)
const h2 = Transaction.hash(legacyTx)
expect(h1).toEqual(h2) // Deterministic hashing
```

## Detect Transaction Type

Detects transaction type from serialized bytes.

```typescript
import * as S from "effect/Schema"
import * as Transaction from "voltaire-effect/primitives/Transaction"

const bytes = S.encodeSync(Transaction.Serialized)(eip1559Tx)
expect(Transaction.detectType(bytes)).toBe(Transaction.Type.EIP1559)
```

## Get Gas Price

Returns effective gas price, handling both legacy and EIP-1559 fee calculations.

```typescript
import * as Transaction from "voltaire-effect/primitives/Transaction"

// Legacy: returns gasPrice directly
expect(Transaction.getGasPrice(legacyTx)).toBe(25000000000n)

// EIP-1559: calculates effective gas price from base fee
const baseFee = 10000000000n
const effectivePrice = Transaction.getGasPrice(eip1559Tx, baseFee)
expect(effectivePrice).toBeLessThanOrEqual(eip1559Tx.maxFeePerGas)
```
