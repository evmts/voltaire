---
title: watchAsset Tests
description: Test examples for watchAsset showing EIP-747 wallet_watchAsset requests for token tracking.
---

## Sends wallet_watchAsset request with correct params

Demonstrates requesting the wallet to track a token with full metadata.

```typescript
import { Effect, Layer } from 'effect'
import { watchAsset } from 'voltaire-effect'
import { TransportService } from 'voltaire-effect'

const usdcAsset = {
  type: "ERC20",
  options: {
    address: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
    symbol: "USDC",
    decimals: 6,
    image: "https://cryptologos.cc/logos/usd-coin-usdc-logo.png",
  },
}

const mockTransport = {
  request: <T>(method: string, params?: unknown[]) => {
    expect(method).toBe("wallet_watchAsset")
    const p = params?.[0] as { type: string; options: { symbol: string } }
    expect(p.type).toBe("ERC20")
    expect(p.options.symbol).toBe("USDC")
    return Effect.succeed(true as T)
  },
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

const result = await Effect.runPromise(
  Effect.provide(watchAsset(usdcAsset), TestLayer),
)

expect(result).toBe(true)
```

## Works without optional metadata

Shows adding a token with only the required address field.

```typescript
import { Effect, Layer } from 'effect'
import { watchAsset } from 'voltaire-effect'
import { TransportService } from 'voltaire-effect'

const minimalAsset = {
  type: "ERC20",
  options: {
    address: "0xdAC17F958D2ee523a2206206994597C13D831ec7",
  },
}

await Effect.runPromise(
  Effect.provide(watchAsset(minimalAsset), TestLayer),
)
```

## Returns false when user rejects

Demonstrates that user rejection returns false instead of throwing.

```typescript
import { Effect, Layer } from 'effect'
import { watchAsset } from 'voltaire-effect'
import { TransportService } from 'voltaire-effect'

const mockTransport = {
  request: <T>() => Effect.succeed(false as T),
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

const result = await Effect.runPromise(
  Effect.provide(watchAsset(usdcAsset), TestLayer),
)

expect(result).toBe(false)
```

## Returns false when user rejects with an error

Shows that EIP-1193 rejection errors (code 4001) are converted to false.

```typescript
import { Effect, Layer } from 'effect'
import { watchAsset } from 'voltaire-effect'
import { TransportService, TransportError } from 'voltaire-effect'

const mockTransport = {
  request: <T>() =>
    Effect.fail(
      new TransportError({
        code: 4001,
        message: "User rejected the request",
      }),
    ) as never,
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

const result = await Effect.runPromise(
  Effect.provide(watchAsset(usdcAsset), TestLayer),
)

expect(result).toBe(false)
```

## Handles transport errors

Demonstrates proper error handling for non-rejection transport errors.

```typescript
import { Effect, Layer } from 'effect'
import { watchAsset } from 'voltaire-effect'
import { TransportService, TransportError } from 'voltaire-effect'

const mockTransport = {
  request: <T>() =>
    Effect.fail(
      new TransportError({ code: -32603, message: "Internal error" }),
    ) as never,
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

const result = await Effect.runPromiseExit(
  Effect.provide(watchAsset(usdcAsset), TestLayer),
)

expect(result._tag).toBe("Failure")
```
