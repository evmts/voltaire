---
title: requestPermissions Tests
description: Test examples for requestPermissions showing EIP-2255 wallet permission requests.
---

## Sends wallet_requestPermissions with correct params

Demonstrates requesting wallet permissions using the EIP-2255 API.

```typescript
import { Effect, Layer } from 'effect'
import { requestPermissions } from 'voltaire-effect'
import { TransportService } from 'voltaire-effect'

const mockTransport = {
  request: <T>(method: string, params?: unknown[]) => {
    expect(method).toBe("wallet_requestPermissions")
    expect(params).toEqual([{ eth_accounts: {} }])
    return Effect.succeed(mockGrantedPermissions as T)
  },
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

const result = await Effect.runPromise(
  Effect.provide(requestPermissions({ eth_accounts: {} }), TestLayer),
)

expect(result).toEqual(mockGrantedPermissions)
```

## Requests multiple permissions

Shows requesting multiple permission types in a single call.

```typescript
import { Effect, Layer } from 'effect'
import { requestPermissions } from 'voltaire-effect'
import { TransportService } from 'voltaire-effect'

const permissionRequest = {
  eth_accounts: {},
  eth_chainId: {},
}

await Effect.runPromise(
  Effect.provide(requestPermissions(permissionRequest), TestLayer),
)
```

## Requests permissions with parameters

Demonstrates providing specific requirements for permissions.

```typescript
import { Effect } from 'effect'
import { requestPermissions } from 'voltaire-effect'

const permissionRequest = {
  eth_accounts: {
    requiredMethods: ["signMessage"],
  },
}

await Effect.runPromise(
  Effect.provide(requestPermissions(permissionRequest), TestLayer),
)
```

## Handles user rejection

Shows proper error handling when user rejects the permission request.

```typescript
import { Effect, Layer } from 'effect'
import { requestPermissions } from 'voltaire-effect'
import { TransportService, TransportError } from 'voltaire-effect'

const mockTransport = {
  request: <T>() =>
    Effect.fail(
      new TransportError({
        code: 4001,
        message: "User rejected the request",
      }),
    ) as never,
}

const TestLayer = Layer.succeed(TransportService, mockTransport)

const result = await Effect.runPromiseExit(
  Effect.provide(requestPermissions({ eth_accounts: {} }), TestLayer),
)

expect(result._tag).toBe("Failure")
```
