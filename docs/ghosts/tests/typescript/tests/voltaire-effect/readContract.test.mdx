---
title: readContract Tests
description: Test examples for readContract showing typed contract reads with ABI encoding/decoding.
---

## readContract reads ERC-20 balanceOf with single argument

Reads a contract view function and decodes the result using the ABI.

```typescript
import { Effect, Layer } from 'effect'
import * as S from 'effect/Schema'
import { Address } from 'voltaire'
import { readContract } from 'voltaire-effect'
import { ProviderService } from 'voltaire-effect'
import { fromArray } from 'voltaire-effect/primitives/Abi/AbiSchema'

const erc20Abi = S.decodeUnknownSync(fromArray)([
  {
    type: "function",
    name: "balanceOf",
    stateMutability: "view",
    inputs: [{ name: "account", type: "address" }],
    outputs: [{ name: "balance", type: "uint256" }],
  },
])

const mockProvider = {
  call: vi.fn().mockReturnValue(
    Effect.succeed("0x0000000000000000000000000000000000000000000000000de0b6b3a7640000"),
  ),
}

const MockProviderLayer = Layer.succeed(ProviderService, mockProvider as any)

const program = readContract({
  address: "0x6B175474E89094C44Da98b954EecdEfaE6E286AB",
  abi: erc20Abi,
  functionName: "balanceOf",
  args: ["0x1234567890123456789012345678901234567890"],
})

const result = await Effect.runPromise(
  program.pipe(Effect.provide(MockProviderLayer)),
)

expect(mockProvider.call).toHaveBeenCalled()
expect(result).toBe(1000000000000000000n)
```

## readContract accepts branded address input

The readContract function accepts branded Address types for type safety.

```typescript
import { Effect, Layer } from 'effect'
import { Address } from 'voltaire'
import { readContract } from 'voltaire-effect'

const address = Address("0x6B175474E89094C44Da98b954EecdEfaE6E286AB")
const program = readContract({
  address,
  abi: erc20Abi,
  functionName: "balanceOf",
  args: ["0x1234567890123456789012345678901234567890"],
})

const result = await Effect.runPromise(
  program.pipe(Effect.provide(MockProviderLayer)),
)

expect(result).toBe(1000000000000000000n)
```

## readContract reads totalSupply without args

View functions with no arguments can be called without the args parameter.

```typescript
import { Effect, Layer } from 'effect'
import { readContract } from 'voltaire-effect'

mockProvider.call.mockReturnValue(
  Effect.succeed("0x00000000000000000000000000000000000000000000d3c21bcecceda1000000"),
)

const program = readContract({
  address: "0x6B175474E89094C44Da98b954EecdEfaE6E286AB",
  abi: erc20Abi,
  functionName: "totalSupply",
})

const result = await Effect.runPromise(
  program.pipe(Effect.provide(MockProviderLayer)),
)

expect(result).toBeDefined()
```

## readContract handles dynamic array output

Dynamic arrays like uint256[] are properly decoded from the return data.

```typescript
import { Effect, Layer } from 'effect'
import { readContract } from 'voltaire-effect'

mockProvider.call.mockReturnValue(
  Effect.succeed(
    "0x" +
    "0000000000000000000000000000000000000000000000000000000000000020" +
    "0000000000000000000000000000000000000000000000000000000000000003" +
    "0000000000000000000000000000000000000000000000000000000000000064" +
    "00000000000000000000000000000000000000000000000000000000000000c8" +
    "000000000000000000000000000000000000000000000000000000000000012c",
  ),
)

const program = readContract({
  address: "0x1234567890123456789012345678901234567890",
  abi: extendedAbi,
  functionName: "getBalances",
  args: ["0x1234567890123456789012345678901234567890"],
})

const result = await Effect.runPromise(
  program.pipe(Effect.provide(MockProviderLayer)),
)

expect(Array.isArray(result)).toBe(true)
expect(result.length).toBe(3)
expect(result[0]).toBe(100n)
expect(result[1]).toBe(200n)
expect(result[2]).toBe(300n)
```

## readContract propagates transport errors

Transport and timeout errors are propagated through the Effect error channel.

```typescript
import { Effect, Layer } from 'effect'
import { readContract } from 'voltaire-effect'

mockProvider.call.mockReturnValue(
  Effect.fail({ message: "request timeout", code: -32000 }),
)

const program = readContract({
  address: "0x6B175474E89094C44Da98b954EecdEfaE6E286AB",
  abi: erc20Abi,
  functionName: "balanceOf",
  args: ["0x1234567890123456789012345678901234567890"],
})

const exit = await Effect.runPromiseExit(
  program.pipe(Effect.provide(MockProviderLayer)),
)

expect(exit._tag).toBe("Failure")
```
