---
title: encodeError Tests
description: Test examples for encoding custom error data with ABI.
---

## Encodes InsufficientBalance error

Encodes custom error with two uint256 arguments.

```typescript
import { describe, expect, it } from "@effect/vitest"
import * as Effect from "effect/Effect"
import * as S from "effect/Schema"
import * as Abi from "voltaire-effect/primitives/Abi"

const customAbi = S.decodeUnknownSync(Abi.fromArray)([
  {
    type: "error",
    name: "InsufficientBalance",
    inputs: [
      { name: "available", type: "uint256" },
      { name: "required", type: "uint256" },
    ],
  },
  {
    type: "error",
    name: "Unauthorized",
    inputs: [{ name: "caller", type: "address" }],
  },
  {
    type: "error",
    name: "InvalidAmount",
    inputs: [],
  },
])

it.effect("encodes InsufficientBalance error", () =>
  Effect.gen(function* () {
    const encoded = yield* Abi.encodeError(customAbi, "InsufficientBalance", [
      100n,
      200n,
    ])
    expect(encoded.startsWith("0x")).toBe(true)
    expect(encoded.length).toBeGreaterThan(10)
  }),
)
```

## Encodes Unauthorized error with address

Encodes error with address argument.

```typescript
it.effect("encodes Unauthorized error with address", () =>
  Effect.gen(function* () {
    const encoded = yield* Abi.encodeError(customAbi, "Unauthorized", [
      "0x742d35Cc6634C0532925a3b844Bc9e7595f251e3",
    ])
    expect(encoded.startsWith("0x")).toBe(true)
  }),
)
```

## Encodes error with no inputs

Encodes error that has no input parameters.

```typescript
it.effect("encodes error with no inputs", () =>
  Effect.gen(function* () {
    const encoded = yield* Abi.encodeError(customAbi, "InvalidAmount", [])
    expect(encoded.startsWith("0x")).toBe(true)
    expect(encoded.length).toBe(10)
  }),
)
```

## Fails for unknown error

Returns failure when error name doesn't exist in ABI.

```typescript
import * as Exit from "effect/Exit"

it("fails for unknown error", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.encodeError(customAbi, "UnknownError", []),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})
```

## Fails with wrong argument types

Returns failure when arguments don't match error signature.

```typescript
it("fails with wrong argument types", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.encodeError(customAbi, "InsufficientBalance", [
      "not a number",
      "also not",
    ]),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})
```
