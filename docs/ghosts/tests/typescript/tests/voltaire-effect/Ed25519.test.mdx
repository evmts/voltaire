---
title: Ed25519 Tests
description: Test examples for Ed25519 showing signing, verification, and public key derivation.
---

## Sign a Message

Signs a message with a secret key and returns a 64-byte signature.

```typescript
import { Effect } from 'effect'
import * as Ed25519Effect from 'voltaire-effect/crypto/Ed25519'
import * as VoltaireEd25519 from '@tevm/voltaire/Ed25519'

const testSeed = new Uint8Array(32).fill(0x42)
const testKeypair = VoltaireEd25519.keypairFromSeed(testSeed)
const testMessage = new TextEncoder().encode('Hello, world!')

const program = Effect.gen(function* () {
  const result = yield* Ed25519Effect.sign(testMessage, testKeypair.secretKey)
  // result is Uint8Array of length 64
})
```

## Deterministic Signatures

Ed25519 produces the same signature for the same message and key.

```typescript
import { Effect } from 'effect'
import * as Ed25519Effect from 'voltaire-effect/crypto/Ed25519'
import * as VoltaireEd25519 from '@tevm/voltaire/Ed25519'

const testSeed = new Uint8Array(32).fill(0x42)
const testKeypair = VoltaireEd25519.keypairFromSeed(testSeed)
const testMessage = new TextEncoder().encode('Hello, world!')

const program = Effect.gen(function* () {
  const sig1 = yield* Ed25519Effect.sign(testMessage, testKeypair.secretKey)
  const sig2 = yield* Ed25519Effect.sign(testMessage, testKeypair.secretKey)
  // sig1 and sig2 are equal
})
```

## Verify a Signature

Verifies that a signature is valid for a given message and public key.

```typescript
import { Effect } from 'effect'
import * as Ed25519Effect from 'voltaire-effect/crypto/Ed25519'
import * as VoltaireEd25519 from '@tevm/voltaire/Ed25519'

const testSeed = new Uint8Array(32).fill(0x42)
const testKeypair = VoltaireEd25519.keypairFromSeed(testSeed)
const testMessage = new TextEncoder().encode('Hello, world!')

const program = Effect.gen(function* () {
  const signature = yield* Ed25519Effect.sign(testMessage, testKeypair.secretKey)
  const isValid = yield* Ed25519Effect.verify(
    signature,
    testMessage,
    testKeypair.publicKey
  )
  // isValid is true
})
```

## Derive Public Key

Derives a 32-byte public key from a secret key.

```typescript
import { Effect } from 'effect'
import * as Ed25519Effect from 'voltaire-effect/crypto/Ed25519'
import * as VoltaireEd25519 from '@tevm/voltaire/Ed25519'

const testSeed = new Uint8Array(32).fill(0x42)
const testKeypair = VoltaireEd25519.keypairFromSeed(testSeed)

const program = Effect.gen(function* () {
  const result = yield* Ed25519Effect.getPublicKey(testKeypair.secretKey)
  // result equals testKeypair.publicKey
})
```

## Service Layer Usage

Uses the Ed25519Service with dependency injection.

```typescript
import { Effect } from 'effect'
import { Ed25519Service, Ed25519Live } from 'voltaire-effect/crypto/Ed25519'
import * as VoltaireEd25519 from '@tevm/voltaire/Ed25519'

const testSeed = new Uint8Array(32).fill(0x42)
const testKeypair = VoltaireEd25519.keypairFromSeed(testSeed)
const testMessage = new TextEncoder().encode('Hello, world!')

const program = Effect.gen(function* () {
  const ed = yield* Ed25519Service
  const sig = yield* ed.sign(testMessage, testKeypair.secretKey)
  const pubKey = yield* ed.getPublicKey(testKeypair.secretKey)
  const result = yield* ed.verify(sig, testMessage, pubKey)
  // result is true
}).pipe(Effect.provide(Ed25519Live))
```

## Test Layer for Mocking

Uses the Ed25519Test layer for testing with mock implementations.

```typescript
import { Effect } from 'effect'
import { Ed25519Service, Ed25519Test } from 'voltaire-effect/crypto/Ed25519'

const program = Effect.gen(function* () {
  const ed = yield* Ed25519Service
  const result = yield* ed.sign(new Uint8Array(10), new Uint8Array(64))
  // result is a zero-filled mock signature
}).pipe(Effect.provide(Ed25519Test))
```

## Full Sign-Verify Round Trip

Demonstrates a complete signing and verification flow.

```typescript
import { Effect } from 'effect'
import * as Ed25519Effect from 'voltaire-effect/crypto/Ed25519'
import * as VoltaireEd25519 from '@tevm/voltaire/Ed25519'

const program = Effect.gen(function* () {
  const seed = new Uint8Array(32).fill(0xab)
  const keypair = VoltaireEd25519.keypairFromSeed(seed)
  const message = new TextEncoder().encode('Round trip test')
  
  const signature = yield* Ed25519Effect.sign(message, keypair.secretKey)
  const isValid = yield* Ed25519Effect.verify(signature, message, keypair.publicKey)
  // isValid is true
})
```
