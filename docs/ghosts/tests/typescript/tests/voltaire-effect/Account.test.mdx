---
title: Account Tests
description: Test examples for AccountService showing local accounts, JSON-RPC accounts, and signing operations.
---

## Derive address from private key

Derives the Ethereum address from a private key.

```typescript
import * as Effect from 'effect/Effect'
import { Address } from 'voltaire'
import { AccountService, LocalAccount } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const account = yield* AccountService
  return Address.toHex(account.address)
}).pipe(
  Effect.provide(LocalAccount(TEST_PRIVATE_KEY)),
  Effect.provide(CryptoLiveLayer)
)

const result = await Effect.runPromise(program)
expect(result).toBe('0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266')
```

## Local account has type "local"

Verifies the account type property.

```typescript
import * as Effect from 'effect/Effect'
import { AccountService, LocalAccount } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const account = yield* AccountService
  return account.type
}).pipe(Effect.provide(LocalAccount(TEST_PRIVATE_KEY)))

const result = await Effect.runPromise(program)
expect(result).toBe('local')
```

## Sign raw hash

Signs a 32-byte hash returning a signature.

```typescript
import * as Effect from 'effect/Effect'
import { Signature } from 'voltaire'
import { AccountService, LocalAccount } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const account = yield* AccountService
  const signature = yield* account.sign({ hash: TEST_HASH })
  return Signature.toHex(signature)
}).pipe(Effect.provide(LocalAccount(TEST_PRIVATE_KEY)))

const result = await Effect.runPromise(program)
expect(result).toMatch(/^0x[0-9a-f]{130}$/)
```

## Sign message with EIP-191 prefix

Signs a message with the Ethereum signed message prefix.

```typescript
import * as Effect from 'effect/Effect'
import { AccountService, LocalAccount } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const message = '0x48656c6c6f' // "Hello"
  const account = yield* AccountService
  return yield* account.signMessage(message)
}).pipe(Effect.provide(LocalAccount(TEST_PRIVATE_KEY)))

const signature = await Effect.runPromise(program)
expect(signature).toBeDefined()
```

## Sign transaction

Signs an unsigned transaction.

```typescript
import * as Effect from 'effect/Effect'
import { Address } from 'voltaire'
import { AccountService, LocalAccount } from 'voltaire-effect'

const tx = {
  to: Address.fromHex('0x0000000000000000000000000000000000000001'),
  value: 1000000000000000000n,
  nonce: 0n,
  gasPrice: 20000000000n,
  gasLimit: 21000n,
  chainId: 1n,
}

const program = Effect.gen(function* () {
  const account = yield* AccountService
  return yield* account.signTransaction(tx)
}).pipe(Effect.provide(LocalAccount(TEST_PRIVATE_KEY)))

const signature = await Effect.runPromise(program)
expect(signature).toBeDefined()
```

## Sign typed data (EIP-712)

Signs EIP-712 structured data.

```typescript
import * as Effect from 'effect/Effect'
import { Address, TypedData } from 'voltaire'
import { AccountService, LocalAccount } from 'voltaire-effect'

const typedData = TypedData.from({
  types: {
    EIP712Domain: [
      { name: 'name', type: 'string' },
      { name: 'version', type: 'string' },
      { name: 'chainId', type: 'uint256' },
    ],
    Person: [
      { name: 'name', type: 'string' },
      { name: 'wallet', type: 'address' },
    ],
  },
  primaryType: 'Person',
  domain: { name: 'Test', version: '1', chainId: 1 },
  message: {
    name: 'Alice',
    wallet: Address.fromHex('0x0000000000000000000000000000000000000001'),
  },
})

const program = Effect.gen(function* () {
  const account = yield* AccountService
  return yield* account.signTypedData(typedData)
}).pipe(Effect.provide(LocalAccount(TEST_PRIVATE_KEY)))

const signature = await Effect.runPromise(program)
expect(signature).toBeDefined()
```

## Sign EIP-7702 authorization

Signs an authorization for EIP-7702 account abstraction.

```typescript
import * as Effect from 'effect/Effect'
import { AccountService, LocalAccount } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const account = yield* AccountService
  return yield* account.signAuthorization({
    contractAddress: '0x000000000000000000000000000000000000dead',
    chainId: 1n,
    nonce: 7n,
  })
}).pipe(Effect.provide(LocalAccount(TEST_PRIVATE_KEY)))

const authorization = await Effect.runPromise(program)
expect(authorization.chainId).toBe(1n)
expect(authorization.nonce).toBe(7n)
expect(authorization.yParity === 0 || authorization.yParity === 1).toBe(true)
```

## JSON-RPC account delegates to transport

Creates an account that delegates signing to a JSON-RPC provider.

```typescript
import * as Effect from 'effect/Effect'
import { Address } from 'voltaire'
import { AccountService, JsonRpcAccount } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const account = yield* AccountService
  return {
    type: account.type,
    hasAddress: Address.equals(account.address, mockAddress),
  }
}).pipe(
  Effect.provide(JsonRpcAccount(mockAddress)),
  Effect.provide(transportLayer)
)

const result = await Effect.runPromise(program)
expect(result.type).toBe('json-rpc')
expect(result.hasAddress).toBe(true)
```

## AccountError structure

Creates an AccountError with correct properties.

```typescript
import { AccountError } from 'voltaire-effect'

const error = new AccountError({ action: 'signMessage' }, 'test message')
expect(error._tag).toBe('AccountError')
expect(error.name).toBe('AccountError')
expect(error.message).toBe('test message')
expect(error.input).toEqual({ action: 'signMessage' })
```
