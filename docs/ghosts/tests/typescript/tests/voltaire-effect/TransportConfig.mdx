---
title: TransportConfig Tests
description: Test examples for TransportConfig showing Effect Config-based transport configuration.
---

## Parses config from provider

Demonstrates reading transport configuration from an Effect ConfigProvider.

```typescript
import { Effect, Layer, ConfigProvider, Duration, Secret } from 'effect'
import { TransportConfig } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([
    ["rpc.url", "https://mainnet.infura.io/v3/KEY"],
    ["rpc.timeout", "60 seconds"],
    ["rpc.retries", "5"],
    ["rpc.retryDelay", "2 seconds"],
  ]),
)

const program = Effect.gen(function* () {
  const config = yield* TransportConfig
  return config
}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)))

const config = await Effect.runPromise(program)
expect(config.url).toBe("https://mainnet.infura.io/v3/KEY")
expect(Duration.toMillis(config.timeout)).toBe(60000)
expect(config.retries).toBe(5)
expect(Duration.toMillis(config.retryDelay)).toBe(2000)
```

## Uses defaults for optional fields

Shows that sensible defaults are used when optional values are omitted.

```typescript
import { Effect, Layer, ConfigProvider, Duration } from 'effect'
import { TransportConfig } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([["rpc.url", "https://rpc.example.com"]]),
)

const program = Effect.gen(function* () {
  const config = yield* TransportConfig
  return config
}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)))

const config = await Effect.runPromise(program)
expect(config.url).toBe("https://rpc.example.com")
expect(Duration.toMillis(config.timeout)).toBe(30000) // Default 30s
expect(config.retries).toBe(3) // Default 3
expect(Duration.toMillis(config.retryDelay)).toBe(1000) // Default 1s
```

## Validates URL scheme

Demonstrates that only valid URL schemes are accepted.

```typescript
import { Effect, Layer, ConfigProvider } from 'effect'
import { TransportConfig } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([["rpc.url", "ftp://invalid.com"]]),
)

const program = Effect.gen(function* () {
  const config = yield* TransportConfig
  return config
}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)))

const exit = await Effect.runPromiseExit(program)
expect(exit._tag).toBe("Failure")
```

## Accepts various URL schemes

Shows that http, https, ws, and wss schemes are all valid.

```typescript
import { Effect, Layer, ConfigProvider } from 'effect'
import { TransportConfig } from 'voltaire-effect'

// http://
const httpConfig = ConfigProvider.fromMap(new Map([["rpc.url", "http://localhost:8545"]]))
// https://
const httpsConfig = ConfigProvider.fromMap(new Map([["rpc.url", "https://mainnet.infura.io"]]))
// ws://
const wsConfig = ConfigProvider.fromMap(new Map([["rpc.url", "ws://localhost:8545"]]))
// wss://
const wssConfig = ConfigProvider.fromMap(new Map([["rpc.url", "wss://mainnet.infura.io/ws/v3/KEY"]]))
```

## Handles optional apiKey as Secret

Demonstrates reading sensitive API keys as Effect Secrets.

```typescript
import { Effect, Layer, ConfigProvider, Secret } from 'effect'
import { TransportConfig } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([
    ["rpc.url", "https://rpc.example.com"],
    ["rpc.apiKey", "my-secret-key"],
  ]),
)

const program = Effect.gen(function* () {
  const config = yield* TransportConfig
  return config
}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)))

const config = await Effect.runPromise(program)
expect(config.apiKey._tag).toBe("Some")
if (config.apiKey._tag === "Some") {
  expect(Secret.value(config.apiKey.value)).toBe("my-secret-key")
}
```

## QuickConfig.infuraMainnet

Shows the convenience helper for Infura mainnet configuration.

```typescript
import { Effect, Layer } from 'effect'
import { TransportConfig, QuickConfig } from 'voltaire-effect'

const configProvider = QuickConfig.infuraMainnet("MY_KEY")

const program = Effect.gen(function* () {
  const config = yield* TransportConfig
  return config
}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)))

const config = await Effect.runPromise(program)
expect(config.url).toBe("https://mainnet.infura.io/v3/MY_KEY")
```

## QuickConfig.alchemyMainnet

Demonstrates the convenience helper for Alchemy mainnet configuration.

```typescript
import { Effect, Layer } from 'effect'
import { TransportConfig, QuickConfig } from 'voltaire-effect'

const configProvider = QuickConfig.alchemyMainnet("MY_KEY")

const program = Effect.gen(function* () {
  const config = yield* TransportConfig
  return config
}).pipe(Effect.provide(Layer.setConfigProvider(configProvider)))

const config = await Effect.runPromise(program)
expect(config.url).toBe("https://eth-mainnet.g.alchemy.com/v2/MY_KEY")
```

## QuickConfig.localhost

Shows the convenience helper for local development nodes.

```typescript
import { Effect, Layer } from 'effect'
import { TransportConfig, QuickConfig } from 'voltaire-effect'

// Default port 8545
const defaultConfig = QuickConfig.localhost()
// Custom port
const customConfig = QuickConfig.localhost(9545)

// Aliases for common local nodes
const anvilConfig = QuickConfig.anvil()    // http://localhost:8545
const hardhatConfig = QuickConfig.hardhat() // http://localhost:8545
const ganacheConfig = QuickConfig.ganache() // http://localhost:7545
```
