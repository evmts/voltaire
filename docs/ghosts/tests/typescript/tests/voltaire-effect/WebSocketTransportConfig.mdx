---
title: WebSocketTransportConfig Tests
description: Test examples for WebSocketTransportConfig showing Effect Config-based WebSocket transport configuration.
---

## Reads config from Map provider

Demonstrates reading WebSocket transport configuration from an Effect ConfigProvider.

```typescript
import { Effect, Layer, ConfigProvider, Duration, Option } from 'effect'
import { WebSocketTransportConfigSchema } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([
    ["ws.url", "wss://mainnet.infura.io/ws/v3/KEY"],
    ["ws.timeout", "60 seconds"],
    ["ws.reconnectEnabled", "true"],
    ["ws.reconnect.maxAttempts", "5"],
    ["ws.reconnect.delay", "2 seconds"],
    ["ws.reconnect.maxDelay", "60 seconds"],
    ["ws.reconnect.multiplier", "1.5"],
    ["ws.keepAlive", "30 seconds"],
  ]),
)

const result = await Effect.runPromise(
  WebSocketTransportConfigSchema.pipe(
    Effect.provide(Layer.setConfigProvider(configProvider)),
  ),
)

expect(result.url).toBe("wss://mainnet.infura.io/ws/v3/KEY")
expect(Duration.toMillis(result.timeout)).toBe(60000)
expect(result.reconnectEnabled).toBe(true)
expect(Option.isSome(result.reconnect)).toBe(true)
if (Option.isSome(result.reconnect)) {
  expect(result.reconnect.value.maxAttempts).toBe(5)
  expect(Duration.toMillis(result.reconnect.value.delay)).toBe(2000)
  expect(result.reconnect.value.multiplier).toBe(1.5)
}
```

## Uses defaults when optional values not provided

Shows that sensible defaults are used for optional configuration.

```typescript
import { Effect, Layer, ConfigProvider, Duration, Option } from 'effect'
import { WebSocketTransportConfigSchema } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([["ws.url", "wss://eth.llamarpc.com"]]),
)

const result = await Effect.runPromise(
  WebSocketTransportConfigSchema.pipe(
    Effect.provide(Layer.setConfigProvider(configProvider)),
  ),
)

expect(result.url).toBe("wss://eth.llamarpc.com")
expect(Duration.toMillis(result.timeout)).toBe(30000) // Default 30s
expect(result.reconnectEnabled).toBe(false) // Default false
expect(Option.isNone(result.protocols)).toBe(true)
expect(Option.isNone(result.keepAlive)).toBe(true)
```

## Validates URL must start with ws:// or wss://

Demonstrates that only WebSocket URL schemes are accepted.

```typescript
import { Effect, Layer, ConfigProvider } from 'effect'
import { WebSocketTransportConfigSchema } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([["ws.url", "http://invalid-url"]]),
)

const result = await Effect.runPromiseExit(
  WebSocketTransportConfigSchema.pipe(
    Effect.provide(Layer.setConfigProvider(configProvider)),
  ),
)

expect(result._tag).toBe("Failure")
```

## Accepts ws:// URLs

Shows that insecure WebSocket URLs are valid.

```typescript
import { Effect, Layer, ConfigProvider } from 'effect'
import { WebSocketTransportConfigSchema } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([["ws.url", "ws://localhost:8545"]]),
)

const result = await Effect.runPromise(
  WebSocketTransportConfigSchema.pipe(
    Effect.provide(Layer.setConfigProvider(configProvider)),
  ),
)

expect(result.url).toBe("ws://localhost:8545")
```

## Fails when required url is missing

Demonstrates that the URL field is required.

```typescript
import { Effect, Layer, ConfigProvider } from 'effect'
import { WebSocketTransportConfigSchema } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(new Map())

const result = await Effect.runPromiseExit(
  WebSocketTransportConfigSchema.pipe(
    Effect.provide(Layer.setConfigProvider(configProvider)),
  ),
)

expect(result._tag).toBe("Failure")
```

## Parses duration formats correctly

Shows that various duration formats are correctly parsed.

```typescript
import { Effect, Layer, ConfigProvider, Duration, Option } from 'effect'
import { WebSocketTransportConfigSchema } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([
    ["ws.url", "wss://eth.llamarpc.com"],
    ["ws.timeout", "1 minute"],
    ["ws.keepAlive", "500 millis"],
  ]),
)

const result = await Effect.runPromise(
  WebSocketTransportConfigSchema.pipe(
    Effect.provide(Layer.setConfigProvider(configProvider)),
  ),
)

expect(Duration.toMillis(result.timeout)).toBe(60000)
if (Option.isSome(result.keepAlive)) {
  expect(Duration.toMillis(result.keepAlive.value)).toBe(500)
}
```

## Uses reconnect defaults when reconnect enabled without options

Demonstrates default reconnection settings when enabled.

```typescript
import { Effect, Layer, ConfigProvider, Duration, Option } from 'effect'
import { WebSocketTransportConfigSchema } from 'voltaire-effect'

const configProvider = ConfigProvider.fromMap(
  new Map([
    ["ws.url", "wss://eth.llamarpc.com"],
    ["ws.reconnectEnabled", "true"],
  ]),
)

const result = await Effect.runPromise(
  WebSocketTransportConfigSchema.pipe(
    Effect.provide(Layer.setConfigProvider(configProvider)),
  ),
)

expect(result.reconnectEnabled).toBe(true)
expect(Option.isSome(result.reconnect)).toBe(true)
if (Option.isSome(result.reconnect)) {
  expect(result.reconnect.value.maxAttempts).toBe(10)
  expect(Duration.toMillis(result.reconnect.value.delay)).toBe(1000)
  expect(Duration.toMillis(result.reconnect.value.maxDelay)).toBe(30000)
  expect(result.reconnect.value.multiplier).toBe(2)
}
```
