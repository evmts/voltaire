---
title: Blake2 Tests
description: Test examples for Blake2b hashing with variable output lengths and RFC 7693 known vectors.
---

## Basic Hashing

Hashes data using Blake2b with default 64-byte output.

```typescript
import { Effect } from 'effect'
import { Blake2Service, Blake2Live } from 'voltaire-effect/crypto/Blake2'

const program = Effect.gen(function* () {
  const blake2 = yield* Blake2Service
  const result = yield* blake2.hash(new Uint8Array([1, 2, 3]))
  // result is a 64-byte Uint8Array
}).pipe(Effect.provide(Blake2Live))
```

## Custom Output Length

Supports custom output lengths from 1 to 64 bytes.

```typescript
import { Effect } from 'effect'
import { Blake2Service, Blake2Live } from 'voltaire-effect/crypto/Blake2'

const program = Effect.gen(function* () {
  const blake2 = yield* Blake2Service
  const result = yield* blake2.hash(new Uint8Array([1, 2, 3]), 32)
  // result is a 32-byte Uint8Array
}).pipe(Effect.provide(Blake2Live))
```

## Known Vector: Empty String

Verifies correct hash for empty input (RFC 7693).

```typescript
import { Effect } from 'effect'
import { Blake2Service, Blake2Live } from 'voltaire-effect/crypto/Blake2'

const bytesToHex = (bytes: Uint8Array): string => {
  return "0x" + Array.from(bytes).map(b => b.toString(16).padStart(2, "0")).join("")
}

const program = Effect.gen(function* () {
  const blake2 = yield* Blake2Service
  const result = yield* blake2.hash(new Uint8Array(0))
  // 0x786a02f742015903c6c6fd852552d272912f4740e15847618a86e217f71f5419d25e1031afee585313896444934eb04b903a685b1448b755d56f701afe9be2ce
}).pipe(Effect.provide(Blake2Live))
```

## Known Vector: "abc"

Verifies correct hash for "abc" (RFC 7693).

```typescript
import { Effect } from 'effect'
import { Blake2Service, Blake2Live } from 'voltaire-effect/crypto/Blake2'

const program = Effect.gen(function* () {
  const blake2 = yield* Blake2Service
  const result = yield* blake2.hash(new TextEncoder().encode("abc"))
  // 0xba80a53f981c4d0d6a2797b69f12f6e94c212f14685ac4b74b12bb6fdbffa2d17d87c5392aab792dc252d5de4533cc9518d38aa8dbf1925ab92386edd4009923
}).pipe(Effect.provide(Blake2Live))
```

## Output Length Variations

Produces various output lengths.

```typescript
import { Effect } from 'effect'
import { Blake2Service, Blake2Live } from 'voltaire-effect/crypto/Blake2'

const program = Effect.gen(function* () {
  const blake2 = yield* Blake2Service
  const input = new Uint8Array([1, 2, 3])
  
  const hash1 = yield* blake2.hash(input, 1)   // 1 byte
  const hash16 = yield* blake2.hash(input, 16) // 16 bytes
  const hash32 = yield* blake2.hash(input, 32) // 32 bytes
  const hash48 = yield* blake2.hash(input, 48) // 48 bytes
  const hash64 = yield* blake2.hash(input)     // 64 bytes (default)
}).pipe(Effect.provide(Blake2Live))
```

## Input Size Variations

Handles various input sizes including block boundaries.

```typescript
import { Effect } from 'effect'
import { Blake2Service, Blake2Live } from 'voltaire-effect/crypto/Blake2'

const program = Effect.gen(function* () {
  const blake2 = yield* Blake2Service
  
  // Empty
  yield* blake2.hash(new Uint8Array(0))
  
  // Single byte
  yield* blake2.hash(new Uint8Array([0x42]))
  
  // 128 bytes (block size)
  yield* blake2.hash(new Uint8Array(128).fill(0x11))
  
  // 129 bytes (block size + 1)
  yield* blake2.hash(new Uint8Array(129).fill(0x22))
  
  // 1KB
  yield* blake2.hash(new Uint8Array(1024).fill(0x33))
  
  // 1MB
  yield* blake2.hash(new Uint8Array(1024 * 1024).fill(0x55))
}).pipe(Effect.provide(Blake2Live))
```

## Determinism

Produces consistent results for the same input.

```typescript
import { Effect } from 'effect'
import { Blake2Service, Blake2Live } from 'voltaire-effect/crypto/Blake2'

const bytesToHex = (bytes: Uint8Array): string => {
  return "0x" + Array.from(bytes).map(b => b.toString(16).padStart(2, "0")).join("")
}

const program = Effect.gen(function* () {
  const input = new Uint8Array([1, 2, 3, 4, 5])
  const blake2 = yield* Blake2Service
  const hash1 = yield* blake2.hash(input)
  const hash2 = yield* blake2.hash(input)
  // hash1 === hash2
}).pipe(Effect.provide(Blake2Live))
```

## Single Bit Sensitivity

Different inputs produce different hashes.

```typescript
import { Effect } from 'effect'
import { Blake2Service, Blake2Live } from 'voltaire-effect/crypto/Blake2'

const program = Effect.gen(function* () {
  const blake2 = yield* Blake2Service
  const hash1 = yield* blake2.hash(new Uint8Array([0b00000000]))
  const hash2 = yield* blake2.hash(new Uint8Array([0b00000001]))
  // Single bit change produces completely different hash
}).pipe(Effect.provide(Blake2Live))
```

## Convenience Function

Uses the hash convenience function.

```typescript
import { Effect } from 'effect'
import { hash, Blake2Live } from 'voltaire-effect/crypto/Blake2'

const program = Effect.gen(function* () {
  const data = new Uint8Array([104, 101, 108, 108, 111])
  const result64 = yield* hash(data)      // 64 bytes
  const result32 = yield* hash(data, 32)  // 32 bytes
}).pipe(Effect.provide(Blake2Live))
```

## Test Layer

Uses deterministic test layer for predictable results.

```typescript
import { Effect } from 'effect'
import { Blake2Service, Blake2Test } from 'voltaire-effect/crypto/Blake2'

const program = Effect.gen(function* () {
  const blake2 = yield* Blake2Service
  const result = yield* blake2.hash(new Uint8Array([1, 2, 3]))
  // Returns 64-byte array filled with zeros
  
  const result32 = yield* blake2.hash(new Uint8Array([1, 2, 3]), 32)
  // Returns 32-byte array filled with zeros
}).pipe(Effect.provide(Blake2Test))
```
