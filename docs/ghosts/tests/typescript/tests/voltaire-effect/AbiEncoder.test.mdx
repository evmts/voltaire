---
title: AbiEncoder Tests
description: Test examples for AbiEncoderService showing ABI encoding/decoding for function calls and events.
---

## Encode function fails for unknown function

Returns AbiEncodeError when function doesn't exist in ABI.

```typescript
import * as Effect from 'effect/Effect'
import * as S from 'effect/Schema'
import { fromArray } from 'voltaire-effect/primitives/Abi/AbiSchema'
import { AbiEncoderService, AbiEncodeError } from 'voltaire-effect'
import { DefaultAbiEncoder } from 'voltaire-effect'

const ERC20_ABI = S.decodeUnknownSync(fromArray)([
  {
    type: 'function',
    name: 'transfer',
    stateMutability: 'nonpayable',
    inputs: [
      { name: 'to', type: 'address' },
      { name: 'amount', type: 'uint256' },
    ],
    outputs: [{ name: '', type: 'bool' }],
  },
])

const program = Effect.gen(function* () {
  const encoder = yield* AbiEncoderService
  const result = yield* encoder.encodeFunction(ERC20_ABI, 'unknownFunction', []).pipe(Effect.either)
  return result
}).pipe(Effect.provide(DefaultAbiEncoder))

const result = await Effect.runPromise(program)
expect(result._tag).toBe('Left')
if (result._tag === 'Left') {
  expect(result.left).toBeInstanceOf(AbiEncodeError)
  expect(result.left.functionName).toBe('unknownFunction')
}
```

## Decode function result

Decodes ABI-encoded function return values.

```typescript
import * as Effect from 'effect/Effect'
import { AbiEncoderService } from 'voltaire-effect'
import { DefaultAbiEncoder } from 'voltaire-effect'

const encodedResult = '0x0000000000000000000000000000000000000000000000000000000000000001'

const program = Effect.gen(function* () {
  const encoder = yield* AbiEncoderService
  return yield* encoder.decodeFunction(ERC20_ABI, 'transfer', encodedResult)
}).pipe(Effect.provide(DefaultAbiEncoder))

const result = await Effect.runPromise(program)
expect(result).toEqual([true])
```

## Encode event topics

Generates event topics including the event selector.

```typescript
import * as Effect from 'effect/Effect'
import { AbiEncoderService } from 'voltaire-effect'
import { DefaultAbiEncoder } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const encoder = yield* AbiEncoderService
  return yield* encoder.encodeEventTopics(ERC20_ABI, 'Transfer')
}).pipe(Effect.provide(DefaultAbiEncoder))

const result = await Effect.runPromise(program)
expect(result.length).toBeGreaterThanOrEqual(1)
expect(result[0]).toBe('0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef')
```

## Encode event topics with indexed args

Encodes indexed event arguments as additional topics.

```typescript
import * as Effect from 'effect/Effect'
import { AbiEncoderService } from 'voltaire-effect'
import { DefaultAbiEncoder } from 'voltaire-effect'

const fromAddress = '0x1111111111111111111111111111111111111111'
const toAddress = '0x2222222222222222222222222222222222222222'

const program = Effect.gen(function* () {
  const encoder = yield* AbiEncoderService
  return yield* encoder.encodeEventTopics(ERC20_ABI, 'Transfer', [fromAddress, toAddress])
}).pipe(Effect.provide(DefaultAbiEncoder))

const result = await Effect.runPromise(program)
expect(result.length).toBe(3)
expect(result[0]).toBe('0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef')
```

## Decode event log

Decodes event data from log topics and data.

```typescript
import * as Effect from 'effect/Effect'
import { AbiEncoderService } from 'voltaire-effect'
import { DefaultAbiEncoder } from 'voltaire-effect'

const topics = [
  '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef',
  '0x0000000000000000000000001111111111111111111111111111111111111111',
  '0x0000000000000000000000002222222222222222222222222222222222222222',
] as const
const data = '0x00000000000000000000000000000000000000000000000000000000000003e8'

const program = Effect.gen(function* () {
  const encoder = yield* AbiEncoderService
  return yield* encoder.decodeEventLog(ERC20_ABI, 'Transfer', data, topics)
}).pipe(Effect.provide(DefaultAbiEncoder))

const result = await Effect.runPromise(program)
expect(result).toBeDefined()
expect(typeof result).toBe('object')
```
