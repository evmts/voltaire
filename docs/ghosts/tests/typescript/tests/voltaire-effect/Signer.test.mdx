---
title: Signer Tests
description: Test examples for SignerService showing transaction signing and sending.
---

## Signer.Live signs a message and returns signature

The signMessage method signs arbitrary data.

```typescript
import { Effect, Layer } from 'effect'
import type { BrandedHex, BrandedSignature } from 'voltaire'
import { Signer, SignerService } from 'voltaire-effect'
import { AccountService } from 'voltaire-effect'
import { ProviderService } from 'voltaire-effect'
import { TransportService } from 'voltaire-effect'

type HexType = BrandedHex.HexType

const mockSignature = Object.assign(new Uint8Array(65).fill(0x12), {
  algorithm: "secp256k1" as const,
  v: 27,
})

const mockAccount = {
  address: new Uint8Array(20).fill(0xab),
  type: "local",
  signMessage: () => Effect.succeed(mockSignature),
  sign: () => Effect.succeed(mockSignature),
  signTransaction: () => Effect.succeed(mockSignature),
}

const TestLayers = Layer.mergeAll(
  Layer.succeed(AccountService, mockAccount),
  Layer.succeed(ProviderService, mockProvider),
  Layer.succeed(TransportService, mockTransport),
)
const TestSignerLayer = Layer.provide(Signer.Live, TestLayers)

const program = Effect.gen(function* () {
  const signer = yield* SignerService
  return yield* signer.signMessage("0x48656c6c6f" as HexType)
})

const result = await Effect.runPromise(Effect.provide(program, TestSignerLayer))

expect(result).toBe(mockSignature)
```

## Signer.Live fills missing fields and signs transaction

Transaction signing auto-fills nonce, gas, and chain ID from the provider.

```typescript
import { Effect, Layer } from 'effect'
import { Signer, SignerService } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const signer = yield* SignerService
  return yield* signer.signTransaction({
    to: mockAddress,
    value: 1000000000000000000n,
  })
})

const result = await Effect.runPromise(Effect.provide(program, TestSignerLayer))

expect(typeof result).toBe("string")
expect(result.startsWith("0x")).toBe(true)
```

## Signer.Live signs and sends transaction

The sendTransaction method signs and broadcasts in one call.

```typescript
import { Effect, Layer } from 'effect'
import * as Hash from 'voltaire/Hash'
import { Signer, SignerService } from 'voltaire-effect'

const mockTxHashHex = "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
const mockTxHash = Hash.fromHex(mockTxHashHex)

const program = Effect.gen(function* () {
  const signer = yield* SignerService
  return yield* signer.sendTransaction({
    to: mockAddress,
    value: 1000000000000000000n,
  })
})

const result = await Effect.runPromise(Effect.provide(program, TestSignerLayer))

expect(Hash.equals(result, mockTxHash)).toBe(true)
```

## Signer.Live prepares EIP-7702 authorization

Prepares authorization tuples for account abstraction.

```typescript
import { Effect, Layer } from 'effect'
import { Signer, SignerService } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const signer = yield* SignerService
  return yield* signer.prepareAuthorization({
    contractAddress: "0x1234567890123456789012345678901234567890",
  })
})

const result = await Effect.runPromise(Effect.provide(program, TestSignerLayer))

expect(result.chainId).toBe(1n)
expect(result.nonce).toBe(5n)
expect(result.address).toBe("0x1234567890123456789012345678901234567890")
```

## Signer.fromProvider composes provider and account layers

The Signer can be created from existing Provider and Account layers.

```typescript
import { Effect, Layer } from 'effect'
import { Signer, SignerService } from 'voltaire-effect'

const composedLayer = Signer.fromProvider(TestProviderLayer, TestAccountLayer)
const fullLayer = Layer.provide(composedLayer, TestTransportLayer)

const program = Effect.gen(function* () {
  const signer = yield* SignerService
  return yield* signer.signMessage("0x48656c6c6f" as HexType)
})

const result = await Effect.runPromise(Effect.provide(program, fullLayer))

expect(result).toBe(mockSignature)
```

## sendCalls bundles multiple calls (EIP-5792)

The sendCalls method sends multiple calls as a bundle.

```typescript
import { Effect, Layer } from 'effect'
import { Signer, SignerService } from 'voltaire-effect'

const mockBundleId = "0xbundle123"

const program = Effect.gen(function* () {
  const signer = yield* SignerService
  return yield* signer.sendCalls({
    calls: [
      { to: mockAddress, value: 1000n },
      { to: mockAddress, data: "0x1234" },
    ],
  })
})

const result = await Effect.runPromise(Effect.provide(program, customSignerLayer))

expect(result).toBe(mockBundleId)
```

## getCallsStatus returns status for a bundle

Check the status of a previously sent bundle.

```typescript
import { Effect, Layer } from 'effect'
import { Signer, SignerService } from 'voltaire-effect'

const mockStatus = {
  status: "CONFIRMED" as const,
  receipts: [{
    transactionHash: "0xabc",
    blockNumber: 12345n,
    gasUsed: 21000n,
    status: "success" as const,
    logs: [],
  }],
}

const program = Effect.gen(function* () {
  const signer = yield* SignerService
  return yield* signer.getCallsStatus("0xbundle123")
})

const result = await Effect.runPromise(Effect.provide(program, customSignerLayer))

expect(result.status).toBe("CONFIRMED")
expect(result.receipts).toHaveLength(1)
expect(result.receipts?.[0]?.status).toBe("success")
```
