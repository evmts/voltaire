---
title: RpcResolver Tests
description: Test examples for RpcResolver showing typed RPC request helpers and batching.
---

## rpcRequest - Makes a single request

Demonstrates making a single RPC request using the request helper.

```typescript
import { Effect } from 'effect'
import { rpcRequest, GetBlockNumber, TestTransport } from 'voltaire-effect'

const program = rpcRequest(new GetBlockNumber({})).pipe(
  Effect.provide(TestTransport({ eth_blockNumber: "0x100" })),
)

const result = await Effect.runPromise(program)
expect(result).toBe("0x100")
```

## rpcRequest - Makes request with params

Shows making a request that requires parameters.

```typescript
import { Effect } from 'effect'
import { rpcRequest, GetBalance, TestTransport } from 'voltaire-effect'

const program = rpcRequest(
  new GetBalance({
    address: "0x1234567890123456789012345678901234567890",
    blockTag: "latest",
  }),
).pipe(Effect.provide(TestTransport({ eth_getBalance: "0x1000" })))

const result = await Effect.runPromise(program)
expect(result).toBe("0x1000")
```

## rpc.getBlockNumber

Demonstrates the typed helper for getting the current block number.

```typescript
import { Effect } from 'effect'
import { rpc, TestTransport } from 'voltaire-effect'

const program = rpc
  .getBlockNumber()
  .pipe(Effect.provide(TestTransport({ eth_blockNumber: "0x200" })))

const result = await Effect.runPromise(program)
expect(result).toBe("0x200")
```

## rpc.getChainId

Shows the typed helper for getting the chain ID.

```typescript
import { Effect } from 'effect'
import { rpc, TestTransport } from 'voltaire-effect'

const program = rpc
  .getChainId()
  .pipe(Effect.provide(TestTransport({ eth_chainId: "0x1" })))

const result = await Effect.runPromise(program)
expect(result).toBe("0x1")
```

## rpc.getBalance

Demonstrates getting an account balance.

```typescript
import { Effect } from 'effect'
import { rpc, TestTransport } from 'voltaire-effect'

const program = rpc
  .getBalance("0x1234567890123456789012345678901234567890")
  .pipe(Effect.provide(TestTransport({ eth_getBalance: "0xde0b6b3a7640000" })))

const result = await Effect.runPromise(program)
expect(result).toBe("0xde0b6b3a7640000")
```

## rpc.call

Shows making an eth_call for reading contract state.

```typescript
import { Effect } from 'effect'
import { rpc, TestTransport } from 'voltaire-effect'

const program = rpc
  .call({
    to: "0x1234567890123456789012345678901234567890",
    data: "0x12345678",
  })
  .pipe(Effect.provide(TestTransport({ eth_call: "0xabcdef" })))

const result = await Effect.runPromise(program)
expect(result).toBe("0xabcdef")
```

## rpc.estimateGas

Demonstrates estimating gas for a transaction.

```typescript
import { Effect } from 'effect'
import { rpc, TestTransport } from 'voltaire-effect'

const program = rpc
  .estimateGas({
    to: "0x1234567890123456789012345678901234567890",
    value: "0x1000",
  })
  .pipe(Effect.provide(TestTransport({ eth_estimateGas: "0x5208" })))

const result = await Effect.runPromise(program)
expect(result).toBe("0x5208")
```

## rpc.getBlockByNumber

Shows fetching a block by its number.

```typescript
import { Effect } from 'effect'
import { rpc, TestTransport } from 'voltaire-effect'

const mockBlock = {
  number: "0x100",
  hash: "0xabc",
  transactions: [],
}

const program = rpc
  .getBlockByNumber("latest")
  .pipe(Effect.provide(TestTransport({ eth_getBlockByNumber: mockBlock })))

const result = await Effect.runPromise(program)
expect(result).toEqual(mockBlock)
```

## rpc.getLogs

Demonstrates fetching logs with a filter.

```typescript
import { Effect } from 'effect'
import { rpc, TestTransport } from 'voltaire-effect'

const mockLogs = [
  { topics: ["0xtopic1"], data: "0xdata1" },
  { topics: ["0xtopic2"], data: "0xdata2" },
]

const program = rpc
  .getLogs({ address: "0x123", fromBlock: "0x0", toBlock: "latest" })
  .pipe(Effect.provide(TestTransport({ eth_getLogs: mockLogs })))

const result = await Effect.runPromise(program)
expect(result).toEqual(mockLogs)
```

## rpc.generic - Custom method calls

Shows making custom RPC method calls.

```typescript
import { Effect } from 'effect'
import { rpc, TestTransport } from 'voltaire-effect'

const program = rpc
  .generic("custom_method", ["arg1", "arg2"])
  .pipe(Effect.provide(TestTransport({ custom_method: "custom_result" })))

const result = await Effect.runPromise(program)
expect(result).toBe("custom_result")
```

## Concurrent requests with Effect.all

Demonstrates making multiple concurrent RPC requests.

```typescript
import { Effect } from 'effect'
import { rpc, TestTransport } from 'voltaire-effect'

const program = Effect.all([
  rpc.getBlockNumber(),
  rpc.getChainId(),
  rpc.getGasPrice(),
]).pipe(
  Effect.provide(
    TestTransport({
      eth_blockNumber: "0x100",
      eth_chainId: "0x1",
      eth_gasPrice: "0x12a05f200",
    }),
  ),
)

const [blockNumber, chainId, gasPrice] = await Effect.runPromise(program)
expect(blockNumber).toBe("0x100")
expect(chainId).toBe("0x1")
expect(gasPrice).toBe("0x12a05f200")
```
