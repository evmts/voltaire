---
title: EIP712 Tests
description: Test examples for EIP-712 showing typed data hashing, signing, and verification.
---

## Hash Typed Data

Hashes EIP-712 typed data to a 32-byte digest.

```typescript
import { Effect } from 'effect'
import { EIP712Service, EIP712Live } from 'voltaire-effect/crypto/EIP712'
import type { TypedData, Domain } from '@tevm/voltaire/EIP712'

const testDomain: Domain = {
  name: 'Test App',
  version: '1',
  chainId: 1n,
}

const testTypedData: TypedData = {
  domain: testDomain,
  types: {
    Message: [{ name: 'content', type: 'string' }],
  },
  primaryType: 'Message',
  message: { content: 'Hello, World!' },
}

const program = Effect.gen(function* () {
  const eip712 = yield* EIP712Service
  const result = yield* eip712.hashTypedData(testTypedData)
  // result is Uint8Array of length 32
}).pipe(Effect.provide(EIP712Live))
```

## Sign Typed Data

Signs EIP-712 typed data with a private key, returning r, s, v values.

```typescript
import { Effect } from 'effect'
import { EIP712Service, EIP712Live } from 'voltaire-effect/crypto/EIP712'
import { from as privateKeyFrom } from '@tevm/voltaire/PrivateKey'
import type { TypedData, Domain } from '@tevm/voltaire/EIP712'

const testPrivateKey = privateKeyFrom(
  '0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef'
)

const testTypedData: TypedData = {
  domain: { name: 'Test App', version: '1', chainId: 1n },
  types: { Message: [{ name: 'content', type: 'string' }] },
  primaryType: 'Message',
  message: { content: 'Hello, World!' },
}

const program = Effect.gen(function* () {
  const eip712 = yield* EIP712Service
  const result = yield* eip712.signTypedData(testTypedData, testPrivateKey)
  // result.r is Uint8Array of length 32
  // result.s is Uint8Array of length 32
  // result.v is 27 or 28
}).pipe(Effect.provide(EIP712Live))
```

## Recover Address from Signature

Recovers the signer's 20-byte address from a typed data signature.

```typescript
import { Effect } from 'effect'
import { EIP712Service, EIP712Live } from 'voltaire-effect/crypto/EIP712'
import { from as privateKeyFrom } from '@tevm/voltaire/PrivateKey'
import type { TypedData } from '@tevm/voltaire/EIP712'

const testPrivateKey = privateKeyFrom(
  '0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef'
)

const testTypedData: TypedData = {
  domain: { name: 'Test App', version: '1', chainId: 1n },
  types: { Message: [{ name: 'content', type: 'string' }] },
  primaryType: 'Message',
  message: { content: 'Hello, World!' },
}

const program = Effect.gen(function* () {
  const eip712 = yield* EIP712Service
  const signature = yield* eip712.signTypedData(testTypedData, testPrivateKey)
  const result = yield* eip712.recoverAddress(signature, testTypedData)
  // result is Uint8Array of length 20
}).pipe(Effect.provide(EIP712Live))
```

## Verify Typed Data Signature

Verifies a typed data signature against an expected address.

```typescript
import { Effect } from 'effect'
import { EIP712Service, EIP712Live } from 'voltaire-effect/crypto/EIP712'
import { from as privateKeyFrom } from '@tevm/voltaire/PrivateKey'
import type { TypedData } from '@tevm/voltaire/EIP712'

const testPrivateKey = privateKeyFrom(
  '0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef'
)

const testTypedData: TypedData = {
  domain: { name: 'Test App', version: '1', chainId: 1n },
  types: { Message: [{ name: 'content', type: 'string' }] },
  primaryType: 'Message',
  message: { content: 'Hello, World!' },
}

const program = Effect.gen(function* () {
  const eip712 = yield* EIP712Service
  const signature = yield* eip712.signTypedData(testTypedData, testPrivateKey)
  const recoveredAddress = yield* eip712.recoverAddress(signature, testTypedData)
  const result = yield* eip712.verifyTypedData(signature, testTypedData, recoveredAddress)
  // result is true
}).pipe(Effect.provide(EIP712Live))
```

## Hash Domain

Hashes just the EIP-712 domain separator to a 32-byte digest.

```typescript
import { Effect } from 'effect'
import { EIP712Service, EIP712Live } from 'voltaire-effect/crypto/EIP712'
import type { Domain } from '@tevm/voltaire/EIP712'

const testDomain: Domain = {
  name: 'Test App',
  version: '1',
  chainId: 1n,
}

const program = Effect.gen(function* () {
  const eip712 = yield* EIP712Service
  const result = yield* eip712.hashDomain(testDomain)
  // result is Uint8Array of length 32
}).pipe(Effect.provide(EIP712Live))
```

## Hash Struct

Hashes a typed struct according to EIP-712 encoding rules.

```typescript
import { Effect } from 'effect'
import { EIP712Service, EIP712Live } from 'voltaire-effect/crypto/EIP712'

const program = Effect.gen(function* () {
  const eip712 = yield* EIP712Service
  const types = { Message: [{ name: 'content', type: 'string' }] }
  const message = { content: 'Hello, World!' }
  const result = yield* eip712.hashStruct('Message', message, types)
  // result is Uint8Array of length 32
}).pipe(Effect.provide(EIP712Live))
```

## Convenience Functions

Uses standalone convenience functions with service dependency.

```typescript
import { Effect } from 'effect'
import { hashTypedData, signTypedData, recoverAddress, verifyTypedData, EIP712Live } from 'voltaire-effect/crypto/EIP712'
import { from as privateKeyFrom } from '@tevm/voltaire/PrivateKey'
import type { TypedData } from '@tevm/voltaire/EIP712'

const testPrivateKey = privateKeyFrom(
  '0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef'
)

const testTypedData: TypedData = {
  domain: { name: 'Test App', version: '1', chainId: 1n },
  types: { Message: [{ name: 'content', type: 'string' }] },
  primaryType: 'Message',
  message: { content: 'Hello, World!' },
}

const program = Effect.gen(function* () {
  const hash = yield* hashTypedData(testTypedData)
  const signature = yield* signTypedData(testTypedData, testPrivateKey)
  const address = yield* recoverAddress(signature, testTypedData)
  const result = yield* verifyTypedData(signature, testTypedData, address)
  // result is true
}).pipe(Effect.provide(EIP712Live))
```

## Test Layer for Mocking

Uses the EIP712Test layer for testing with mock implementations.

```typescript
import { Effect } from 'effect'
import { EIP712Service, EIP712Test } from 'voltaire-effect/crypto/EIP712'
import { from as privateKeyFrom } from '@tevm/voltaire/PrivateKey'
import type { TypedData } from '@tevm/voltaire/EIP712'

const testPrivateKey = privateKeyFrom(
  '0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef'
)

const testTypedData: TypedData = {
  domain: { name: 'Test App', version: '1', chainId: 1n },
  types: { Message: [{ name: 'content', type: 'string' }] },
  primaryType: 'Message',
  message: { content: 'Hello, World!' },
}

const program = Effect.gen(function* () {
  const eip712 = yield* EIP712Service
  const result = yield* eip712.hashTypedData(testTypedData)
  // result is zero-filled Uint8Array of length 32
}).pipe(Effect.provide(EIP712Test))
```
