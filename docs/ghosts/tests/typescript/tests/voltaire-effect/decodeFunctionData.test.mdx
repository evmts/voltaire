---
title: decodeFunctionData Tests
description: Test examples for decoding function call data to extract function name and parameters.
---

## Round-trips transfer correctly

Encodes then decodes transfer call data.

```typescript
import { describe, expect, it } from "@effect/vitest"
import { Hex } from "voltaire"
import * as Effect from "effect/Effect"
import * as S from "effect/Schema"
import * as Abi from "voltaire-effect/primitives/Abi"

const erc20Abi = S.decodeUnknownSync(Abi.fromArray)([
  {
    type: "function",
    name: "transfer",
    stateMutability: "nonpayable",
    inputs: [
      { name: "to", type: "address" },
      { name: "amount", type: "uint256" },
    ],
    outputs: [{ type: "bool" }],
  },
  {
    type: "function",
    name: "balanceOf",
    stateMutability: "view",
    inputs: [{ name: "account", type: "address" }],
    outputs: [{ type: "uint256" }],
  },
])

it.effect("round-trips transfer correctly", () =>
  Effect.gen(function* () {
    const to = "0x742d35Cc6634C0532925a3b844Bc9e7595f251e3"
    const amount = 1000000000000000000n
    const calldata = yield* Abi.encodeFunctionData(erc20Abi, "transfer", [
      to,
      amount,
    ])
    const decoded = yield* Abi.decodeFunctionData(erc20Abi, calldata)
    expect(decoded.name).toBe("transfer")
    expect(decoded.params.length).toBe(2)
    expect((decoded.params[0] as string).toLowerCase()).toBe(to.toLowerCase())
    expect(decoded.params[1]).toBe(amount)
  }),
)
```

## Round-trips balanceOf correctly

Encodes then decodes single-argument function call.

```typescript
it.effect("round-trips balanceOf correctly", () =>
  Effect.gen(function* () {
    const account = "0x742d35Cc6634C0532925a3b844Bc9e7595f251e3"
    const calldata = yield* Abi.encodeFunctionData(erc20Abi, "balanceOf", [
      account,
    ])
    const decoded = yield* Abi.decodeFunctionData(erc20Abi, calldata)
    expect(decoded.name).toBe("balanceOf")
    expect(decoded.params.length).toBe(1)
    expect((decoded.params[0] as string).toLowerCase()).toBe(
      account.toLowerCase(),
    )
  }),
)
```

## Fails on invalid selector

Returns failure when selector doesn't match any ABI function.

```typescript
import * as Exit from "effect/Exit"

it("fails on invalid selector", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.decodeFunctionData(erc20Abi, Hex("0xdeadbeef")),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})
```

## Fails on calldata too short

Returns failure when calldata is shorter than selector.

```typescript
it("fails on calldata too short", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.decodeFunctionData(erc20Abi, Hex("0x12")),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})
```

## Fails on just selector without args

Returns failure when function requires arguments but none provided.

```typescript
it("fails on just selector without args for function needing args", async () => {
  const exit = await Effect.runPromiseExit(
    Abi.decodeFunctionData(erc20Abi, Hex("0xa9059cbb")),
  )
  expect(Exit.isFailure(exit)).toBe(true)
})
```
