---
title: L2 Formatters Tests
description: Test examples for L2-specific formatters showing Optimism, Arbitrum, and zkSync field handling.
---

## OptimismFormatter adds OP Stack transaction fields

Adds deposit nonce and system tx fields for OP Stack.

```typescript
import * as Effect from 'effect/Effect'
import { FormatterService } from 'voltaire-effect'
import { OptimismFormatter } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const formatter = yield* FormatterService
  const input = {
    hash: '0xop',
    depositNonce: '0x2',
    isSystemTx: true,
  }
  return yield* formatter.formatTransaction(input)
}).pipe(Effect.provide(OptimismFormatter))

const result = await Effect.runPromise(program)
expect(result).toMatchObject({
  depositNonce: '0x2',
  isSystemTx: true,
})
expect(result).not.toBe(input)
```

## OptimismFormatter adds L1 fee fields to receipt

Adds L1 fee information for OP Stack receipts.

```typescript
import * as Effect from 'effect/Effect'
import { FormatterService } from 'voltaire-effect'
import { OptimismFormatter } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const formatter = yield* FormatterService
  const input = {
    status: '0x1',
    l1Fee: '0x10',
    l1FeeScalar: '0x01',
  }
  return yield* formatter.formatReceipt(input)
}).pipe(Effect.provide(OptimismFormatter))

const result = await Effect.runPromise(program)
expect(result).toMatchObject({
  l1Fee: '0x10',
  l1FeeScalar: '0x01',
})
```

## ArbitrumFormatter adds L1 gas fields

Adds gasUsedForL1 and l1BlockNumber for Arbitrum transactions.

```typescript
import * as Effect from 'effect/Effect'
import { FormatterService } from 'voltaire-effect'
import { ArbitrumFormatter } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const formatter = yield* FormatterService
  const input = {
    hash: '0xarb',
    gasUsedForL1: '0x5208',
    l1BlockNumber: '0xabc',
  }
  return yield* formatter.formatTransaction(input)
}).pipe(Effect.provide(ArbitrumFormatter))

const result = await Effect.runPromise(program)
expect(result).toMatchObject({
  gasUsedForL1: '0x5208',
  l1BlockNumber: '0xabc',
})
```

## ArbitrumFormatter adds L1 gas to receipt

Adds gasUsedForL1 to Arbitrum receipts.

```typescript
import * as Effect from 'effect/Effect'
import { FormatterService } from 'voltaire-effect'
import { ArbitrumFormatter } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const formatter = yield* FormatterService
  const input = {
    status: '0x1',
    gasUsedForL1: '0x1234',
  }
  return yield* formatter.formatReceipt(input)
}).pipe(Effect.provide(ArbitrumFormatter))

const result = await Effect.runPromise(program)
expect(result).toMatchObject({ gasUsedForL1: '0x1234' })
```

## ZkSyncFormatter adds L1 batch fields to block

Adds l1BatchNumber for zkSync blocks.

```typescript
import * as Effect from 'effect/Effect'
import { FormatterService } from 'voltaire-effect'
import { ZkSyncFormatter } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const formatter = yield* FormatterService
  const input = { number: '0x1', l1BatchNumber: '0x10' }
  return yield* formatter.formatBlock(input)
}).pipe(Effect.provide(ZkSyncFormatter))

const result = await Effect.runPromise(program)
expect(result).toMatchObject({ l1BatchNumber: '0x10' })
```

## ZkSyncFormatter preserves transaction metadata

Preserves l1BatchNumber, l1BatchTxIndex, and type for zkSync transactions.

```typescript
import * as Effect from 'effect/Effect'
import { FormatterService } from 'voltaire-effect'
import { ZkSyncFormatter } from 'voltaire-effect'

const program = Effect.gen(function* () {
  const formatter = yield* FormatterService
  const input = {
    hash: '0xzk',
    l1BatchNumber: '0x20',
    l1BatchTxIndex: '0x02',
    type: '0x71',
  }
  return yield* formatter.formatTransaction(input)
}).pipe(Effect.provide(ZkSyncFormatter))

const result = await Effect.runPromise(program)
expect(result).toMatchObject({
  l1BatchNumber: '0x20',
  l1BatchTxIndex: '0x02',
  type: '0x71',
})
```
