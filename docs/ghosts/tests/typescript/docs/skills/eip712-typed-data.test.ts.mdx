---
title: '[TS/JS] docs/skills/eip712-typed-data.test.ts'
source: 'docs/skills/eip712-typed-data.test.ts'
---

> Auto-generated from test file: docs/skills/eip712-typed-data.test.ts

```typescript
/**
 * Tests for EIP-712 typed data guide
 * @see /docs/guides/eip712-typed-data.mdx
 *
 * Note: The guide references EIP712 from crypto module
 */
import { describe, expect, it } from "vitest";

describe("EIP-712 Typed Data Guide", () => {
	it("should hash domain separator", async () => {
		const { EIP712 } = await import("../../src/crypto/index.js");
		const { Address } = await import("../../src/primitives/Address/index.js");

		const domain = {
			name: "MyDApp",
			version: "1",
			chainId: 1n,
			verifyingContract: Address("0x742d35Cc6634C0532925a3b844Bc9e7595f251e3"),
		};

		// Domain.hash is the method for hashing domain
		const domainHash = EIP712.Domain.hash(domain);

		expect(domainHash).toBeInstanceOf(Uint8Array);
		expect(domainHash.length).toBe(32);
	});

	it("should encode type string", async () => {
		const { EIP712 } = await import("../../src/crypto/index.js");

		const types = {
			Person: [
				{ name: "name", type: "string" },
				{ name: "wallet", type: "address" },
			],
			Mail: [
				{ name: "from", type: "Person" },
				{ name: "to", type: "Person" },
				{ name: "contents", type: "string" },
			],
		};

		const typeString = EIP712.encodeType("Mail", types);

		// Mail should come first, followed by its dependencies
		expect(typeString).toContain("Mail(");
		expect(typeString).toContain("Person(");
	});

	it("should hash type", async () => {
		const { EIP712 } = await import("../../src/crypto/index.js");

		const types = {
			Person: [
				{ name: "name", type: "string" },
				{ name: "wallet", type: "address" },
			],
		};

		const typeHash = EIP712.hashType("Person", types);

		expect(typeHash).toBeInstanceOf(Uint8Array);
		expect(typeHash.length).toBe(32);
	});

	it("should hash complete typed data", async () => {
		const { EIP712 } = await import("../../src/crypto/index.js");
		const { Address } = await import("../../src/primitives/Address/index.js");

		const typedData = {
			domain: {
				name: "Ether Mail",
				version: "1",
				chainId: 1n,
				verifyingContract: Address(
					"0xCcCCccccCCCCcCCCCCCcCcCccCcCCCcCcccccccC",
				),
			},
			types: {
				Person: [
					{ name: "name", type: "string" },
					{ name: "wallet", type: "address" },
				],
				Mail: [
					{ name: "from", type: "Person" },
					{ name: "to", type: "Person" },
					{ name: "contents", type: "string" },
				],
			},
			primaryType: "Mail" as const,
			message: {
				from: {
					name: "Alice",
					wallet: Address("0xCD2a3d9F938E13CD947Ec05AbC7FE734Df8DD826"),
				},
				to: {
					name: "Bob",
					wallet: Address("0xbBbBBBBbbBBBbbbBbbBbbbbBBbBbbbbBbBbbBBbB"),
				},
				contents: "Hello, Bob!",
			},
		};

		const hash = EIP712.hashTypedData(typedData);

		expect(hash).toBeInstanceOf(Uint8Array);
		expect(hash.length).toBe(32);
	});

	it("should sign typed data", async () => {
		const { EIP712, Secp256k1 } = await import("../../src/crypto/index.js");
		const { Address } = await import("../../src/primitives/Address/index.js");

		const privateKey = Secp256k1.randomPrivateKey();

		const typedData = {
			domain: {
				name: "Test",
				version: "1",
				chainId: 1n,
				verifyingContract: Address(
					"0xCcCCccccCCCCcCCCCCCcCcCccCcCCCcCcccccccC",
				),
			},
			types: {
				Message: [{ name: "content", type: "string" }],
			},
			primaryType: "Message" as const,
			message: {
				content: "Hello",
			},
		};

		const signature = EIP712.signTypedData(typedData, privateKey);

		expect(signature).toHaveProperty("r");
		expect(signature).toHaveProperty("s");
		expect(signature).toHaveProperty("v");
		expect(signature.r.length).toBe(32);
		expect(signature.s.length).toBe(32);
	});

	it("should recover address from typed data signature", async () => {
		const { EIP712, Secp256k1 } = await import("../../src/crypto/index.js");
		const { Address } = await import("../../src/primitives/Address/index.js");

		const privateKey = Secp256k1.randomPrivateKey();
		const publicKey = Secp256k1.derivePublicKey(privateKey);
		const expectedAddress = Address.fromPublicKey(publicKey);

		const typedData = {
			domain: {
				name: "Test",
				version: "1",
				chainId: 1n,
				verifyingContract: Address(
					"0xCcCCccccCCCCcCCCCCCcCcCccCcCCCcCcccccccC",
				),
			},
			types: {
				Message: [{ name: "content", type: "string" }],
			},
			primaryType: "Message" as const,
			message: {
				content: "Hello",
			},
		};

		const signature = EIP712.signTypedData(typedData, privateKey);
		const recoveredAddress = EIP712.recoverAddress(signature, typedData);

		expect(Address.equals(expectedAddress, recoveredAddress)).toBe(true);
	});

	it("should verify typed data signature", async () => {
		const { EIP712, Secp256k1 } = await import("../../src/crypto/index.js");
		const { Address } = await import("../../src/primitives/Address/index.js");

		const privateKey = Secp256k1.randomPrivateKey();
		const publicKey = Secp256k1.derivePublicKey(privateKey);
		const expectedAddress = Address.fromPublicKey(publicKey);

		const typedData = {
			domain: {
				name: "Test",
				version: "1",
				chainId: 1n,
				verifyingContract: Address(
					"0xCcCCccccCCCCcCCCCCCcCcCccCcCCCcCcccccccC",
				),
			},
			types: {
				Message: [{ name: "content", type: "string" }],
			},
			primaryType: "Message" as const,
			message: {
				content: "Hello",
			},
		};

		const signature = EIP712.signTypedData(typedData, privateKey);
		const isValid = EIP712.verifyTypedData(signature, typedData, expectedAddress);

		expect(isValid).toBe(true);
	});

	it("should handle ERC-2612 Permit structure", async () => {
		const { EIP712 } = await import("../../src/crypto/index.js");
		const { Address } = await import("../../src/primitives/Address/index.js");

		// ERC-2612 Permit typed data structure
		const permitData = {
			domain: {
				name: "USD Coin",
				version: "2",
				chainId: 1n,
				verifyingContract: Address(
					"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
				),
			},
			types: {
				Permit: [
					{ name: "owner", type: "address" },
					{ name: "spender", type: "address" },
					{ name: "value", type: "uint256" },
					{ name: "nonce", type: "uint256" },
					{ name: "deadline", type: "uint256" },
				],
			},
			primaryType: "Permit" as const,
			message: {
				owner: Address("0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb0"),
				spender: Address("0x5FbDB2315678afecb367f032d93F642f64180aa3"),
				value: 1000000n,
				nonce: 0n,
				deadline: 1735689600n,
			},
		};

		const hash = EIP712.hashTypedData(permitData);

		expect(hash).toBeInstanceOf(Uint8Array);
		expect(hash.length).toBe(32);
	});
});

```
