---
title: '[TS/JS] docs/primitives/bytecode/detect-fusions.test.ts'
source: 'docs/primitives/bytecode/detect-fusions.test.ts'
---

> Auto-generated from test file: docs/primitives/bytecode/detect-fusions.test.ts

```typescript
import { describe, expect, it } from "vitest";

describe("Bytecode.detectFusions (docs/primitives/bytecode/detect-fusions.mdx)", () => {
	describe("Basic Detection", () => {
		it("should detect fusion patterns", async () => {
			const { Bytecode } = await import(
				"../../../src/primitives/Bytecode/index.js"
			);

			// PUSH1 0x01, PUSH1 0x02, ADD
			const code = Bytecode("0x6001600201");
			const fusions = code.detectFusions();

			expect(Array.isArray(fusions)).toBe(true);
		});

		it("should handle empty bytecode", async () => {
			const { Bytecode } = await import(
				"../../../src/primitives/Bytecode/index.js"
			);

			const code = Bytecode("0x");
			const fusions = code.detectFusions();

			expect(Array.isArray(fusions)).toBe(true);
			expect(fusions.length).toBe(0);
		});
	});

	describe("PUSH + Operation Fusions", () => {
		it("should detect PUSH + ADD fusion", async () => {
			const { Bytecode } = await import(
				"../../../src/primitives/Bytecode/index.js"
			);

			// PUSH1 0x05, ADD
			const code = Bytecode("0x600501");
			const fusions = code.detectFusions();

			// May or may not detect depending on implementation
			expect(Array.isArray(fusions)).toBe(true);
		});

		it("should detect PUSH + MUL fusion", async () => {
			const { Bytecode } = await import(
				"../../../src/primitives/Bytecode/index.js"
			);

			// PUSH1 0x05, MUL
			const code = Bytecode("0x600502");
			const fusions = code.detectFusions();

			expect(Array.isArray(fusions)).toBe(true);
		});
	});

	describe("Control Flow Fusions", () => {
		it("should detect PUSH + JUMP fusion", async () => {
			const { Bytecode } = await import(
				"../../../src/primitives/Bytecode/index.js"
			);

			// PUSH1 0x05, JUMP
			const code = Bytecode("0x600556");
			const fusions = code.detectFusions();

			expect(Array.isArray(fusions)).toBe(true);
		});

		it("should detect PUSH + JUMPI fusion", async () => {
			const { Bytecode } = await import(
				"../../../src/primitives/Bytecode/index.js"
			);

			// PUSH1 0x05, JUMPI
			const code = Bytecode("0x600557");
			const fusions = code.detectFusions();

			expect(Array.isArray(fusions)).toBe(true);
		});
	});

	describe("Memory Fusions", () => {
		it("should detect PUSH + MSTORE fusion", async () => {
			const { Bytecode } = await import(
				"../../../src/primitives/Bytecode/index.js"
			);

			// PUSH1 0x40, MSTORE
			const code = Bytecode("0x604052");
			const fusions = code.detectFusions();

			expect(Array.isArray(fusions)).toBe(true);
		});

		it("should detect PUSH + MLOAD fusion", async () => {
			const { Bytecode } = await import(
				"../../../src/primitives/Bytecode/index.js"
			);

			// PUSH1 0x40, MLOAD
			const code = Bytecode("0x604051");
			const fusions = code.detectFusions();

			expect(Array.isArray(fusions)).toBe(true);
		});
	});

	describe("Return Type", () => {
		it("should return array of fusion objects", async () => {
			const { Bytecode } = await import(
				"../../../src/primitives/Bytecode/index.js"
			);

			const code = Bytecode("0x6001600201");
			const fusions = code.detectFusions();

			expect(Array.isArray(fusions)).toBe(true);

			for (const fusion of fusions) {
				expect(typeof fusion).toBe("object");
			}
		});
	});
});

```
