---
title: '[TS/JS] docs/primitives/eventlog/filterLogs.test.ts'
source: 'docs/primitives/eventlog/filterLogs.test.ts'
---

> Auto-generated from test file: docs/primitives/eventlog/filterLogs.test.ts

```typescript
/**
 * Tests for docs/primitives/eventlog/filterLogs.mdx
 * Tests the code examples from the EventLog.filterLogs() documentation
 */

import { describe, expect, it } from "vitest";

describe("EventLog filterLogs.mdx documentation examples", () => {
	describe("ERC-20 Transfer Filtering", () => {
		it("filters incoming and outgoing transfers", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const TRANSFER_SIG = Hash.from(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);
			const usdcAddress = Address.Address(
				"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
			);
			const userHash = Hash.from(
				"0x000000000000000000000000a1b2c3d4e5f67890abcdef1234567890abcdef12",
			);
			const otherHash = Hash.from("0x" + "99".repeat(32));

			const valueData = new Uint8Array(32);
			valueData[31] = 100;

			const allLogs = [
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG, otherHash, userHash], // Incoming
					data: valueData,
					blockNumber: 18100000n,
				}),
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG, userHash, otherHash], // Outgoing
					data: valueData,
					blockNumber: 18200000n,
				}),
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG, otherHash, otherHash], // Neither
					data: valueData,
					blockNumber: 18300000n,
				}),
			];

			// All incoming transfers to user
			const incoming = EventLog.filterLogs(allLogs, {
				address: usdcAddress,
				topics: [TRANSFER_SIG, null, userHash],
				fromBlock: 18000000n,
				toBlock: 18500000n,
			});

			// All outgoing transfers from user
			const outgoing = EventLog.filterLogs(allLogs, {
				address: usdcAddress,
				topics: [TRANSFER_SIG, userHash, null],
				fromBlock: 18000000n,
				toBlock: 18500000n,
			});

			expect(incoming.length).toBe(1);
			expect(outgoing.length).toBe(1);
		});
	});

	describe("Multi-Token Monitoring", () => {
		it("filters Transfer events from multiple tokens", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const TRANSFER_SIG = Hash.from(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);

			const tokens = [
				Address.Address("0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"), // USDC
				Address.Address("0x6B175474E89094C44Da98b954EedeAC495271d0F"), // DAI
				Address.Address("0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"), // WETH
				Address.Address("0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599"), // WBTC
			];

			const allLogs = [
				EventLog.create({
					address: tokens[0]!, // USDC
					topics: [TRANSFER_SIG],
					data: new Uint8Array([]),
					blockNumber: 18100000n,
				}),
				EventLog.create({
					address: tokens[1]!, // DAI
					topics: [TRANSFER_SIG],
					data: new Uint8Array([]),
					blockNumber: 18200000n,
				}),
				EventLog.create({
					address: Address.Address.zero(), // Unknown
					topics: [TRANSFER_SIG],
					data: new Uint8Array([]),
					blockNumber: 18300000n,
				}),
			];

			// All Transfer events from these tokens
			const transfers = EventLog.filterLogs(allLogs, {
				address: tokens,
				topics: [TRANSFER_SIG],
				fromBlock: 18000000n,
			});

			expect(transfers.length).toBe(2);

			// Group by token
			const byToken = new Map<string, typeof transfers>();
			for (const log of transfers) {
				const addr = Address.toHex(log.address);
				if (!byToken.has(addr)) {
					byToken.set(addr, []);
				}
				byToken.get(addr)!.push(log);
			}

			expect(byToken.size).toBe(2);
		});
	});

	describe("Multiple Event Types", () => {
		it("filters Transfer, Approval, or Swap events", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const TRANSFER_SIG = Hash.from(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);
			const APPROVAL_SIG = Hash.from(
				"0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925",
			);
			const SWAP_SIG = Hash.from("0x" + "dd".repeat(32));
			const UNKNOWN_SIG = Hash.from("0x" + "99".repeat(32));

			const usdcAddress = Address.Address(
				"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
			);

			const allLogs = [
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG],
					data: new Uint8Array([]),
					blockNumber: 18100000n,
				}),
				EventLog.create({
					address: usdcAddress,
					topics: [APPROVAL_SIG],
					data: new Uint8Array([]),
					blockNumber: 18200000n,
				}),
				EventLog.create({
					address: usdcAddress,
					topics: [UNKNOWN_SIG],
					data: new Uint8Array([]),
					blockNumber: 18300000n,
				}),
			];

			// Transfer, Approval, or Swap events
			const filtered = EventLog.filterLogs(allLogs, {
				address: usdcAddress,
				topics: [[TRANSFER_SIG, APPROVAL_SIG, SWAP_SIG]],
				fromBlock: 18000000n,
				toBlock: 18500000n,
			});

			expect(filtered.length).toBe(2);

			// Separate by event type
			const transfers = filtered.filter((log) => {
				const sig = EventLog.getTopic0(log);
				return sig && Hash.equals(sig, TRANSFER_SIG);
			});

			const approvals = filtered.filter((log) => {
				const sig = EventLog.getTopic0(log);
				return sig && Hash.equals(sig, APPROVAL_SIG);
			});

			expect(transfers.length).toBe(1);
			expect(approvals.length).toBe(1);
		});
	});

	describe("Specific Block Query", () => {
		it("filters all logs in specific block by hash", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const blockHash = Hash.from("0x" + "ab".repeat(32));
			const otherBlockHash = Hash.from("0x" + "cd".repeat(32));

			const allLogs = [
				EventLog.create({
					address: Address.Address.zero(),
					topics: [Hash.from("0x" + "00".repeat(32))],
					data: new Uint8Array([]),
					blockHash: blockHash,
				}),
				EventLog.create({
					address: Address.Address.zero(),
					topics: [Hash.from("0x" + "11".repeat(32))],
					data: new Uint8Array([]),
					blockHash: blockHash,
				}),
				EventLog.create({
					address: Address.Address.zero(),
					topics: [Hash.from("0x" + "22".repeat(32))],
					data: new Uint8Array([]),
					blockHash: otherBlockHash,
				}),
			];

			// All logs in specific block
			const blockLogs = EventLog.filterLogs(allLogs, {
				blockHash: blockHash,
			});

			expect(blockLogs.length).toBe(2);
		});
	});

	describe("Progressive Filtering", () => {
		it("applies filters in stages", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const TRANSFER_SIG = Hash.from(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);
			const APPROVAL_SIG = Hash.from(
				"0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925",
			);
			const usdcAddress = Address.Address(
				"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
			);

			const allLogs = [
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG],
					data: new Uint8Array([]),
					blockNumber: 18100000n,
				}),
				EventLog.create({
					address: usdcAddress,
					topics: [APPROVAL_SIG],
					data: new Uint8Array([]),
					blockNumber: 17500000n, // Old block
				}),
				EventLog.create({
					address: Address.Address.zero(),
					topics: [TRANSFER_SIG],
					data: new Uint8Array([]),
					blockNumber: 18200000n,
				}),
			];

			// Stage 1: Filter by contract
			const tokenLogs = EventLog.filterLogs(allLogs, {
				address: usdcAddress,
			});

			// Stage 2: Filter by event type
			const relevantLogs = EventLog.filterLogs(tokenLogs, {
				topics: [[TRANSFER_SIG, APPROVAL_SIG]],
			});

			// Stage 3: Filter by block range
			const recentLogs = EventLog.filterLogs(relevantLogs, {
				fromBlock: 18000000n,
			});

			expect(tokenLogs.length).toBe(2);
			expect(relevantLogs.length).toBe(2);
			expect(recentLogs.length).toBe(1);
		});
	});

	describe("Combining with Sorting", () => {
		it("filters then sorts chronologically", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const TRANSFER_SIG = Hash.from(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);
			const usdcAddress = Address.Address(
				"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
			);

			const allLogs = [
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG],
					data: new Uint8Array([]),
					blockNumber: 18300000n,
					logIndex: 5,
				}),
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG],
					data: new Uint8Array([]),
					blockNumber: 18100000n,
					logIndex: 3,
				}),
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG],
					data: new Uint8Array([]),
					blockNumber: 18100000n,
					logIndex: 1,
				}),
			];

			const filtered = EventLog.filterLogs(allLogs, {
				address: usdcAddress,
				topics: [TRANSFER_SIG],
				fromBlock: 18000000n,
				toBlock: 18500000n,
			});

			// Sort chronologically
			const sorted = EventLog.sortLogs(filtered);

			expect(sorted.length).toBe(3);
			expect(sorted[0]?.blockNumber).toBe(18100000n);
			expect(sorted[0]?.logIndex).toBe(1);
			expect(sorted[1]?.blockNumber).toBe(18100000n);
			expect(sorted[1]?.logIndex).toBe(3);
			expect(sorted[2]?.blockNumber).toBe(18300000n);
		});
	});

	describe("Empty Filter", () => {
		it("returns all logs", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const allLogs = [
				EventLog.create({
					address: Address.Address.zero(),
					topics: [Hash.from("0x" + "00".repeat(32))],
					data: new Uint8Array([]),
				}),
				EventLog.create({
					address: Address.Address.zero(),
					topics: [Hash.from("0x" + "11".repeat(32))],
					data: new Uint8Array([]),
				}),
			];

			// No filtering (returns all)
			const all = EventLog.filterLogs(allLogs, {});

			expect(all.length).toBe(2);
		});
	});

	describe("Return Value", () => {
		it("returns new array, does not modify input", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const usdcAddress = Address.Address(
				"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
			);

			const original = [
				EventLog.create({
					address: usdcAddress,
					topics: [Hash.from("0x" + "00".repeat(32))],
					data: new Uint8Array([]),
				}),
				EventLog.create({
					address: Address.Address.zero(),
					topics: [Hash.from("0x" + "11".repeat(32))],
					data: new Uint8Array([]),
				}),
				EventLog.create({
					address: Address.Address.zero(),
					topics: [Hash.from("0x" + "22".repeat(32))],
					data: new Uint8Array([]),
				}),
			];

			const filtered = EventLog.filterLogs(original, { address: usdcAddress });

			expect(original.length).toBe(3); // unchanged
			expect(filtered.length).toBe(1); // new array
			expect(filtered).not.toBe(original);
		});
	});
});

```
