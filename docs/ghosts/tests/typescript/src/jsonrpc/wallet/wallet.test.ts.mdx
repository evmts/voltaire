---
title: '[TS/JS] src/jsonrpc/wallet/wallet.test.ts'
source: 'src/jsonrpc/wallet/wallet.test.ts'
---

> Auto-generated from test file: src/jsonrpc/wallet/wallet.test.ts

```typescript
import { describe, expect, it } from "vitest";
import {
	WalletAddEthereumChainRequest,
	WalletErrorCode,
	WalletGetPermissionsRequest,
	WalletRequestPermissionsRequest,
	WalletRevokePermissionsRequest,
	WalletSwitchEthereumChainRequest,
	WalletWatchAssetRequest,
	unauthorizedError,
	unrecognizedChainError,
	unsupportedMethodError,
	userRejectedError,
} from "./methods.js";

describe("Wallet RPC Methods", () => {
	describe("wallet_switchEthereumChain", () => {
		it("creates valid request", () => {
			const req = WalletSwitchEthereumChainRequest("0x1");
			expect(req).toEqual({
				method: "wallet_switchEthereumChain",
				params: [{ chainId: "0x1" }],
			});
		});

		it("handles different chain IDs", () => {
			const mainnet = WalletSwitchEthereumChainRequest("0x1");
			expect(mainnet.params[0].chainId).toBe("0x1");

			const polygon = WalletSwitchEthereumChainRequest("0x89");
			expect(polygon.params[0].chainId).toBe("0x89");

			const arbitrum = WalletSwitchEthereumChainRequest("0xa4b1");
			expect(arbitrum.params[0].chainId).toBe("0xa4b1");
		});
	});

	describe("wallet_addEthereumChain", () => {
		it("creates valid request with required fields", () => {
			const chain = {
				chainId: "0x89",
				chainName: "Polygon Mainnet",
				nativeCurrency: {
					name: "MATIC",
					symbol: "MATIC",
					decimals: 18,
				},
				rpcUrls: ["https://polygon-rpc.com"],
			};

			const req = WalletAddEthereumChainRequest(chain);
			expect(req).toEqual({
				method: "wallet_addEthereumChain",
				params: [chain],
			});
		});

		it("includes optional fields", () => {
			const chain = {
				chainId: "0xa4b1",
				chainName: "Arbitrum One",
				nativeCurrency: {
					name: "Ether",
					symbol: "ETH",
					decimals: 18,
				},
				rpcUrls: ["https://arb1.arbitrum.io/rpc"],
				blockExplorerUrls: ["https://arbiscan.io"],
				iconUrls: ["https://example.com/arbitrum.png"],
			};

			const req = WalletAddEthereumChainRequest(chain);
			expect(req.params[0]).toHaveProperty("blockExplorerUrls");
			expect(req.params[0]).toHaveProperty("iconUrls");
		});
	});

	describe("wallet_watchAsset", () => {
		it("creates valid ERC20 token request", () => {
			const asset = {
				type: "ERC20",
				options: {
					address: "0x6B175474E89094C44Da98b954EedeAC495271d0F",
					symbol: "DAI",
					decimals: 18,
				},
			};

			const req = WalletWatchAssetRequest(asset);
			expect(req).toEqual({
				method: "wallet_watchAsset",
				params: {
					type: "ERC20",
					options: asset.options,
				},
			});
		});

		it("includes optional image field", () => {
			const asset = {
				type: "ERC20",
				options: {
					address: "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
					symbol: "USDC",
					decimals: 6,
					image: "https://example.com/usdc.png",
				},
			};

			const req = WalletWatchAssetRequest(asset);
			expect(req.params.options).toHaveProperty("image");
			expect(req.params.options.image).toBe("https://example.com/usdc.png");
		});
	});

	describe("wallet_requestPermissions", () => {
		it("creates request for eth_accounts permission", () => {
			const req = WalletRequestPermissionsRequest({ eth_accounts: {} });
			expect(req).toEqual({
				method: "wallet_requestPermissions",
				params: [{ eth_accounts: {} }],
			});
		});

		it("handles empty permissions object", () => {
			const req = WalletRequestPermissionsRequest({});
			expect(req.params[0]).toEqual({});
		});
	});

	describe("wallet_getPermissions", () => {
		it("creates valid request", () => {
			const req = WalletGetPermissionsRequest();
			expect(req).toEqual({
				method: "wallet_getPermissions",
				params: [],
			});
		});
	});

	describe("wallet_revokePermissions", () => {
		it("creates request to revoke eth_accounts", () => {
			const req = WalletRevokePermissionsRequest({ eth_accounts: {} });
			expect(req).toEqual({
				method: "wallet_revokePermissions",
				params: [{ eth_accounts: {} }],
			});
		});
	});

	describe("Wallet Error Codes", () => {
		it("defines standard error codes", () => {
			expect(WalletErrorCode.USER_REJECTED).toBe(4001);
			expect(WalletErrorCode.UNAUTHORIZED).toBe(4100);
			expect(WalletErrorCode.UNSUPPORTED_METHOD).toBe(4200);
			expect(WalletErrorCode.DISCONNECTED).toBe(4900);
			expect(WalletErrorCode.CHAIN_DISCONNECTED).toBe(4901);
			expect(WalletErrorCode.UNRECOGNIZED_CHAIN).toBe(4902);
		});

		it("creates user rejected error", () => {
			const err = userRejectedError();
			expect(err.code).toBe(4001);
			expect(err.message).toBe("User rejected the request");
		});

		it("accepts custom message", () => {
			const err = userRejectedError("User cancelled transaction");
			expect(err.code).toBe(4001);
			expect(err.message).toBe("User cancelled transaction");
		});

		it("creates unauthorized error", () => {
			const err = unauthorizedError();
			expect(err.code).toBe(4100);
			expect(err.message).toBe("Unauthorized");
		});

		it("creates unsupported method error", () => {
			const err = unsupportedMethodError("wallet_foo");
			expect(err.code).toBe(4200);
			expect(err.message).toBe("Unsupported method");
			expect(err.data).toEqual({ method: "wallet_foo" });
		});

		it("creates unrecognized chain error", () => {
			const err = unrecognizedChainError("0x999");
			expect(err.code).toBe(4902);
			expect(err.message).toBe("Unrecognized chain ID");
			expect(err.data).toEqual({ chainId: "0x999" });
		});
	});
});

```
