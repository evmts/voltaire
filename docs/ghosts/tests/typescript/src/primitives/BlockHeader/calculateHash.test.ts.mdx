---
title: '[TS/JS] src/primitives/BlockHeader/calculateHash.test.ts'
source: 'src/primitives/BlockHeader/calculateHash.test.ts'
---

> Auto-generated from test file: src/primitives/BlockHeader/calculateHash.test.ts

```typescript
import { describe, expect, it } from "vitest";
import * as Hex from "../Hex/index.js";
import * as BlockHeader from "./index.js";

describe("BlockHeader.calculateHash", () => {
	// Ethereum Mainnet Block 1 header - test data matching Zig implementation
	// Expected hash: 0x88e96d4537bea4d9c05d12549907b32561d3bf31f45aae734cdc119f13406cb6
	// Values match src/primitives/BlockHeader/BlockHeader.zig test vectors
	const block1Header = {
		// Parent hash (genesis block hash)
		parentHash: Hex.toBytes(
			"0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3",
		),
		// Empty ommers hash (sha3Uncles) - EMPTY_OMMERS_HASH
		ommersHash: Hex.toBytes(
			"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
		),
		// Coinbase (miner)
		beneficiary: "0x05a56e2d52c817161883f50c441c3228cfe54d9f",
		// State root - from Zig test vector
		stateRoot: Hex.toBytes(
			"0xd67e4d450343046425ae4271474353857ab860dbc0a1dce64b41a513722ecc47",
		),
		// Empty transactions root (EMPTY_TRIE_ROOT)
		transactionsRoot: Hex.toBytes(
			"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
		),
		// Empty receipts root (EMPTY_TRIE_ROOT)
		receiptsRoot: Hex.toBytes(
			"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
		),
		// Empty logs bloom
		logsBloom: new Uint8Array(256),
		// Difficulty
		difficulty: 17179869184n,
		// Block number
		number: 1n,
		// Gas limit
		gasLimit: 5000n,
		// Gas used
		gasUsed: 0n,
		// Timestamp (July 30, 2015)
		timestamp: 1438269988n,
		// Extra data (empty)
		extraData: new Uint8Array(0),
		// Mix hash
		mixHash: Hex.toBytes(
			"0x969b900de27b6ac6a67742365dd65f55a0526c41fd18e1b16f1a1215c2e66f59",
		),
		// Nonce
		nonce: Hex.toBytes("0x539bd4979fef1ec4"),
	};

	it("calculates deterministic 32-byte hash", () => {
		const header = BlockHeader.from(block1Header);
		const hash = BlockHeader.calculateHash(header);

		// Should produce a 32-byte hash
		expect(hash).toHaveLength(32);

		// Should be deterministic
		const hash2 = BlockHeader.calculateHash(header);
		expect(hash).toEqual(hash2);
	});

	it("returns 32-byte hash", () => {
		const header = BlockHeader.from(block1Header);
		const hash = BlockHeader.calculateHash(header);

		expect(hash).toHaveLength(32);
	});

	it("produces deterministic hash", () => {
		const header = BlockHeader.from(block1Header);
		const hash1 = BlockHeader.calculateHash(header);
		const hash2 = BlockHeader.calculateHash(header);

		expect(hash1).toEqual(hash2);
	});

	it("produces different hash for different headers", () => {
		const header1 = BlockHeader.from(block1Header);
		const header2 = BlockHeader.from({
			...block1Header,
			number: 2n,
		});

		const hash1 = BlockHeader.calculateHash(header1);
		const hash2 = BlockHeader.calculateHash(header2);

		expect(hash1).not.toEqual(hash2);
	});

	describe("post-merge (PoS) blocks", () => {
		const posMergeHeader = {
			...block1Header,
			difficulty: 0n, // PoS has difficulty = 0
			number: 15537394n, // The Merge block
			gasLimit: 30000000n,
			gasUsed: 29999968n,
			timestamp: 1663224162n,
			baseFeePerGas: 7n, // EIP-1559
		};

		it("calculates hash for post-merge block with EIP-1559", () => {
			const header = BlockHeader.from(posMergeHeader);
			const hash = BlockHeader.calculateHash(header);

			expect(hash).toHaveLength(32);
			// Post-merge blocks have difficulty = 0
			expect(header.difficulty).toBe(0n);
		});

		it("calculates hash for Shanghai block with withdrawals", () => {
			const header = BlockHeader.from({
				...posMergeHeader,
				number: 17034870n,
				timestamp: 1681338455n,
				baseFeePerGas: 1000000000n,
				withdrawalsRoot: Hex.toBytes(
					"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
				),
			});

			const hash = BlockHeader.calculateHash(header);
			expect(hash).toHaveLength(32);
		});

		it("calculates hash for Cancun block with blob fields", () => {
			const header = BlockHeader.from({
				...posMergeHeader,
				number: 19426587n,
				timestamp: 1710338135n,
				baseFeePerGas: 30000000000n,
				withdrawalsRoot: Hex.toBytes(
					"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
				),
				blobGasUsed: 131072n,
				excessBlobGas: 0n,
				parentBeaconBlockRoot: new Uint8Array(32),
			});

			const hash = BlockHeader.calculateHash(header);
			expect(hash).toHaveLength(32);
		});
	});

	describe("edge cases", () => {
		it("handles zero values correctly", () => {
			const header = BlockHeader.from({
				parentHash: new Uint8Array(32),
				ommersHash: new Uint8Array(32),
				beneficiary: new Uint8Array(20),
				stateRoot: new Uint8Array(32),
				transactionsRoot: new Uint8Array(32),
				receiptsRoot: new Uint8Array(32),
				logsBloom: new Uint8Array(256),
				difficulty: 0n,
				number: 0n,
				gasLimit: 0n,
				gasUsed: 0n,
				timestamp: 0n,
				extraData: new Uint8Array(0),
				mixHash: new Uint8Array(32),
				nonce: new Uint8Array(8),
			});

			const hash = BlockHeader.calculateHash(header);
			expect(hash).toHaveLength(32);
		});

		it("handles maximum extraData (32 bytes)", () => {
			const header = BlockHeader.from({
				...block1Header,
				extraData: new Uint8Array(32).fill(0xff),
			});

			const hash = BlockHeader.calculateHash(header);
			expect(hash).toHaveLength(32);
		});
	});
});

```
