---
title: '[TS/JS] src/primitives/Abi/error/getSelector.test.ts'
source: 'src/primitives/Abi/error/getSelector.test.ts'
---

> Auto-generated from test file: src/primitives/Abi/error/getSelector.test.ts

```typescript
/**
 * Unit tests for getSelector function
 */

import { keccak_256 as keccak256 } from "@noble/hashes/sha3.js";
import { describe, expect, it } from "vitest";
import { GetSelector } from "./getSelector.js";

// Create keccak256String function for testing
const keccak256String = (str: string): Uint8Array => {
	const encoder = new TextEncoder();
	return keccak256(encoder.encode(str));
};

const getSelector = GetSelector({ keccak256String });

describe("getSelector", () => {
	it("generates 4-byte selector for error with no parameters", () => {
		const error = {
			type: "error",
			name: "Unauthorized",
			inputs: [],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("generates 4-byte selector for error with parameters", () => {
		const error = {
			type: "error",
			name: "InsufficientBalance",
			inputs: [{ type: "uint256", name: "balance" }],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("generates different selectors for different errors", () => {
		const error1 = {
			type: "error",
			name: "Error1",
			inputs: [],
		} as const;

		const error2 = {
			type: "error",
			name: "Error2",
			inputs: [],
		} as const;

		const selector1 = getSelector(error1);
		const selector2 = getSelector(error2);

		expect(selector1).not.toEqual(selector2);
	});

	it("generates same selector for errors with same signature", () => {
		const error1 = {
			type: "error",
			name: "TestError",
			inputs: [{ type: "uint256", name: "param1" }],
		} as const;

		const error2 = {
			type: "error",
			name: "TestError",
			inputs: [{ type: "uint256", name: "param2" }],
		} as const;

		const selector1 = getSelector(error1);
		const selector2 = getSelector(error2);

		expect(selector1).toEqual(selector2);
	});

	it("generates different selectors for errors with different parameter types", () => {
		const error1 = {
			type: "error",
			name: "TestError",
			inputs: [{ type: "uint256", name: "param" }],
		} as const;

		const error2 = {
			type: "error",
			name: "TestError",
			inputs: [{ type: "address", name: "param" }],
		} as const;

		const selector1 = getSelector(error1);
		const selector2 = getSelector(error2);

		expect(selector1).not.toEqual(selector2);
	});

	it("generates selector for error with multiple parameters", () => {
		const error = {
			type: "error",
			name: "TransferFailed",
			inputs: [
				{ type: "address", name: "from" },
				{ type: "address", name: "to" },
				{ type: "uint256", name: "amount" },
			],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("generates selector for error with tuple parameter", () => {
		const error = {
			type: "error",
			name: "ComplexError",
			inputs: [
				{
					type: "tuple",
					name: "data",
					components: [
						{ type: "address", name: "user" },
						{ type: "uint256", name: "value" },
					],
				},
			],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("generates selector for error with array parameter", () => {
		const error = {
			type: "error",
			name: "ArrayError",
			inputs: [{ type: "uint256[]", name: "values" }],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("generates consistent selector across multiple calls", () => {
		const error = {
			type: "error",
			name: "ConsistentError",
			inputs: [{ type: "uint256", name: "value" }],
		} as const;

		const selector1 = getSelector(error);
		const selector2 = getSelector(error);

		expect(selector1).toEqual(selector2);
	});

	it("generates selector for known ERC20 error", () => {
		const error = {
			type: "error",
			name: "ERC20InsufficientBalance",
			inputs: [
				{ type: "address", name: "sender" },
				{ type: "uint256", name: "balance" },
				{ type: "uint256", name: "needed" },
			],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
		// ERC20InsufficientBalance(address,uint256,uint256) -> 0xe450d38c
		expect(selector[0]).toBe(0xe4);
		expect(selector[1]).toBe(0x50);
		expect(selector[2]).toBe(0xd3);
		expect(selector[3]).toBe(0x8c);
	});

	it("GetSelector factory creates working selector function", () => {
		const getSelectorFactory = GetSelector({ keccak256String });
		const error = {
			type: "error",
			name: "TestError",
			inputs: [],
		} as const;

		const selector = getSelectorFactory(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("factory-created selector matches default selector", () => {
		const getSelectorFactory = GetSelector({ keccak256String });
		const error = {
			type: "error",
			name: "MatchTest",
			inputs: [{ type: "uint256", name: "value" }],
		} as const;

		const selector1 = getSelectorFactory(error);
		const selector2 = getSelector(error);

		expect(selector1).toEqual(selector2);
	});

	it("generates selector for error with string parameter", () => {
		const error = {
			type: "error",
			name: "StringError",
			inputs: [{ type: "string", name: "message" }],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("generates selector for error with bytes parameter", () => {
		const error = {
			type: "error",
			name: "BytesError",
			inputs: [{ type: "bytes", name: "data" }],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("generates selector for error with fixed bytes parameter", () => {
		const error = {
			type: "error",
			name: "Bytes32Error",
			inputs: [{ type: "bytes32", name: "hash" }],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("generates selector for error with bool parameter", () => {
		const error = {
			type: "error",
			name: "BoolError",
			inputs: [{ type: "bool", name: "flag" }],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
	});

	it("generates selector for Panic error (common)", () => {
		const error = {
			type: "error",
			name: "Panic",
			inputs: [{ type: "uint256", name: "code" }],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
		// Panic(uint256) -> 0x4e487b71
		expect(selector[0]).toBe(0x4e);
		expect(selector[1]).toBe(0x48);
		expect(selector[2]).toBe(0x7b);
		expect(selector[3]).toBe(0x71);
	});

	it("generates selector for Error string (common)", () => {
		const error = {
			type: "error",
			name: "Error",
			inputs: [{ type: "string", name: "message" }],
		} as const;

		const selector = getSelector(error);
		expect(selector).toBeInstanceOf(Uint8Array);
		expect(selector.length).toBe(4);
		// Error(string) -> 0x08c379a0
		expect(selector[0]).toBe(0x08);
		expect(selector[1]).toBe(0xc3);
		expect(selector[2]).toBe(0x79);
		expect(selector[3]).toBe(0xa0);
	});
});

```
