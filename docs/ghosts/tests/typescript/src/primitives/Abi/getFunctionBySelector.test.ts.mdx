---
title: '[TS/JS] src/primitives/Abi/getFunctionBySelector.test.ts'
source: 'src/primitives/Abi/getFunctionBySelector.test.ts'
---

> Auto-generated from test file: src/primitives/Abi/getFunctionBySelector.test.ts

```typescript
/**
 * Unit tests for getFunctionBySelector
 */

import { describe, expect, it } from "vitest";
import type { Abi } from "./Abi.js";
import { AbiItemNotFoundError } from "./Errors.js";
import { getFunctionBySelector } from "./getFunctionBySelector.js";

const mockAbi = [
	{
		type: "function",
		name: "transfer",
		stateMutability: "nonpayable",
		inputs: [
			{ type: "address", name: "to" },
			{ type: "uint256", name: "amount" },
		],
		outputs: [{ type: "bool", name: "" }],
	},
	{
		type: "function",
		name: "balanceOf",
		stateMutability: "view",
		inputs: [{ type: "address", name: "account" }],
		outputs: [{ type: "uint256", name: "" }],
	},
	{
		type: "function",
		name: "approve",
		stateMutability: "nonpayable",
		inputs: [
			{ type: "address", name: "spender" },
			{ type: "uint256", name: "amount" },
		],
		outputs: [{ type: "bool", name: "" }],
	},
	{
		type: "event",
		name: "Transfer",
		inputs: [
			{ type: "address", name: "from", indexed: true },
			{ type: "address", name: "to", indexed: true },
			{ type: "uint256", name: "value", indexed: false },
		],
	},
] as const satisfies Abi;

describe("getFunctionBySelector", () => {
	it("finds function by 4-byte hex selector", () => {
		// transfer(address,uint256) selector = 0xa9059cbb
		const fn = getFunctionBySelector(mockAbi, "0xa9059cbb");
		expect(fn).toBeDefined();
		expect(fn.name).toBe("transfer");
		expect(fn.type).toBe("function");
	});

	it("finds function by Uint8Array selector", () => {
		// transfer(address,uint256) = 0xa9059cbb
		const selector = new Uint8Array([0xa9, 0x05, 0x9c, 0xbb]);
		const fn = getFunctionBySelector(mockAbi, selector);
		expect(fn).toBeDefined();
		expect(fn.name).toBe("transfer");
	});

	it("finds balanceOf function", () => {
		// balanceOf(address) selector = 0x70a08231
		const fn = getFunctionBySelector(mockAbi, "0x70a08231");
		expect(fn).toBeDefined();
		expect(fn.name).toBe("balanceOf");
		expect(fn.stateMutability).toBe("view");
	});

	it("finds approve function", () => {
		// approve(address,uint256) selector = 0x095ea7b3
		const fn = getFunctionBySelector(mockAbi, "0x095ea7b3");
		expect(fn).toBeDefined();
		expect(fn.name).toBe("approve");
	});

	it("throws on invalid selector length (too short)", () => {
		const shortSelector = new Uint8Array([0xa9, 0x05, 0x9c]); // 3 bytes
		expect(() => getFunctionBySelector(mockAbi, shortSelector)).toThrow(
			AbiItemNotFoundError,
		);
		expect(() => getFunctionBySelector(mockAbi, shortSelector)).toThrow(
			/Invalid selector length/,
		);
	});

	it("throws on invalid selector length (too long)", () => {
		const longSelector = new Uint8Array([0xa9, 0x05, 0x9c, 0xbb, 0x00]); // 5 bytes
		expect(() => getFunctionBySelector(mockAbi, longSelector)).toThrow(
			AbiItemNotFoundError,
		);
		expect(() => getFunctionBySelector(mockAbi, longSelector)).toThrow(
			/Invalid selector length/,
		);
	});

	it("throws on empty selector", () => {
		const emptySelector = new Uint8Array([]);
		expect(() => getFunctionBySelector(mockAbi, emptySelector)).toThrow(
			AbiItemNotFoundError,
		);
	});

	it("throws on function not found in ABI", () => {
		// Random selector that doesn't exist
		const unknownSelector = new Uint8Array([0x12, 0x34, 0x56, 0x78]);
		expect(() => getFunctionBySelector(mockAbi, unknownSelector)).toThrow(
			AbiItemNotFoundError,
		);
		expect(() => getFunctionBySelector(mockAbi, unknownSelector)).toThrow(
			/not found in ABI/,
		);
	});

	it("throws with hex string of unknown selector", () => {
		expect(() => getFunctionBySelector(mockAbi, "0x12345678")).toThrow(
			AbiItemNotFoundError,
		);
	});

	it("handles empty ABI", () => {
		const emptyAbi: Abi = [];
		const selector = new Uint8Array([0xa9, 0x05, 0x9c, 0xbb]);
		expect(() => getFunctionBySelector(emptyAbi, selector)).toThrow(
			AbiItemNotFoundError,
		);
	});

	it("handles ABI with only events (no functions)", () => {
		const eventOnlyAbi = [
			{
				type: "event",
				name: "Transfer",
				inputs: [
					{ type: "address", name: "from", indexed: true },
					{ type: "address", name: "to", indexed: true },
				],
			},
		] as const satisfies Abi;

		const selector = new Uint8Array([0xa9, 0x05, 0x9c, 0xbb]);
		expect(() => getFunctionBySelector(eventOnlyAbi, selector)).toThrow(
			AbiItemNotFoundError,
		);
	});

	it("distinguishes between functions with similar selectors", () => {
		// Different functions should have different selectors
		const transferSelector = new Uint8Array([0xa9, 0x05, 0x9c, 0xbb]);
		const approveSelector = new Uint8Array([0x09, 0x5e, 0xa7, 0xb3]);

		const transfer = getFunctionBySelector(mockAbi, transferSelector);
		const approve = getFunctionBySelector(mockAbi, approveSelector);

		expect(transfer.name).toBe("transfer");
		expect(approve.name).toBe("approve");
		expect(transfer.name).not.toBe(approve.name);
	});

	it("returns correct function inputs", () => {
		const fn = getFunctionBySelector(mockAbi, "0xa9059cbb");
		expect(fn.inputs).toHaveLength(2);
		expect(fn.inputs[0]?.type).toBe("address");
		expect(fn.inputs[1]?.type).toBe("uint256");
	});

	it("returns correct function outputs", () => {
		const fn = getFunctionBySelector(mockAbi, "0xa9059cbb");
		expect(fn.outputs).toHaveLength(1);
		expect(fn.outputs[0]?.type).toBe("bool");
	});

	it("handles function with no inputs", () => {
		const abiWithNoInputs = [
			{
				type: "function",
				name: "totalSupply",
				stateMutability: "view",
				inputs: [],
				outputs: [{ type: "uint256", name: "" }],
			},
		] as const satisfies Abi;

		// totalSupply() selector = 0x18160ddd
		const fn = getFunctionBySelector(abiWithNoInputs, "0x18160ddd");
		expect(fn).toBeDefined();
		expect(fn.name).toBe("totalSupply");
		expect(fn.inputs).toHaveLength(0);
	});

	it("handles function with no outputs", () => {
		const abiWithNoOutputs = [
			{
				type: "function",
				name: "burn",
				stateMutability: "nonpayable",
				inputs: [{ type: "uint256", name: "amount" }],
				outputs: [],
			},
		] as const satisfies Abi;

		// burn(uint256) selector = 0x42966c68
		const fn = getFunctionBySelector(abiWithNoOutputs, "0x42966c68");
		expect(fn).toBeDefined();
		expect(fn.name).toBe("burn");
		expect(fn.outputs).toHaveLength(0);
	});
});

```
