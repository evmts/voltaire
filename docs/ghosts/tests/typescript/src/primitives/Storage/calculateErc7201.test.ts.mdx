---
title: '[TS/JS] src/primitives/Storage/calculateErc7201.test.ts'
source: 'src/primitives/Storage/calculateErc7201.test.ts'
---

> Auto-generated from test file: src/primitives/Storage/calculateErc7201.test.ts

```typescript
/**
 * ERC-7201 Namespaced Storage Layout Tests
 * @see https://eips.ethereum.org/EIPS/eip-7201
 */

import { describe, expect, test } from "vitest";
import { hash } from "../../crypto/Keccak256/hash.js";
import { calculateErc7201 } from "./calculateErc7201.js";

describe("calculateErc7201", () => {
	test("calculates storage slot for example namespace", () => {
		const id = "example.main";
		const slot = calculateErc7201(hash, id);

		expect(slot).toHaveLength(32);
		// Last byte should be 0x00
		expect(slot[31]).toBe(0);
	});

	test("calculates storage slot for ERC-7201 example from spec", () => {
		// Example from ERC-7201: "example.namespace"
		const id = "example.namespace";
		const slot = calculateErc7201(hash, id);

		// Verify it's 32 bytes
		expect(slot).toHaveLength(32);

		// Last byte must be cleared
		expect(slot[31]).toBe(0);

		// Verify slot is deterministic
		const slot2 = calculateErc7201(hash, id);
		expect(slot).toEqual(slot2);
	});

	test("different namespaces produce different slots", () => {
		const slot1 = calculateErc7201(hash, "namespace.one");
		const slot2 = calculateErc7201(hash, "namespace.two");

		expect(slot1).not.toEqual(slot2);
		// Both should have last byte cleared
		expect(slot1[31]).toBe(0);
		expect(slot2[31]).toBe(0);
	});

	test("empty string namespace", () => {
		const slot = calculateErc7201(hash, "");

		expect(slot).toHaveLength(32);
		expect(slot[31]).toBe(0);
	});

	test("long namespace string", () => {
		const id = "org.example.very.long.namespace.identifier.with.many.parts";
		const slot = calculateErc7201(hash, id);

		expect(slot).toHaveLength(32);
		expect(slot[31]).toBe(0);
	});

	test("namespace with special characters", () => {
		const id = "my-namespace_v2.storage@2024";
		const slot = calculateErc7201(hash, id);

		expect(slot).toHaveLength(32);
		expect(slot[31]).toBe(0);
	});

	test("deterministic - same input produces same output", () => {
		const id = "determinism.test";
		const results = Array.from({ length: 10 }, () =>
			calculateErc7201(hash, id),
		);

		// All results should be identical
		for (let i = 1; i < results.length; i++) {
			expect(results[i]).toEqual(results[0]);
		}
	});

	test("slot format - last byte is always 0x00", () => {
		const testIds = [
			"test.one",
			"test.two",
			"test.three",
			"a",
			"verylongnamespacethatexceedsnormallengths",
		];

		for (const id of testIds) {
			const slot = calculateErc7201(hash, id);
			expect(slot[31]).toBe(0);
		}
	});
});

```
