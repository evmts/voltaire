---
title: '[Zig] src/crypto/aes_gcm.zig'
source: 'src/crypto/aes_gcm.zig'
---

> Auto-generated from Zig tests in: src/crypto/aes_gcm.zig

### aes128-gcm basic

```zig
test "aes128-gcm basic" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "Hello, AES-GCM!";
    const additional_data = "metadata";

    // Encrypt
    const ciphertext = try encrypt128(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    try std.testing.expect(ciphertext.len == plaintext.len + TAG_SIZE);

    // Decrypt
    const decrypted = try decrypt128(allocator, ciphertext, &key, &nonce, additional_data);
    defer allocator.free(decrypted);

    try std.testing.expectEqualSlices(u8, plaintext, decrypted);
}
```

### aes256-gcm basic

```zig
test "aes256-gcm basic" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES256_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "Hello, AES-256-GCM!";
    const additional_data = "";

    // Encrypt
    const ciphertext = try encrypt256(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    try std.testing.expect(ciphertext.len == plaintext.len + TAG_SIZE);

    // Decrypt
    const decrypted = try decrypt256(allocator, ciphertext, &key, &nonce, additional_data);
    defer allocator.free(decrypted);

    try std.testing.expectEqualSlices(u8, plaintext, decrypted);
}
```

### aes-gcm wrong key fails

```zig
test "aes-gcm wrong key fails" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const wrong_key = [_]u8{2} ** AES128_KEY_SIZE;
    const nonce = [_]u8{3} ** NONCE_SIZE;
    const plaintext = "test";
    const additional_data = "";

    const ciphertext = try encrypt128(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    const result = decrypt128(allocator, ciphertext, &wrong_key, &nonce, additional_data);
    try std.testing.expectError(error.AuthenticationFailed, result);
}
```

### aes128-gcm empty plaintext

```zig
test "aes128-gcm empty plaintext" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "";
    const additional_data = "";

    const ciphertext = try encrypt128(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    try std.testing.expect(ciphertext.len == TAG_SIZE);

    const decrypted = try decrypt128(allocator, ciphertext, &key, &nonce, additional_data);
    defer allocator.free(decrypted);

    try std.testing.expectEqualSlices(u8, plaintext, decrypted);
}
```

### aes256-gcm empty plaintext

```zig
test "aes256-gcm empty plaintext" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES256_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "";
    const additional_data = "";

    const ciphertext = try encrypt256(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    try std.testing.expect(ciphertext.len == TAG_SIZE);

    const decrypted = try decrypt256(allocator, ciphertext, &key, &nonce, additional_data);
    defer allocator.free(decrypted);

    try std.testing.expectEqualSlices(u8, plaintext, decrypted);
}
```

### aes128-gcm wrong nonce fails

```zig
test "aes128-gcm wrong nonce fails" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const wrong_nonce = [_]u8{3} ** NONCE_SIZE;
    const plaintext = "test";
    const additional_data = "";

    const ciphertext = try encrypt128(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    const result = decrypt128(allocator, ciphertext, &key, &wrong_nonce, additional_data);
    try std.testing.expectError(error.AuthenticationFailed, result);
}
```

### aes256-gcm wrong nonce fails

```zig
test "aes256-gcm wrong nonce fails" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES256_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const wrong_nonce = [_]u8{3} ** NONCE_SIZE;
    const plaintext = "test";
    const additional_data = "";

    const ciphertext = try encrypt256(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    const result = decrypt256(allocator, ciphertext, &key, &wrong_nonce, additional_data);
    try std.testing.expectError(error.AuthenticationFailed, result);
}
```

### aes128-gcm modified ciphertext fails

```zig
test "aes128-gcm modified ciphertext fails" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "test message";
    const additional_data = "";

    const ciphertext = try encrypt128(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    var modified = try allocator.alloc(u8, ciphertext.len);
    defer allocator.free(modified);
    @memcpy(modified, ciphertext);
    modified[0] ^= 1;

    const result = decrypt128(allocator, modified, &key, &nonce, additional_data);
    try std.testing.expectError(error.AuthenticationFailed, result);
}
```

### aes256-gcm modified tag fails

```zig
test "aes256-gcm modified tag fails" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES256_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "test message";
    const additional_data = "";

    const ciphertext = try encrypt256(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    var modified = try allocator.alloc(u8, ciphertext.len);
    defer allocator.free(modified);
    @memcpy(modified, ciphertext);
    modified[ciphertext.len - 1] ^= 1;

    const result = decrypt256(allocator, modified, &key, &nonce, additional_data);
    try std.testing.expectError(error.AuthenticationFailed, result);
}
```

### aes128-gcm wrong aad fails

```zig
test "aes128-gcm wrong aad fails" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "test";
    const aad1 = "metadata1";
    const aad2 = "metadata2";

    const ciphertext = try encrypt128(allocator, plaintext, &key, &nonce, aad1);
    defer allocator.free(ciphertext);

    const result = decrypt128(allocator, ciphertext, &key, &nonce, aad2);
    try std.testing.expectError(error.AuthenticationFailed, result);
}
```

### aes256-gcm large plaintext

```zig
test "aes256-gcm large plaintext" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES256_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const additional_data = "";

    const plaintext = try allocator.alloc(u8, 10000);
    defer allocator.free(plaintext);
    @memset(plaintext, 0xAB);

    const ciphertext = try encrypt256(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    try std.testing.expect(ciphertext.len == plaintext.len + TAG_SIZE);

    const decrypted = try decrypt256(allocator, ciphertext, &key, &nonce, additional_data);
    defer allocator.free(decrypted);

    try std.testing.expectEqualSlices(u8, plaintext, decrypted);
}
```

### aes128-gcm invalid key length

```zig
test "aes128-gcm invalid key length" {
    const allocator = std.testing.allocator;

    const wrong_key = [_]u8{1} ** 15;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "test";
    const additional_data = "";

    const result = encrypt128(allocator, plaintext, &wrong_key, &nonce, additional_data);
    try std.testing.expectError(error.InvalidKeyLength, result);
}
```

### aes256-gcm invalid key length

```zig
test "aes256-gcm invalid key length" {
    const allocator = std.testing.allocator;

    const wrong_key = [_]u8{1} ** 31;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "test";
    const additional_data = "";

    const result = encrypt256(allocator, plaintext, &wrong_key, &nonce, additional_data);
    try std.testing.expectError(error.InvalidKeyLength, result);
}
```

### aes128-gcm invalid nonce length

```zig
test "aes128-gcm invalid nonce length" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const wrong_nonce = [_]u8{2} ** 11;
    const plaintext = "test";
    const additional_data = "";

    const result = encrypt128(allocator, plaintext, &key, &wrong_nonce, additional_data);
    try std.testing.expectError(error.InvalidNonceLength, result);
}
```

### aes256-gcm invalid nonce length

```zig
test "aes256-gcm invalid nonce length" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES256_KEY_SIZE;
    const wrong_nonce = [_]u8{2} ** 13;
    const plaintext = "test";
    const additional_data = "";

    const result = encrypt256(allocator, plaintext, &key, &wrong_nonce, additional_data);
    try std.testing.expectError(error.InvalidNonceLength, result);
}
```

### aes128-gcm ciphertext too short

```zig
test "aes128-gcm ciphertext too short" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const too_short = [_]u8{0} ** 15;
    const additional_data = "";

    const result = decrypt128(allocator, &too_short, &key, &nonce, additional_data);
    try std.testing.expectError(error.InvalidCiphertextLength, result);
}
```

### aes256-gcm ciphertext too short

```zig
test "aes256-gcm ciphertext too short" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES256_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const too_short = [_]u8{0} ** 10;
    const additional_data = "";

    const result = decrypt256(allocator, &too_short, &key, &nonce, additional_data);
    try std.testing.expectError(error.InvalidCiphertextLength, result);
}
```

### aes128-gcm all-zero key

```zig
test "aes128-gcm all-zero key" {
    const allocator = std.testing.allocator;

    const key = [_]u8{0} ** AES128_KEY_SIZE;
    const nonce = [_]u8{0} ** NONCE_SIZE;
    const plaintext = "test";
    const additional_data = "";

    const ciphertext = try encrypt128(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    const decrypted = try decrypt128(allocator, ciphertext, &key, &nonce, additional_data);
    defer allocator.free(decrypted);

    try std.testing.expectEqualSlices(u8, plaintext, decrypted);
}
```

### aes256-gcm all-ones key

```zig
test "aes256-gcm all-ones key" {
    const allocator = std.testing.allocator;

    const key = [_]u8{0xFF} ** AES256_KEY_SIZE;
    const nonce = [_]u8{0xFF} ** NONCE_SIZE;
    const plaintext = "test";
    const additional_data = "";

    const ciphertext = try encrypt256(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    const decrypted = try decrypt256(allocator, ciphertext, &key, &nonce, additional_data);
    defer allocator.free(decrypted);

    try std.testing.expectEqualSlices(u8, plaintext, decrypted);
}
```

### aes128-gcm deterministic encryption

```zig
test "aes128-gcm deterministic encryption" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const nonce = [_]u8{2} ** NONCE_SIZE;
    const plaintext = "test";
    const additional_data = "";

    const ciphertext1 = try encrypt128(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext1);

    const ciphertext2 = try encrypt128(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext2);

    try std.testing.expectEqualSlices(u8, ciphertext1, ciphertext2);
}
```

### aes256-gcm different nonces produce different ciphertext

```zig
test "aes256-gcm different nonces produce different ciphertext" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES256_KEY_SIZE;
    const nonce1 = [_]u8{2} ** NONCE_SIZE;
    const nonce2 = [_]u8{3} ** NONCE_SIZE;
    const plaintext = "test";
    const additional_data = "";

    const ciphertext1 = try encrypt256(allocator, plaintext, &key, &nonce1, additional_data);
    defer allocator.free(ciphertext1);

    const ciphertext2 = try encrypt256(allocator, plaintext, &key, &nonce2, additional_data);
    defer allocator.free(ciphertext2);

    const equal = std.mem.eql(u8, ciphertext1, ciphertext2);
    try std.testing.expect(!equal);
}
```

### SECURITY: nonce reuse allows XOR of plaintexts to be recovered

```zig
test "SECURITY: nonce reuse allows XOR of plaintexts to be recovered" {
    const allocator = std.testing.allocator;

    const key = [_]u8{1} ** AES128_KEY_SIZE;
    const reused_nonce = [_]u8{42} ** NONCE_SIZE; // BAD: reused nonce

    const plaintext1 = "Secret message A";
    const plaintext2 = "Secret message B";
    const additional_data = "";

    const ciphertext1 = try encrypt128(allocator, plaintext1, &key, &reused_nonce, additional_data);
    defer allocator.free(ciphertext1);

    const ciphertext2 = try encrypt128(allocator, plaintext2, &key, &reused_nonce, additional_data);
    defer allocator.free(ciphertext2);

    // XOR the ciphertext bodies (excluding the 16-byte auth tag)
    const ct1_body = ciphertext1[0 .. ciphertext1.len - TAG_SIZE];
    const ct2_body = ciphertext2[0 .. ciphertext2.len - TAG_SIZE];

    var xor_result: [plaintext1.len]u8 = undefined;
    for (0..plaintext1.len) |i| {
        xor_result[i] = ct1_body[i] ^ ct2_body[i];
    }

    // XOR of plaintexts
    var pt_xor: [plaintext1.len]u8 = undefined;
    for (0..plaintext1.len) |i| {
        pt_xor[i] = plaintext1[i] ^ plaintext2[i];
    }

    // With nonce reuse, XOR of ciphertexts equals XOR of plaintexts
    // This is a COMPLETE SECURITY FAILURE - attackers can recover plaintext
    try std.testing.expectEqualSlices(u8, &pt_xor, &xor_result);
}
```

### aes128-gcm NIST vector: all zeros

```zig
test "aes128-gcm NIST vector: all zeros" {
    const allocator = std.testing.allocator;

    const key = [_]u8{0} ** AES128_KEY_SIZE;
    const nonce = [_]u8{0} ** NONCE_SIZE;
    const plaintext = "";
    const additional_data = "";

    const ciphertext = try encrypt128(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    const expected_tag = [_]u8{ 0x58, 0xe2, 0xfc, 0xce, 0xfa, 0x7e, 0x30, 0x61, 0x36, 0x7f, 0x1d, 0x57, 0xa4, 0xe7, 0x45, 0x5a };
    try std.testing.expectEqualSlices(u8, &expected_tag, ciphertext);
}
```

### aes256-gcm NIST vector: all zeros

```zig
test "aes256-gcm NIST vector: all zeros" {
    const allocator = std.testing.allocator;

    const key = [_]u8{0} ** AES256_KEY_SIZE;
    const nonce = [_]u8{0} ** NONCE_SIZE;
    const plaintext = "";
    const additional_data = "";

    const ciphertext = try encrypt256(allocator, plaintext, &key, &nonce, additional_data);
    defer allocator.free(ciphertext);

    const expected_tag = [_]u8{ 0x53, 0x0f, 0x8a, 0xfb, 0xc7, 0x45, 0x36, 0xb9, 0xa9, 0x63, 0xb4, 0xf1, 0xc4, 0xcb, 0x73, 0x8b };
    try std.testing.expectEqualSlices(u8, &expected_tag, ciphertext);
}
```
