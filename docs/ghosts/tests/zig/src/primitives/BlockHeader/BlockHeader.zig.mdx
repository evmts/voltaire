---
title: '[Zig] src/primitives/BlockHeader/BlockHeader.zig'
source: 'src/primitives/BlockHeader/BlockHeader.zig'
---

> Auto-generated from Zig tests in: src/primitives/BlockHeader/BlockHeader.zig

### init - creates default header

```zig
test "init - creates default header" {
    const header = init();
    try std.testing.expectEqual(@as(u64, 0), header.number);
    try std.testing.expectEqual(@as(u64, 0), header.gas_limit);
    try std.testing.expect(Hash.isZero(&header.parent_hash));
}
```

### genesis - creates genesis header

```zig
test "genesis - creates genesis header" {
    const header = genesis(1);
    try std.testing.expectEqual(@as(u64, 0), header.number);
    try std.testing.expect(Hash.equals(&header.ommers_hash, &EMPTY_OMMERS_HASH));
}
```

### rlpEncode - empty header

```zig
test "rlpEncode - empty header" {
    const allocator = std.testing.allocator;
    const header = init();
    const encoded = try rlpEncode(&header, allocator);
    defer allocator.free(encoded);

    // Should be a valid RLP list
    try std.testing.expect(encoded.len > 0);
    try std.testing.expect(encoded[0] >= 0xc0 or encoded[0] >= 0xf7);
}
```

### rlpEncode - header with values

```zig
test "rlpEncode - header with values" {
    const allocator = std.testing.allocator;
    var header = init();
    header.number = 12345;
    header.gas_limit = 30000000;
    header.gas_used = 15000000;
    header.timestamp = 1640000000;

    const encoded = try rlpEncode(&header, allocator);
    defer allocator.free(encoded);

    try std.testing.expect(encoded.len > 0);
}
```

### rlpEncode - post-London header

```zig
test "rlpEncode - post-London header" {
    const allocator = std.testing.allocator;
    var header = init();
    header.number = 12965000; // London fork
    header.base_fee_per_gas = 1000000000; // 1 gwei

    const encoded = try rlpEncode(&header, allocator);
    defer allocator.free(encoded);

    try std.testing.expect(encoded.len > 0);
}
```

### rlpEncode - post-Cancun header

```zig
test "rlpEncode - post-Cancun header" {
    const allocator = std.testing.allocator;
    var header = init();
    header.number = 19000000;
    header.base_fee_per_gas = 1000000000;
    header.withdrawals_root = Hash.ZERO;
    header.blob_gas_used = 131072;
    header.excess_blob_gas = 0;
    header.parent_beacon_block_root = Hash.ZERO;

    const encoded = try rlpEncode(&header, allocator);
    defer allocator.free(encoded);

    try std.testing.expect(encoded.len > 0);
}
```

### hash - computes valid hash

```zig
test "hash - computes valid hash" {
    const allocator = std.testing.allocator;
    const header = init();
    const block_hash = try hash(&header, allocator);

    try std.testing.expectEqual(@as(usize, 32), block_hash.len);
    // Hash should be deterministic
    const block_hash2 = try hash(&header, allocator);
    try std.testing.expect(Hash.equals(&block_hash, &block_hash2));
}
```

### hash - different headers have different hashes

```zig
test "hash - different headers have different hashes" {
    const allocator = std.testing.allocator;

    var header1 = init();
    header1.number = 1;

    var header2 = init();
    header2.number = 2;

    const hash1 = try hash(&header1, allocator);
    const hash2 = try hash(&header2, allocator);

    try std.testing.expect(!Hash.equals(&hash1, &hash2));
}
```

### equals - same header

```zig
test "equals - same header" {
    const allocator = std.testing.allocator;
    const header = init();
    try std.testing.expect(try equals(&header, &header, allocator));
}
```

### equals - identical headers

```zig
test "equals - identical headers" {
    const allocator = std.testing.allocator;

    var header1 = init();
    header1.number = 100;
    header1.timestamp = 1640000000;

    var header2 = init();
    header2.number = 100;
    header2.timestamp = 1640000000;

    try std.testing.expect(try equals(&header1, &header2, allocator));
}
```

### equals - different headers

```zig
test "equals - different headers" {
    const allocator = std.testing.allocator;

    var header1 = init();
    header1.number = 100;

    var header2 = init();
    header2.number = 200;

    try std.testing.expect(!try equals(&header1, &header2, allocator));
}
```

### isPostMerge - pre-merge header

```zig
test "isPostMerge - pre-merge header" {
    var header = init();
    header.difficulty = 1000000;
    try std.testing.expect(!isPostMerge(&header));
}
```

### isPostMerge - post-merge header

```zig
test "isPostMerge - post-merge header" {
    const header = init();
    try std.testing.expect(isPostMerge(&header));
}
```

### hasEip1559 - legacy header

```zig
test "hasEip1559 - legacy header" {
    const header = init();
    try std.testing.expect(!hasEip1559(&header));
}
```

### hasEip1559 - EIP-1559 header

```zig
test "hasEip1559 - EIP-1559 header" {
    var header = init();
    header.base_fee_per_gas = 1000000000;
    try std.testing.expect(hasEip1559(&header));
}
```

### hasEip4844 - pre-Cancun header

```zig
test "hasEip4844 - pre-Cancun header" {
    const header = init();
    try std.testing.expect(!hasEip4844(&header));
}
```

### hasEip4844 - Cancun header

```zig
test "hasEip4844 - Cancun header" {
    var header = init();
    header.blob_gas_used = 131072;
    header.excess_blob_gas = 0;
    header.parent_beacon_block_root = Hash.ZERO;
    try std.testing.expect(hasEip4844(&header));
}
```

### hasWithdrawals - pre-Shanghai header

```zig
test "hasWithdrawals - pre-Shanghai header" {
    const header = init();
    try std.testing.expect(!hasWithdrawals(&header));
}
```

### hasWithdrawals - Shanghai header

```zig
test "hasWithdrawals - Shanghai header" {
    var header = init();
    header.withdrawals_root = Hash.ZERO;
    try std.testing.expect(hasWithdrawals(&header));
}
```

### isValidExtraData - empty

```zig
test "isValidExtraData - empty" {
    const header = init();
    try std.testing.expect(isValidExtraData(&header));
}
```

### isValidExtraData - max size

```zig
test "isValidExtraData - max size" {
    var header = init();
    const data = [_]u8{0} ** MAX_EXTRA_DATA_SIZE;
    header.extra_data = &data;
    try std.testing.expect(isValidExtraData(&header));
}
```

### isValidExtraData - too large

```zig
test "isValidExtraData - too large" {
    var header = init();
    const data = [_]u8{0} ** (MAX_EXTRA_DATA_SIZE + 1);
    header.extra_data = &data;
    try std.testing.expect(!isValidExtraData(&header));
}
```

### sealHash - different from regular hash

```zig
test "sealHash - different from regular hash" {
    const allocator = std.testing.allocator;

    var header = init();
    header.nonce = [_]u8{1} ** NONCE_SIZE;
    header.mix_hash = [_]u8{2} ** 32;

    const regular = try hash(&header, allocator);
    const seal = try sealHash(&header, allocator);

    try std.testing.expect(!Hash.equals(&regular, &seal));
}
```

### clone - creates copy

```zig
test "clone - creates copy" {
    var original = init();
    original.number = 12345;

    const copy = clone(&original);
    try std.testing.expectEqual(original.number, copy.number);

    // Modifying original doesn't affect copy
    original.number = 99999;
    try std.testing.expectEqual(@as(u64, 12345), copy.number);
}
```

### rlpDecode - round trip legacy header

```zig
test "rlpDecode - round trip legacy header" {
    const allocator = std.testing.allocator;

    var original = init();
    original.number = 12345;
    original.gas_limit = 30000000;
    original.gas_used = 15000000;
    original.timestamp = 1640000000;
    original.difficulty = 17179869184;

    const encoded = try rlpEncode(&original, allocator);
    defer allocator.free(encoded);

    const decoded = try rlpDecode(allocator, encoded);

    try std.testing.expectEqual(original.number, decoded.number);
    try std.testing.expectEqual(original.gas_limit, decoded.gas_limit);
    try std.testing.expectEqual(original.gas_used, decoded.gas_used);
    try std.testing.expectEqual(original.timestamp, decoded.timestamp);
    try std.testing.expectEqual(original.difficulty, decoded.difficulty);
}
```

### rlpDecode - round trip EIP-1559 header

```zig
test "rlpDecode - round trip EIP-1559 header" {
    const allocator = std.testing.allocator;

    var original = init();
    original.number = 12965000;
    original.gas_limit = 30000000;
    original.base_fee_per_gas = 1000000000;

    const encoded = try rlpEncode(&original, allocator);
    defer allocator.free(encoded);

    const decoded = try rlpDecode(allocator, encoded);

    try std.testing.expectEqual(original.number, decoded.number);
    try std.testing.expectEqual(original.base_fee_per_gas.?, decoded.base_fee_per_gas.?);
}
```

### real block - mainnet block 1

```zig
test "real block - mainnet block 1" {
    const allocator = std.testing.allocator;

    // Block 1 header data
    var header = BlockHeader{
        // Parent hash (genesis block hash)
        .parent_hash = .{
            0xd4, 0xe5, 0x67, 0x40, 0xf8, 0x76, 0xae, 0xf8,
            0xc0, 0x10, 0xb8, 0x6a, 0x40, 0xd5, 0xf5, 0x67,
            0x45, 0xa1, 0x18, 0xd0, 0x90, 0x6a, 0x34, 0xe6,
            0x9a, 0xec, 0x8c, 0x0d, 0xb1, 0xcb, 0x8f, 0xa3,
        },
        // Empty ommers hash
        .ommers_hash = EMPTY_OMMERS_HASH,
        // Coinbase (miner)
        .beneficiary = Address.Address{ .bytes = .{
            0x05, 0xa5, 0x6e, 0x2d, 0x52, 0xc8, 0x17, 0x16,
            0x18, 0x83, 0xf5, 0x0c, 0x44, 0x1c, 0x32, 0x28,
            0xcf, 0xe5, 0x4d, 0x9f,
        } },
        // State root
        .state_root = .{
            0xd6, 0x7e, 0x4d, 0x45, 0x03, 0x43, 0x04, 0x64,
            0x25, 0xae, 0x42, 0x71, 0x47, 0x43, 0x53, 0x85,
            0x7a, 0xb8, 0x60, 0xdb, 0xc0, 0xa1, 0xdc, 0xe6,
            0x4b, 0x41, 0xa5, 0x13, 0x72, 0x2e, 0xcc, 0x47,
        },
        // Empty transactions root
        .transactions_root = EMPTY_TRANSACTIONS_ROOT,
        // Empty receipts root
        .receipts_root = EMPTY_RECEIPTS_ROOT,
        // Empty logs bloom
        .logs_bloom = [_]u8{0} ** 256,
        // Difficulty
        .difficulty = 17179869184,
        // Block number
        .number = 1,
        // Gas limit
        .gas_limit = 5000,
        // Gas used
        .gas_used = 0,
        // Timestamp (July 30, 2015)
        .timestamp = 1438269988,
        // Extra data (empty)
        .extra_data = &[_]u8{},
        // Mix hash
        .mix_hash = .{
            0x96, 0x9b, 0x90, 0x0d, 0xe2, 0x7b, 0x6a, 0xc6,
            0xa6, 0x77, 0x42, 0x36, 0x5d, 0xd6, 0x5f, 0x55,
            0xa0, 0x52, 0x6c, 0x41, 0xfd, 0x18, 0xe1, 0xb1,
            0x6f, 0x1a, 0x12, 0x15, 0xc2, 0xe6, 0x6f, 0x59,
        },
        // Nonce
        .nonce = .{ 0x53, 0x9b, 0xd4, 0x97, 0x9f, 0xef, 0x1e, 0xc4 },
    };

    // Compute hash
    const computed_hash = try hash(&header, allocator);

    // Expected hash of block 1
    const expected_hash: Hash.Hash = .{
        0x88, 0xe9, 0x6d, 0x45, 0x37, 0xbe, 0xa4, 0xd9,
        0xc0, 0x5d, 0x12, 0x54, 0x99, 0x07, 0xb3, 0x25,
        0x61, 0xd3, 0xbf, 0x31, 0xf4, 0x5a, 0xae, 0x73,
        0x4c, 0xdc, 0x11, 0x9f, 0x13, 0x40, 0x6c, 0xb6,
    };

    try std.testing.expectEqualSlices(u8, &expected_hash, &computed_hash);
}
```

### real block - mainnet merge block

```zig
test "real block - mainnet merge block" {
    const allocator = std.testing.allocator;

    var header = init();
    header.difficulty = 0; // Post-merge
    header.number = 15537394;
    header.gas_limit = 30000000;
    header.gas_used = 29999968;
    header.timestamp = 1663224162;
    header.base_fee_per_gas = 7; // EIP-1559

    // Verify post-merge characteristics
    try std.testing.expect(isPostMerge(&header));
    try std.testing.expect(hasEip1559(&header));
    try std.testing.expect(!hasWithdrawals(&header)); // No withdrawals yet

    // Compute hash (deterministic)
    const block_hash = try hash(&header, allocator);
    try std.testing.expectEqual(@as(usize, 32), block_hash.len);
}
```

### real block - mainnet shanghai block

```zig
test "real block - mainnet shanghai block" {
    const allocator = std.testing.allocator;

    var header = init();
    header.difficulty = 0;
    header.number = 17034870;
    header.gas_limit = 30000000;
    header.gas_used = 12345678;
    header.timestamp = 1681338455;
    header.base_fee_per_gas = 1000000000;
    header.withdrawals_root = EMPTY_WITHDRAWALS_ROOT; // Has withdrawals field

    try std.testing.expect(isPostMerge(&header));
    try std.testing.expect(hasEip1559(&header));
    try std.testing.expect(hasWithdrawals(&header));
    try std.testing.expect(!hasEip4844(&header)); // No blobs yet

    const block_hash = try hash(&header, allocator);
    try std.testing.expectEqual(@as(usize, 32), block_hash.len);
}
```

### real block - mainnet cancun block

```zig
test "real block - mainnet cancun block" {
    const allocator = std.testing.allocator;

    var header = init();
    header.difficulty = 0;
    header.number = 19426587;
    header.gas_limit = 30000000;
    header.gas_used = 15000000;
    header.timestamp = 1710338135;
    header.base_fee_per_gas = 30000000000; // 30 gwei
    header.withdrawals_root = EMPTY_WITHDRAWALS_ROOT;
    header.blob_gas_used = 131072; // 1 blob
    header.excess_blob_gas = 0;
    header.parent_beacon_block_root = Hash.ZERO;

    try std.testing.expect(isPostMerge(&header));
    try std.testing.expect(hasEip1559(&header));
    try std.testing.expect(hasWithdrawals(&header));
    try std.testing.expect(hasEip4844(&header));

    const block_hash = try hash(&header, allocator);
    try std.testing.expectEqual(@as(usize, 32), block_hash.len);

    // Test RLP encode/decode round trip for Cancun header
    const encoded = try rlpEncode(&header, allocator);
    defer allocator.free(encoded);

    try std.testing.expect(encoded.len > 0);
}
```
