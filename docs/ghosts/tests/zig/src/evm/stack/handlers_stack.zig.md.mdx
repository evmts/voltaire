---
title: '[Zig] src/evm/stack/handlers_stack.zig.md'
source: 'src/evm/stack/handlers_stack.zig.md'
---

> Auto-generated from Zig tests in: src/evm/stack/handlers_stack.zig.md

### StackHandlers: POP removes top item

```zig
test "StackHandlers: POP removes top item" {
    // Setup frame with stack [1, 2, 3]
    // Execute POP
    // Verify stack is [1, 2]
    // Verify gas consumed = GasQuickStep (2)
    // Verify PC incremented by 1
}
```

### StackHandlers: POP on empty stack fails

```zig
test "StackHandlers: POP on empty stack fails" {
    // Setup frame with empty stack
    // Execute POP
    // Verify error.StackUnderflow
    // Verify gas NOT consumed (after fix)
    // Verify PC NOT incremented
}
```

### StackHandlers: PUSH0 on pre-Shanghai fails

```zig
test "StackHandlers: PUSH0 on pre-Shanghai fails" {
    // Setup frame with hardfork = LONDON
    // Execute PUSH with opcode 0x5f
    // Verify error.InvalidOpcode
}
```

### StackHandlers: PUSH0 on Shanghai succeeds

```zig
test "StackHandlers: PUSH0 on Shanghai succeeds" {
    // Setup frame with hardfork = SHANGHAI
    // Execute PUSH with opcode 0x5f
    // Verify stack top = 0
    // Verify gas consumed = GasQuickStep (2)
}
```

### StackHandlers: PUSH1 0xFF

```zig
test "StackHandlers: PUSH1 0xFF" {
    // Bytecode: [0x60, 0xFF]  (PUSH1 0xFF)
    // Execute PUSH with opcode 0x60
    // Verify stack top = 0xFF
    // Verify PC incremented by 2
}
```

### StackHandlers: PUSH32 with full 32 bytes

```zig
test "StackHandlers: PUSH32 with full 32 bytes" {
    // Bytecode: [0x7F, 0xFF...FF] (PUSH32 max value)
    // Execute PUSH with opcode 0x7F
    // Verify stack top = 2^256 - 1
    // Verify PC incremented by 33
}
```

### StackHandlers: PUSH5 with only 3 bytes fails

```zig
test "StackHandlers: PUSH5 with only 3 bytes fails" {
    // Bytecode: [0x64, 0x01, 0x02, 0x03] (PUSH5 but only 3 bytes)
    // Execute PUSH with opcode 0x64
    // Verify error.InvalidPush
}
```

### StackHandlers: DUP1 duplicates top

```zig
test "StackHandlers: DUP1 duplicates top" {
    // Stack: [1, 2, 3]
    // Execute DUP with opcode 0x80 (DUP1)
    // Verify stack = [1, 2, 3, 3]
}
```

### StackHandlers: DUP16 duplicates 16th item

```zig
test "StackHandlers: DUP16 duplicates 16th item" {
    // Stack: [1, 2, 3, ..., 16]
    // Execute DUP with opcode 0x8F (DUP16)
    // Verify stack = [1, 2, ..., 16, 1]
}
```

### StackHandlers: DUP2 on 1-item stack fails

```zig
test "StackHandlers: DUP2 on 1-item stack fails" {
    // Stack: [42]
    // Execute DUP with opcode 0x81 (DUP2)
    // Verify error.StackUnderflow
}
```

### StackHandlers: SWAP1 swaps top two

```zig
test "StackHandlers: SWAP1 swaps top two" {
    // Stack: [1, 2, 3]
    // Execute SWAP with opcode 0x90 (SWAP1)
    // Verify stack = [1, 3, 2]
}
```

### StackHandlers: SWAP16 swaps top with 17th

```zig
test "StackHandlers: SWAP16 swaps top with 17th" {
    // Stack: [1, 2, ..., 17]
    // Execute SWAP with opcode 0x9F (SWAP16)
    // Verify stack = [17, 2, ..., 1]
}
```

### StackHandlers: SWAP1 on 1-item stack fails

```zig
test "StackHandlers: SWAP1 on 1-item stack fails" {
    // Stack: [42]
    // Execute SWAP with opcode 0x90 (SWAP1)
    // Verify error.StackUnderflow
}
```

### StackHandlers: PUSH on full stack (1024 items) fails

```zig
test "StackHandlers: PUSH on full stack (1024 items) fails" {
    // Stack: [1, 2, ..., 1024]
    // Execute PUSH1 0xFF
    // Verify error.StackOverflow
}
```

### StackHandlers: DUP on full stack (1024 items) fails

```zig
test "StackHandlers: DUP on full stack (1024 items) fails" {
    // Stack: [1, 2, ..., 1024]
    // Execute DUP1
    // Verify error.StackOverflow
}
```
