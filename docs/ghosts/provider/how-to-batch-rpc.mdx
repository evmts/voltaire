---
title: Batch RPC Requests
description: Execute multiple JSON-RPC requests in parallel for better performance.
---

## Promise.all Pattern

```typescript
import { HttpProvider } from '@tevm/voltaire/provider';

const provider = new HttpProvider('https://eth.llamarpc.com');

// Execute independent requests in parallel
const [blockNumber, balance, nonce] = await Promise.all([
  provider.request({ method: 'eth_blockNumber', params: [] }),
  provider.request({ method: 'eth_getBalance', params: [address, 'latest'] }),
  provider.request({ method: 'eth_getTransactionCount', params: [address, 'latest'] })
]);
```

## Batch Helper

```typescript
async function batchRequest(
  provider: HttpProvider,
  requests: Array<{ method: string; params: unknown[] }>
) {
  return Promise.all(
    requests.map(req => provider.request(req))
  );
}

// Usage
const results = await batchRequest(provider, [
  { method: 'eth_blockNumber', params: [] },
  { method: 'eth_gasPrice', params: [] },
  { method: 'eth_chainId', params: [] }
]);

const [blockNumber, gasPrice, chainId] = results;
```

## Batch with Error Handling

```typescript
async function safeBatch<T>(
  provider: HttpProvider,
  requests: Array<{ method: string; params: unknown[] }>
): Promise<Array<{ result?: T; error?: Error }>> {
  const results = await Promise.allSettled(
    requests.map(req => provider.request(req))
  );

  return results.map(r => {
    if (r.status === 'fulfilled') {
      return { result: r.value as T };
    }
    return { error: r.reason };
  });
}

// Usage
const results = await safeBatch(provider, [
  { method: 'eth_getBalance', params: [address1, 'latest'] },
  { method: 'eth_getBalance', params: [address2, 'latest'] },
  { method: 'eth_getBalance', params: [invalidAddress, 'latest'] } // May fail
]);

results.forEach((r, i) => {
  if (r.error) {
    console.log(`Request ${i} failed:`, r.error);
  } else {
    console.log(`Request ${i} result:`, r.result);
  }
});
```

## Rate Limiting

```typescript
async function batchWithLimit<T>(
  provider: HttpProvider,
  requests: Array<{ method: string; params: unknown[] }>,
  concurrency = 10
): Promise<T[]> {
  const results: T[] = [];

  for (let i = 0; i < requests.length; i += concurrency) {
    const batch = requests.slice(i, i + concurrency);
    const batchResults = await Promise.all(
      batch.map(req => provider.request(req))
    );
    results.push(...(batchResults as T[]));
  }

  return results;
}
```
