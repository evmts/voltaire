---
title: Error Handling
description: Composable error handling patterns
---

## Catch Specific Errors

```typescript
import { Effect, Schedule, Layer } from 'effect'
import { getBalance, Provider, HttpTransport, withTimeout } from 'voltaire-effect'

// Compose layers first
const ProviderLayer = Provider.pipe(
  Layer.provide(HttpTransport({ url: 'https://mainnet.infura.io/v3/YOUR_KEY' }))
)

const program = Effect.gen(function* () {
  return yield* getBalance('0x...', 'latest')
}).pipe(
  withTimeout('5 seconds'),
  Effect.catchTags({
    TransportError: () => Effect.succeed(0n),
    ProviderResponseError: () => Effect.succeed(0n)
  }),
  Effect.provide(ProviderLayer)
)
```

## Handle Multiple Error Types

```typescript
import { Effect, Layer } from 'effect'
import { Contract, ContractCallError, ContractWriteError, Signer, Provider, HttpTransport } from 'voltaire-effect'
import { Secp256k1Live, KeccakLive } from 'voltaire-effect/crypto'
import { Hex } from '@tevm/voltaire'

const erc20Abi = [
  { type: 'function', name: 'balanceOf', inputs: [{ name: 'account', type: 'address' }], outputs: [{ type: 'uint256' }], stateMutability: 'view' },
  { type: 'function', name: 'transfer', inputs: [{ name: 'to', type: 'address' }, { name: 'amount', type: 'uint256' }], outputs: [{ type: 'bool' }], stateMutability: 'nonpayable' }
] as const

const privateKey = Hex.fromHex('0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80')
const tokenAddress = '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48'
const userAddress = '0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045'
const recipient = '0x70997970C51812dc3A010C7d01b50e0d17dc79C8'
const amount = 100_000_000n // 100 USDC (6 decimals)

// Compose all layers first
const CryptoLayer = Layer.mergeAll(Secp256k1Live, KeccakLive)
const TransportLayer = HttpTransport({ url: 'https://eth.llamarpc.com' })
const SignerLayer = Layer.mergeAll(
  Signer.fromPrivateKey(privateKey, Provider),
  CryptoLayer
).pipe(Layer.provide(TransportLayer))

const program = Effect.gen(function* () {
  const token = yield* Contract(tokenAddress, erc20Abi)
  const balance = yield* token.read.balanceOf(userAddress)
  const txHash = yield* token.write.transfer(recipient, amount)
  return { balance, txHash }
}).pipe(
  Effect.catchTags({
    ContractCallError: () => Effect.fail(new Error('Read failed')),
    ContractWriteError: () => Effect.fail(new Error('Write failed'))
  }),
  Effect.provide(SignerLayer)
)
```

## Retry with Backoff

```typescript
import { Effect, Schedule, Layer } from 'effect'
import { getBlockNumber, Provider, HttpTransport, withRetrySchedule } from 'voltaire-effect'

// Compose layers first
const ProviderLayer = Provider.pipe(
  Layer.provide(HttpTransport({ url: 'https://mainnet.infura.io/v3/YOUR_KEY' }))
)

const program = Effect.gen(function* () {
  return yield* getBlockNumber()
}).pipe(
  withRetrySchedule(Schedule.exponential('500 millis').pipe(Schedule.jittered, Schedule.recurs(5))),
  Effect.provide(ProviderLayer)
)
```

## Timeout

```typescript
import { Effect, Layer } from 'effect'
import { getBlock, Provider, HttpTransport, withTimeout } from 'voltaire-effect'

// Compose layers first
const ProviderLayer = Provider.pipe(
  Layer.provide(HttpTransport({ url: 'https://mainnet.infura.io/v3/YOUR_KEY' }))
)

const program = Effect.gen(function* () {
  return yield* getBlock({ blockTag: 'latest', includeTransactions: true })
}).pipe(
  withTimeout('10 seconds'),
  Effect.catchTag('TimeoutException', () => Effect.succeed(null)),
  Effect.provide(ProviderLayer)
)
```

## Fallback RPC

```typescript
import { Effect, Layer } from 'effect'
import { getBlockNumber, Provider, HttpTransport, withTimeout } from 'voltaire-effect'

// Compose layers for each provider
const PrimaryLayer = Provider.pipe(
  Layer.provide(HttpTransport({ url: 'https://mainnet.infura.io/v3/YOUR_KEY' }))
)

const BackupLayer = Provider.pipe(
  Layer.provide(HttpTransport({ url: 'https://eth.llamarpc.com' }))
)

const primary = Effect.gen(function* () {
  return yield* getBlockNumber()
}).pipe(
  withTimeout('3 seconds'),
  Effect.provide(PrimaryLayer)
)

const backup = Effect.gen(function* () {
  return yield* getBlockNumber()
}).pipe(Effect.provide(BackupLayer))

const program = primary.pipe(Effect.orElse(() => backup))
```

## Graceful Degradation

```typescript
import { Effect, Option, Layer } from 'effect'
import { getBalance, Provider, HttpTransport } from 'voltaire-effect'

const address = '0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045'

// Compose layers first
const ProviderLayer = Provider.pipe(
  Layer.provide(HttpTransport({ url: 'https://mainnet.infura.io/v3/YOUR_KEY' }))
)

const program = Effect.gen(function* () {
  const balance = yield* getBalance(address, 'latest').pipe(
    Effect.map(Option.some),
    Effect.catchAll(() => Effect.succeed(Option.none()))
  )

  return { address, balance: Option.getOrElse(balance, () => 0n) }
}).pipe(Effect.provide(ProviderLayer))
```

## Custom Error Types

```typescript
import { Effect, Data, Layer } from 'effect'
import { getBalance, Provider, HttpTransport } from 'voltaire-effect'

class InsufficientBalance extends Data.TaggedError('InsufficientBalance')<{
  readonly required: bigint
  readonly available: bigint
}> {}

const address = '0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045'
const requiredAmount = 1_000_000_000_000_000_000n  // 1 ETH

// Compose layers first
const ProviderLayer = Provider.pipe(
  Layer.provide(HttpTransport({ url: 'https://mainnet.infura.io/v3/YOUR_KEY' }))
)

const program = Effect.gen(function* () {
  const balance = yield* getBalance(address, 'latest')

  if (balance < requiredAmount) {
    return yield* Effect.fail(new InsufficientBalance({ required: requiredAmount, available: balance }))
  }
  return balance
}).pipe(
  Effect.catchTag('InsufficientBalance', (e) => Effect.succeed(e.available)),
  Effect.provide(ProviderLayer)
)
```

## Inspect Exit

```typescript
import { Effect, Exit } from 'effect'

const program = Effect.succeed(0n)
const exit = await Effect.runPromiseExit(program)

Exit.match(exit, {
  onSuccess: (balance) => console.log('Balance:', balance),
  onFailure: (cause) => console.error('Error:', cause)
})
```

## See Also

- [Error Handling Concepts](/concepts/error-handling) — Typed error patterns
- [Troubleshooting](/troubleshooting) — Common issues and solutions
- [Debugging](/guides/debugging) — Debug Effect programs
- [Testing](/testing) — Mock services for tests
- [Effect Error Management](https://effect.website/docs/error-management/two-error-types/) — Official Effect docs
