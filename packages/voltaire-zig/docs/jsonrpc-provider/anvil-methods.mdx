---
title: "Anvil Methods"
description: "Anvil/Foundry RPC methods for local development and testing"
---

## Overview

Anvil-specific RPC methods for controlling local test networks. These methods enable advanced testing scenarios like state manipulation, time travel, and account impersonation.

<Warning>
TypeScript-oriented page. In Zig, post the same JSON-RPC payloads to your Anvil node with `std.http.Client`.
</Warning>

## Snapshot & Revert

### evm_snapshot

Creates a snapshot of the current blockchain state.

```zig
import { anvil } from '@voltaire/jsonrpc';

const request = anvil.evm_snapshot();
// Returns: snapshot ID (e.g., "0x1")
```

### evm_revert

Reverts the blockchain state to a previous snapshot.

```zig
const request = anvil.evm_revert('0x1');
// Returns: true if successful
```

**Example: Test rollback**
```zig
const snapshotId = await provider.request(anvil.evm_snapshot());

// Make state changes
await contract.mutate();

// Revert to snapshot
await provider.request(anvil.evm_revert(snapshotId));
```

## Time Manipulation

### evm_mine

Mines one or more blocks.

```zig
// Mine single block
const request = anvil.evm_mine();

// Mine multiple blocks
const request = anvil.evm_mine(10);

// Mine with interval
const request = anvil.evm_mine(10, 5); // 10 blocks, 5s interval
```

### evm_increaseTime

Fast-forwards time by the specified number of seconds.

```zig
const request = anvil.evm_increaseTime(3600); // +1 hour
```

### evm_setNextBlockTimestamp

Sets the timestamp of the next block.

```zig
const request = anvil.evm_setNextBlockTimestamp(1700000000);
```

### evm_setBlockGasLimit

Sets the block gas limit.

```zig
const request = anvil.evm_setBlockGasLimit('0x1c9c380'); // 30M gas
```

**Example: Time-based testing**
```zig
// Set specific timestamp
await provider.request(anvil.evm_setNextBlockTimestamp(1700000000));
await provider.request(anvil.evm_mine());

// Or increment time
await provider.request(anvil.evm_increaseTime(86400)); // +1 day
await provider.request(anvil.evm_mine());
```

## Account Impersonation

### anvil_impersonateAccount

Start impersonating an account (send transactions without private key).

```zig
const request = anvil.anvil_impersonateAccount(
  '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266'
);
```

### anvil_stopImpersonatingAccount

Stop impersonating an account.

```zig
const request = anvil.anvil_stopImpersonatingAccount(
  '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266'
);
```

**Example: Impersonation**
```zig
const whale = '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266';

await provider.request(anvil.anvil_impersonateAccount(whale));

// Send transactions as whale
await contract.connect(whale).transfer(recipient, amount);

await provider.request(anvil.anvil_stopImpersonatingAccount(whale));
```

## State Manipulation

### anvil_setBalance

Sets the balance of an account.

```zig
const request = anvil.anvil_setBalance(
  '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
  '0xde0b6b3a7640000' // 1 ETH
);
```

### anvil_setCode

Sets the bytecode at an address.

```zig
const request = anvil.anvil_setCode(
  '0x5FbDB2315678afecb367f032d93F642f64180aa3',
  '0x6080604052...' // bytecode
);
```

### anvil_setNonce

Sets the nonce of an account.

```zig
const request = anvil.anvil_setNonce(
  '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266',
  '0x10'
);
```

### anvil_setStorageAt

Sets the storage value at a specific slot.

```zig
const request = anvil.anvil_setStorageAt(
  '0x5FbDB2315678afecb367f032d93F642f64180aa3',
  '0x0', // slot
  '0x0000000000000000000000000000000000000000000000000000000000000001' // value
);
```

**Example: State setup**
```zig
// Fund test account
await provider.request(anvil.anvil_setBalance(
  testAccount,
  '0x56bc75e2d63100000' // 100 ETH
));

// Set storage slot
await provider.request(anvil.anvil_setStorageAt(
  tokenContract,
  '0x0', // balances[testAccount] slot
  '0x' + (1000n * 10n**18n).toString(16).padStart(64, '0')
));
```

## Mining Control

### evm_setAutomine

Enables or disables automatic mining of blocks.

```zig
// Disable automine
const request = anvil.evm_setAutomine(false);

// Enable automine
const request = anvil.evm_setAutomine(true);
```

### evm_setIntervalMining

Sets the mining interval in seconds (0 disables).

```zig
// Mine every 5 seconds
const request = anvil.evm_setIntervalMining(5);

// Disable interval mining
const request = anvil.evm_setIntervalMining(0);
```

**Example: Manual mining**
```zig
// Disable automine for batch operations
await provider.request(anvil.evm_setAutomine(false));

// Queue multiple transactions
await contract.tx1();
await contract.tx2();
await contract.tx3();

// Mine all at once
await provider.request(anvil.evm_mine());

// Re-enable automine
await provider.request(anvil.evm_setAutomine(true));
```

## Common Patterns

### Test Isolation

```zig
let snapshotId;

beforeEach(async () => {
  snapshotId = await provider.request(anvil.evm_snapshot());
});

afterEach(async () => {
  await provider.request(anvil.evm_revert(snapshotId));
});
```

### Fork Testing

```zig
// Impersonate whale
await provider.request(anvil.anvil_impersonateAccount(whale));

// Fund test account from whale
await token.connect(whale).transfer(testAccount, amount);

// Stop impersonation
await provider.request(anvil.anvil_stopImpersonatingAccount(whale));
```

### Gas Optimization Testing

```zig
// Set high gas limit
await provider.request(anvil.evm_setBlockGasLimit('0x5f5e100')); // 100M

// Run gas-heavy operations
await contract.batchOperation(largeArray);
```

## See Also

- [Hardhat Methods](/jsonrpc-provider/hardhat-methods)
- [Error Handling](/jsonrpc-provider/error-handling)
- [Foundry Anvil Docs](https://book.getfoundry.sh/reference/anvil/)
