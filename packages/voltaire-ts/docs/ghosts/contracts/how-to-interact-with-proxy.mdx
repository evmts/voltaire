---
title: How to Interact with Proxy Contracts
description: Read implementation addresses and interact with upgradeable proxies
---

## Goal

Detect proxy contracts, read their implementation addresses, and call functions on the implementation.

## ERC-1967 Storage Slots

```typescript
import { IMPLEMENTATION_SLOT, BEACON_SLOT, ADMIN_SLOT } from '@voltaire/primitives/Proxy';

// Read implementation address from ERC-1967 slot
const implSlotData = await provider.request({
  method: 'eth_getStorageAt',
  params: [
    '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48', // USDC proxy
    IMPLEMENTATION_SLOT, // '0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc'
    'latest'
  ]
});

// Extract address from 32-byte slot (last 20 bytes)
const implementationAddress = '0x' + implSlotData.slice(-40);
```

## Detect ERC-1167 Minimal Proxy

```typescript
import * as Proxy from '@voltaire/primitives/Proxy';
import * as Bytecode from '@voltaire/primitives/Bytecode';
import * as Address from '@voltaire/primitives/Address';

const codeHex = await provider.request({
  method: 'eth_getCode',
  params: [proxyAddress, 'latest']
});

const bytecode = Bytecode.fromHex(codeHex);

if (Proxy.isErc1167(bytecode)) {
  const implBytes = Proxy.parseErc1167(bytecode);
  const implementation = Address.fromBytes(implBytes);
  console.log(`Minimal proxy -> ${Address.toChecksummed(implementation)}`);
}
```

## Call Through Proxy

```typescript
import { Contract } from '@voltaire/contract';

// Use implementation ABI with proxy address
const implementationAbi = [...] as const;

const proxy = Contract({
  address: proxyAddress,        // Call the proxy
  abi: implementationAbi,       // Use implementation's ABI
  provider
});

// Calls are delegated to implementation
const result = await proxy.read.someFunction();
```

## Get Implementation ABI

```typescript
// 1. Get implementation address
const implAddress = '0x' + (await provider.request({
  method: 'eth_getStorageAt',
  params: [proxyAddress, IMPLEMENTATION_SLOT, 'latest']
})).slice(-40);

// 2. Fetch ABI from verified source (Etherscan, Sourcify, etc.)
// Or analyze implementation bytecode
import * as Bytecode from '@voltaire/primitives/Bytecode';

const implCode = await provider.request({
  method: 'eth_getCode',
  params: [implAddress, 'latest']
});

const partialAbi = Bytecode.toAbi(Bytecode.fromHex(implCode));
```

## Proxy Types

| Type | Detection |
|------|-----------|
| ERC-1967 | Read `IMPLEMENTATION_SLOT` storage |
| ERC-1167 | `Proxy.isErc1167(bytecode)` |
| Beacon | Read `BEACON_SLOT`, then beacon's implementation |
| Diamond | Call `facetAddress(selector)` for each function |
