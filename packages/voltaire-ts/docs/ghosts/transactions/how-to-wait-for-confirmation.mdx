---
title: How to Wait for Confirmation
description: Poll for transaction confirmation and handle timeouts
---

## Using pollForReceipt

```typescript
import { pollForReceipt } from 'voltaire/utils';

const receipt = await pollForReceipt(
  txHash,
  (hash) => provider.request({
    method: 'eth_getTransactionReceipt',
    params: [hash]
  }),
  {
    interval: 1000, // Poll every 1s
    timeout: 120000 // 2 minute timeout
  }
);

console.log('Confirmed in block:', receipt.blockNumber);
console.log('Status:', receipt.status === '0x1' ? 'Success' : 'Failed');
```

## Manual Polling

```typescript
import { poll } from 'voltaire/utils';

const receipt = await poll(
  () => provider.request({
    method: 'eth_getTransactionReceipt',
    params: [txHash]
  }),
  {
    interval: 2000,
    timeout: 60000,
    validate: (r) => r !== null
  }
);
```

## With Backoff

```typescript
import { pollWithBackoff } from 'voltaire/utils';

const receipt = await pollWithBackoff(
  () => provider.request({
    method: 'eth_getTransactionReceipt',
    params: [txHash]
  }),
  {
    interval: 500, // Start at 500ms
    backoffFactor: 1.5, // Increase by 1.5x each poll
    maxInterval: 5000, // Cap at 5s
    timeout: 120000,
    validate: (r) => r !== null
  }
);
```

## Wait for N Confirmations

```typescript
async function waitForConfirmations(
  txHash: string,
  confirmations: number,
  provider: Provider
) {
  // First wait for initial receipt
  const receipt = await pollForReceipt(
    txHash,
    (h) => provider.request({ method: 'eth_getTransactionReceipt', params: [h] })
  );

  // Then wait for additional blocks
  const targetBlock = BigInt(receipt.blockNumber) + BigInt(confirmations);

  await poll(
    () => provider.request({ method: 'eth_blockNumber', params: [] }),
    {
      interval: 12000, // ~1 block time
      timeout: confirmations * 15000,
      validate: (blockNum) => BigInt(blockNum) >= targetBlock
    }
  );

  return receipt;
}

// Wait for 3 confirmations
const receipt = await waitForConfirmations(txHash, 3, provider);
```

## Progress Callback

```typescript
const receipt = await poll(
  () => provider.request({
    method: 'eth_getTransactionReceipt',
    params: [txHash]
  }),
  {
    interval: 1000,
    timeout: 60000,
    validate: (r) => r !== null,
    onPoll: (result, attempt) => {
      console.log(`Attempt ${attempt}: ${result ? 'confirmed!' : 'pending...'}`);
    }
  }
);
```

## Key Points

- Receipt is `null` until tx is mined
- `status: '0x1'` = success, `status: '0x0'` = revert
- Use backoff during congestion to reduce RPC calls
- For critical txs, wait for multiple confirmations
