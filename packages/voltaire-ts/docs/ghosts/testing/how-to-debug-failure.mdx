---
title: How to Debug Transaction Failure
description: Diagnose why a transaction reverted and find the revert reason.
---

## Goal

Find why a transaction failed and extract the revert reason or error.

## Check Receipt Status

```typescript
import { createProvider } from '@tevm/voltaire/provider'

const provider = createProvider('http://localhost:8545')

const receipt = await provider.request({
  method: 'eth_getTransactionReceipt',
  params: [txHash]
})

if (receipt.status === '0x0') {
  console.log('Transaction reverted')
}
```

## Trace Failed Transaction

```typescript
const trace = await provider.request({
  method: 'debug_traceTransaction',
  params: [txHash, { tracer: 'callTracer' }]
})

if (trace.error) {
  console.log('Revert reason:', trace.error)
  // e.g., "execution reverted: ERC20: insufficient balance"
}

// Find which call failed
function findFailure(call) {
  if (call.error) {
    console.log(`Failed at ${call.to}: ${call.error}`)
    return call
  }
  for (const subcall of call.calls || []) {
    const failed = findFailure(subcall)
    if (failed) return failed
  }
}

findFailure(trace)
```

## Simulate Before Sending

```typescript
// Test call to see if it would revert
try {
  await provider.request({
    method: 'eth_call',
    params: [
      { from, to, data, value },
      'latest'
    ]
  })
} catch (err) {
  // Extract revert reason from error
  console.log('Would revert:', err.message)
}
```

## Trace Call for Debugging

```typescript
const trace = await provider.request({
  method: 'debug_traceCall',
  params: [
    { from, to, data, value },
    'latest',
    { tracer: 'callTracer' }
  ]
})

if (trace.error) {
  console.log('Error:', trace.error)
  console.log('Output:', trace.output) // encoded revert data
}
```

## Decode Revert Reason

```typescript
import { decodeErrorResult } from '@tevm/voltaire/Abi'

// If you have the ABI
const decoded = decodeErrorResult({
  abi: contractAbi,
  data: trace.output
})

console.log('Error:', decoded.errorName)
console.log('Args:', decoded.args)
```

## Common Revert Patterns

| Error | Cause |
|-------|-------|
| `ERC20: insufficient balance` | Not enough tokens |
| `ERC20: insufficient allowance` | Missing approve() |
| `Ownable: caller is not the owner` | Access control |
| `execution reverted` | Generic revert |
| Out of gas | Gas limit too low |

## Gas Analysis

```typescript
const trace = await provider.request({
  method: 'debug_traceTransaction',
  params: [txHash, { tracer: 'callTracer' }]
})

// Check gas usage at each level
function analyzeGas(call, depth = 0) {
  const indent = '  '.repeat(depth)
  console.log(`${indent}${call.type} ${call.to}: ${call.gasUsed}`)
  for (const subcall of call.calls || []) {
    analyzeGas(subcall, depth + 1)
  }
}

analyzeGas(trace)
```
