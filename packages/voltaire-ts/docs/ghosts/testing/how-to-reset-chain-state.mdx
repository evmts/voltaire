---
title: How to Reset Local Chain State
description: Snapshot and revert chain state for test isolation.
---

## Goal

Create snapshots to reset state between tests, ensuring test isolation.

## Snapshot and Revert

```typescript
import { createProvider } from '@tevm/voltaire/provider'

const provider = createProvider('http://localhost:8545')

// Create snapshot
const snapshotId = await provider.request({
  method: 'evm_snapshot',
  params: []
})

// Make state changes
await provider.request({
  method: 'eth_sendTransaction',
  params: [{ from: account, to: recipient, value: '0xde0b6b3a7640000' }]
})

// Revert to snapshot
await provider.request({
  method: 'evm_revert',
  params: [snapshotId]
})

// State restored to snapshot point
```

## Test Framework Pattern

```typescript
let snapshotId: string

beforeEach(async () => {
  snapshotId = await provider.request({
    method: 'evm_snapshot',
    params: []
  })
})

afterEach(async () => {
  await provider.request({
    method: 'evm_revert',
    params: [snapshotId]
  })
})

test('first test', async () => {
  // Modify state...
})

test('second test', async () => {
  // Starts with clean state from snapshot
})
```

## Full Reset (Hardhat)

```typescript
// Reset to fresh local state
await provider.request({
  method: 'hardhat_reset',
  params: []
})

// Reset with new fork
await provider.request({
  method: 'hardhat_reset',
  params: [{
    forking: {
      jsonRpcUrl: process.env.MAINNET_RPC,
      blockNumber: 19000000
    }
  }]
})
```

## Note on Snapshot IDs

- `evm_snapshot` returns incrementing IDs (`0x1`, `0x2`, etc.)
- `evm_revert` invalidates all snapshots taken after the reverted one
- Take fresh snapshots after reverting if needed

```typescript
const snap1 = await provider.request({ method: 'evm_snapshot', params: [] }) // 0x1
const snap2 = await provider.request({ method: 'evm_snapshot', params: [] }) // 0x2

await provider.request({ method: 'evm_revert', params: [snap1] })
// snap2 is now invalid

const snap3 = await provider.request({ method: 'evm_snapshot', params: [] }) // 0x3
```
