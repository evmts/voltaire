---
title: How to Estimate UserOperation Gas
description: Estimate gas limits for ERC-4337 UserOperations via bundler RPC.
---

## Overview

UserOperations require three gas parameters:
- `preVerificationGas` - Bundler overhead (calldata, loop costs)
- `verificationGasLimit` - Account + paymaster validation
- `callGasLimit` - Actual execution

Bundlers provide `eth_estimateUserOperationGas` to compute these values.

## Bundler Gas Estimation

```typescript
import { UserOperation } from '@tevm/voltaire/primitives/UserOperation';

// Create unsigned UserOp with placeholder gas values
const partialUserOp = UserOperation.from({
  sender: smartAccountAddress,
  nonce: currentNonce,
  initCode: '0x',
  callData: encodedCallData,
  callGasLimit: 0n,
  verificationGasLimit: 0n,
  preVerificationGas: 0n,
  maxFeePerGas: 30000000000n,
  maxPriorityFeePerGas: 1000000000n,
  paymasterAndData: '0x',
  signature: '0x', // Dummy signature for estimation
});

// Call bundler RPC
const gasEstimate = await bundlerClient.request({
  method: 'eth_estimateUserOperationGas',
  params: [partialUserOp, entryPointAddress],
});

// Response: { preVerificationGas, verificationGasLimit, callGasLimit }
```

## Gas Components Explained

### preVerificationGas

Fixed overhead the bundler charges:
- Calldata cost (16 gas/byte non-zero, 4 gas/byte zero)
- Per-UserOp loop overhead
- Bundle submission gas share

Typically 40,000-60,000 for simple operations.

### verificationGasLimit

Gas for validation phase:
- Account `validateUserOp()` execution
- Paymaster `validatePaymasterUserOp()` if applicable
- Signature verification costs

Typically 100,000-200,000 depending on validation logic.

### callGasLimit

Gas for execution phase:
- Account `execute()` or `executeBatch()`
- Target contract calls
- State changes

Varies based on operation complexity.

## Estimation with Paymaster

When using a paymaster, include `paymasterAndData` in estimation:

```typescript
const paymasterAndData = Hex.concat([
  paymasterAddress,
  validUntil, // 6 bytes
  validAfter, // 6 bytes
  // ... paymaster-specific data
]);

const estimateWithPaymaster = await bundlerClient.request({
  method: 'eth_estimateUserOperationGas',
  params: [
    { ...partialUserOp, paymasterAndData },
    entryPointAddress,
  ],
});
```

## Account Deployment Estimation

First-time account creation needs higher `verificationGasLimit`:

```typescript
const deployEstimate = await bundlerClient.request({
  method: 'eth_estimateUserOperationGas',
  params: [
    {
      ...partialUserOp,
      initCode: factoryInitCode, // Include deployment
      nonce: 0n,
    },
    entryPointAddress,
  ],
});
// verificationGasLimit will be higher for deployment
```

## Safety Margins

Add buffers to estimated values:

```typescript
const BUFFER = 1.2; // 20% safety margin

const finalUserOp = UserOperation.from({
  ...partialUserOp,
  preVerificationGas: BigInt(Math.ceil(Number(gasEstimate.preVerificationGas) * BUFFER)),
  verificationGasLimit: BigInt(Math.ceil(Number(gasEstimate.verificationGasLimit) * BUFFER)),
  callGasLimit: BigInt(Math.ceil(Number(gasEstimate.callGasLimit) * BUFFER)),
});
```

## Manual Estimation (Fallback)

If bundler estimation unavailable:

```typescript
// Rough estimates for simple operations
const manualGas = {
  preVerificationGas: 50000n,
  verificationGasLimit: 150000n,
  callGasLimit: 100000n,
};

// For deployment, increase verification gas
if (initCode !== '0x') {
  manualGas.verificationGasLimit = 500000n;
}
```

## Related

- [Create UserOperation](/ghosts/account-abstraction/how-to-create-useroperation)
- [Submit to Bundler](/ghosts/account-abstraction/how-to-submit-to-bundler)
- [Bundler Reference](/primitives/bundler)
