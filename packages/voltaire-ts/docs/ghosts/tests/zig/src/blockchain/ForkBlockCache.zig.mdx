---
title: '[Zig] src/blockchain/ForkBlockCache.zig'
source: 'src/blockchain/ForkBlockCache.zig'
---

> Auto-generated from Zig tests in: src/blockchain/ForkBlockCache.zig

### ForkBlockCache - init and deinit

```zig
test "ForkBlockCache - init and deinit" {
    const allocator = std.testing.allocator;
    var cache = try ForkBlockCache.init(allocator, 1000);
    defer cache.deinit();

    try std.testing.expectEqual(@as(usize, 0), cache.cacheSize());
}
```

### ForkBlockCache - isForkBlock boundary check

```zig
test "ForkBlockCache - isForkBlock boundary check" {
    const allocator = std.testing.allocator;
    var cache = try ForkBlockCache.init(allocator, 1000);
    defer cache.deinit();

    try std.testing.expect(cache.isForkBlock(500));
    try std.testing.expect(cache.isForkBlock(1000));
    try std.testing.expect(!cache.isForkBlock(1001));
}
```

### ForkBlockCache - fetch by number queues request

```zig
test "ForkBlockCache - fetch by number queues request" {
    const allocator = std.testing.allocator;
    var cache = try ForkBlockCache.init(allocator, 1000);
    defer cache.deinit();

    try std.testing.expectError(error.RpcPending, cache.getBlockByNumber(5));
    const request = cache.peekNextRequest() orelse {
        try std.testing.expect(false);
        return;
    };
    try std.testing.expectEqual(@as(u64, 5), request.number);
}
```

### ForkBlockCache - continue caches block

```zig
test "ForkBlockCache - continue caches block" {
    const allocator = std.testing.allocator;
    var cache = try ForkBlockCache.init(allocator, 1000);
    defer cache.deinit();

    try std.testing.expectError(error.RpcPending, cache.getBlockByNumber(7));
    const request = cache.nextRequest() orelse {
        try std.testing.expect(false);
        return;
    };

    const hash_hex = "0x" ++ ("11" ** 32);
    const response = try std.fmt.allocPrint(allocator, "{{\"hash\":\"{s}\",\"number\":\"0x7\"}}", .{hash_hex});
    defer allocator.free(response);

    try cache.continueRequest(request.id, response);

    const block = try cache.getBlockByNumber(7);
    try std.testing.expect(block != null);
    try std.testing.expectEqual(@as(u64, 7), block.?.header.number);
}
```
