---
title: '[Zig] src/primitives/Hardfork/Eips.zig'
source: 'src/primitives/Hardfork/Eips.zig'
---

> Auto-generated from Zig tests in: src/primitives/Hardfork/Eips.zig

### eip_3529_gas_refund_cap pre-London

```zig
test "eip_3529_gas_refund_cap pre-London" {
    const eips = Eips{ .hardfork = Hardfork.ISTANBUL };

    // Pre-London: refund up to half of gas used
    try std.testing.expectEqual(@as(u64, 50), eips.eip_3529_gas_refund_cap(100, 100));
    try std.testing.expectEqual(@as(u64, 50), eips.eip_3529_gas_refund_cap(100, 60));
    try std.testing.expectEqual(@as(u64, 25), eips.eip_3529_gas_refund_cap(100, 25));
}
```

### eip_3529_gas_refund_cap post-London

```zig
test "eip_3529_gas_refund_cap post-London" {
    const eips = Eips{ .hardfork = Hardfork.LONDON };

    // Post-London: refund up to one fifth of gas used
    try std.testing.expectEqual(@as(u64, 20), eips.eip_3529_gas_refund_cap(100, 100));
    try std.testing.expectEqual(@as(u64, 20), eips.eip_3529_gas_refund_cap(100, 60));
    try std.testing.expectEqual(@as(u64, 10), eips.eip_3529_gas_refund_cap(100, 10));
}
```

### eip_2929_storage_costs pre-Berlin

```zig
test "eip_2929_storage_costs pre-Berlin" {
    const eips = Eips{ .hardfork = Hardfork.ISTANBUL };

    try std.testing.expectEqual(@as(u64, 200), eips.eip_2929_cold_sload_cost());
    try std.testing.expectEqual(@as(u64, 200), eips.eip_2929_warm_storage_read_cost());
    try std.testing.expectEqual(@as(u64, 700), eips.eip_2929_cold_account_access_cost());
    try std.testing.expectEqual(@as(u64, 700), eips.eip_2929_warm_account_access_cost());
}
```

### eip_2929_storage_costs post-Berlin

```zig
test "eip_2929_storage_costs post-Berlin" {
    const eips = Eips{ .hardfork = Hardfork.BERLIN };

    try std.testing.expectEqual(@as(u64, 2100), eips.eip_2929_cold_sload_cost());
    try std.testing.expectEqual(@as(u64, 100), eips.eip_2929_warm_storage_read_cost());
    try std.testing.expectEqual(@as(u64, 2600), eips.eip_2929_cold_account_access_cost());
    try std.testing.expectEqual(@as(u64, 100), eips.eip_2929_warm_account_access_cost());
}
```

### is_eip_active progression

```zig
test "is_eip_active progression" {
    const frontier = Eips{ .hardfork = Hardfork.FRONTIER };
    const istanbul = Eips{ .hardfork = Hardfork.ISTANBUL };
    const berlin = Eips{ .hardfork = Hardfork.BERLIN };
    const london = Eips{ .hardfork = Hardfork.LONDON };
    const shanghai = Eips{ .hardfork = Hardfork.SHANGHAI };
    const cancun = Eips{ .hardfork = Hardfork.CANCUN };
    const prague = Eips{ .hardfork = Hardfork.PRAGUE };

    // EIP-2929 should be active from Berlin onwards
    try std.testing.expect(!istanbul.is_eip_active(2929));
    try std.testing.expect(berlin.is_eip_active(2929));
    try std.testing.expect(london.is_eip_active(2929));
    try std.testing.expect(shanghai.is_eip_active(2929));
    try std.testing.expect(cancun.is_eip_active(2929));
    try std.testing.expect(prague.is_eip_active(2929));

    // EIP-1559 should be active from London onwards
    try std.testing.expect(!berlin.is_eip_active(1559));
    try std.testing.expect(london.is_eip_active(1559));
    try std.testing.expect(shanghai.is_eip_active(1559));
    try std.testing.expect(cancun.is_eip_active(1559));
    try std.testing.expect(prague.is_eip_active(1559));

    // EIP-7702 should only be active from Prague onwards
    try std.testing.expect(!cancun.is_eip_active(7702));
    try std.testing.expect(prague.is_eip_active(7702));

    // EIP-170 should be active from Spurious Dragon onwards
    try std.testing.expect(!frontier.is_eip_active(170));
}
```

### sstore_gas_cost pre-Constantinople

```zig
test "sstore_gas_cost pre-Constantinople" {
    const frontier = Eips{ .hardfork = Hardfork.FRONTIER };

    // Set from zero to non-zero
    var cost = frontier.sstore_gas_cost(0, 1, 0, false);
    try std.testing.expectEqual(@as(u64, 20000), cost.gas);
    try std.testing.expectEqual(@as(u64, 0), cost.refund);

    // Clear from non-zero to zero
    cost = frontier.sstore_gas_cost(1, 0, 1, false);
    try std.testing.expectEqual(@as(u64, 5000), cost.gas);
    try std.testing.expectEqual(@as(u64, 15000), cost.refund);

    // Modify non-zero value
    cost = frontier.sstore_gas_cost(1, 2, 1, false);
    try std.testing.expectEqual(@as(u64, 5000), cost.gas);
    try std.testing.expectEqual(@as(u64, 0), cost.refund);
}
```

### sstore_gas_cost Berlin cold access

```zig
test "sstore_gas_cost Berlin cold access" {
    const berlin = Eips{ .hardfork = Hardfork.BERLIN };

    // No-op with cold access
    var cost = berlin.sstore_gas_cost(42, 42, 42, true);
    try std.testing.expectEqual(@as(u64, 2200), cost.gas); // 2100 + 100

    // Set from zero with cold access
    cost = berlin.sstore_gas_cost(0, 1, 0, true);
    try std.testing.expectEqual(@as(u64, 22100), cost.gas); // 2100 + 20000
}
```

### EIP overrides enable future EIPs

```zig
test "EIP overrides enable future EIPs" {
    const london_with_push0 = Eips{
        .hardfork = Hardfork.LONDON,
        .overrides = &[_]EipOverride{
            .{ .eip = 3855, .enabled = true }, // PUSH0
        },
    };

    const plain_london = Eips{ .hardfork = Hardfork.LONDON };
    try std.testing.expect(!plain_london.is_eip_active(3855));
    try std.testing.expect(london_with_push0.is_eip_active(3855));
}
```

### EIP overrides disable existing EIPs

```zig
test "EIP overrides disable existing EIPs" {
    const cancun_restricted = Eips{
        .hardfork = Hardfork.CANCUN,
        .overrides = &[_]EipOverride{
            .{ .eip = 4844, .enabled = false }, // Disable blob transactions
        },
    };

    const plain_cancun = Eips{ .hardfork = Hardfork.CANCUN };
    try std.testing.expect(plain_cancun.is_eip_active(4844));
    try std.testing.expect(!cancun_restricted.is_eip_active(4844));
}
```
