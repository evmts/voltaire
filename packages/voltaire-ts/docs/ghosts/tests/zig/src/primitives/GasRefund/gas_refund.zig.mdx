---
title: '[Zig] src/primitives/GasRefund/gas_refund.zig'
source: 'src/primitives/GasRefund/gas_refund.zig'
---

> Auto-generated from Zig tests in: src/primitives/GasRefund/gas_refund.zig

### GasRefund: from and toNumber

```zig
test "GasRefund: from and toNumber" {
    const refund = GasRefund.from(15000);
    try testing.expectEqual(@as(u64, 15000), refund.toNumber());

    const refund2 = GasRefund.from(0);
    try testing.expectEqual(@as(u64, 0), refund2.toNumber());
}
```

### GasRefund: constants

```zig
test "GasRefund: constants" {
    try testing.expectEqual(@as(u64, 5), GasRefund.REFUND_CAP_DIVISOR);
    try testing.expectEqual(@as(u64, 4800), GasRefund.SSTORE_CLEAR_REFUND);
}
```

### GasRefund: add

```zig
test "GasRefund: add" {
    const a = GasRefund.from(4800);
    const b = GasRefund.from(4800);
    const result = a.add(b);
    try testing.expectEqual(@as(u64, 9600), result.toNumber());
}
```

### GasRefund: sub

```zig
test "GasRefund: sub" {
    const a = GasRefund.from(15000);
    const b = GasRefund.from(5000);
    const result = a.sub(b);
    try testing.expectEqual(@as(u64, 10000), result.toNumber());

    // Saturating subtraction
    const c = GasRefund.from(1000);
    const d = GasRefund.from(5000);
    const result2 = c.sub(d);
    try testing.expectEqual(@as(u64, 0), result2.toNumber());
}
```

### GasRefund: equals

```zig
test "GasRefund: equals" {
    const a = GasRefund.from(15000);
    const b = GasRefund.from(15000);
    const c = GasRefund.from(20000);

    try testing.expect(a.equals(b));
    try testing.expect(!a.equals(c));
}
```

### GasRefund: compare

```zig
test "GasRefund: compare" {
    const a = GasRefund.from(10000);
    const b = GasRefund.from(20000);
    const c = GasRefund.from(10000);

    try testing.expectEqual(@as(i8, -1), a.compare(b));
    try testing.expectEqual(@as(i8, 1), b.compare(a));
    try testing.expectEqual(@as(i8, 0), a.compare(c));
}
```

### GasRefund: cappedRefund

```zig
test "GasRefund: cappedRefund" {
    // EIP-3529 example from TS
    const refund = GasRefund.from(15000);
    const gas_used: u64 = 50000;

    // Cap = 50000 / 5 = 10000
    const capped = refund.cappedRefund(gas_used);
    try testing.expectEqual(@as(u64, 10000), capped.toNumber());

    // Small refund (not capped)
    const small_refund = GasRefund.from(5000);
    const small_capped = small_refund.cappedRefund(gas_used);
    try testing.expectEqual(@as(u64, 5000), small_capped.toNumber());

    // Zero gas used
    const zero_cap = refund.cappedRefund(0);
    try testing.expectEqual(@as(u64, 0), zero_cap.toNumber());
}
```

### GasRefund: cappedRefundPreLondon

```zig
test "GasRefund: cappedRefundPreLondon" {
    // Pre-London cap was gasUsed / 2
    const refund = GasRefund.from(30000);
    const gas_used: u64 = 50000;

    // Cap = 50000 / 2 = 25000
    const capped = refund.cappedRefundPreLondon(gas_used);
    try testing.expectEqual(@as(u64, 25000), capped.toNumber());

    // Small refund (not capped)
    const small_refund = GasRefund.from(10000);
    const small_capped = small_refund.cappedRefundPreLondon(gas_used);
    try testing.expectEqual(@as(u64, 10000), small_capped.toNumber());
}
```

### GasRefund: effectiveGasUsed

```zig
test "GasRefund: effectiveGasUsed" {
    const refund = GasRefund.from(15000);
    const gas_used: u64 = 50000;

    // Effective = 50000 - 10000 (capped) = 40000
    const effective = refund.effectiveGasUsed(gas_used);
    try testing.expectEqual(@as(u64, 40000), effective);

    // Small refund
    const small_refund = GasRefund.from(5000);
    const small_effective = small_refund.effectiveGasUsed(gas_used);
    try testing.expectEqual(@as(u64, 45000), small_effective);
}
```

### GasRefund: toHex and fromHex

```zig
test "GasRefund: toHex and fromHex" {
    const refund = GasRefund.from(0x12C0); // 4800

    const hex = try refund.toHex(testing.allocator);
    defer testing.allocator.free(hex);
    try testing.expectEqualStrings("0x12c0", hex);

    const parsed = try GasRefund.fromHex("0x12C0");
    try testing.expectEqual(@as(u64, 4800), parsed.toNumber());
}
```

### GasRefund: SSTORE clear scenario

```zig
test "GasRefund: SSTORE clear scenario" {
    // Clearing multiple storage slots
    const slots_cleared: u64 = 3;
    const total_refund = GasRefund.from(GasRefund.SSTORE_CLEAR_REFUND * slots_cleared);
    try testing.expectEqual(@as(u64, 14400), total_refund.toNumber());

    // Apply cap for 100k gas used
    // Cap = 100000 / 5 = 20000
    const capped = total_refund.cappedRefund(100000);
    try testing.expectEqual(@as(u64, 14400), capped.toNumber()); // Not capped

    // Apply cap for 50k gas used
    // Cap = 50000 / 5 = 10000
    const capped2 = total_refund.cappedRefund(50000);
    try testing.expectEqual(@as(u64, 10000), capped2.toNumber()); // Capped
}
```
