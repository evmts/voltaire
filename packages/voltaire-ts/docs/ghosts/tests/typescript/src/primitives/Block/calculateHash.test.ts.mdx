---
title: '[TS/JS] src/primitives/Block/calculateHash.test.ts'
source: 'src/primitives/Block/calculateHash.test.ts'
---

> Auto-generated from test file: src/primitives/Block/calculateHash.test.ts

```typescript
import { describe, expect, it } from "vitest";
import * as BlockBody from "../BlockBody/index.js";
import * as BlockHeader from "../BlockHeader/index.js";
import * as Hex from "../Hex/index.js";
import * as Block from "./index.js";

describe("Block.calculateHash", () => {
	// Ethereum Mainnet Block 1 header - test data matching Zig implementation
	// Values match src/primitives/BlockHeader/BlockHeader.zig test vectors
	const block1Header = {
		parentHash: Hex.toBytes(
			"0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3",
		),
		ommersHash: Hex.toBytes(
			"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
		),
		beneficiary: "0x05a56e2d52c817161883f50c441c3228cfe54d9f",
		stateRoot: Hex.toBytes(
			"0xd67e4d450343046425ae4271474353857ab860dbc0a1dce64b41a513722ecc47",
		),
		transactionsRoot: Hex.toBytes(
			"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
		),
		receiptsRoot: Hex.toBytes(
			"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
		),
		logsBloom: new Uint8Array(256),
		difficulty: 17179869184n,
		number: 1n,
		gasLimit: 5000n,
		gasUsed: 0n,
		timestamp: 1438269988n,
		extraData: new Uint8Array(0),
		mixHash: Hex.toBytes(
			"0x969b900de27b6ac6a67742365dd65f55a0526c41fd18e1b16f1a1215c2e66f59",
		),
		nonce: Hex.toBytes("0x539bd4979fef1ec4"),
	};

	it("calculates deterministic 32-byte hash", () => {
		const header = BlockHeader.from(block1Header);
		const body = BlockBody.from({ transactions: [], ommers: [] });

		const block = Block.from({
			header,
			body,
			hash: new Uint8Array(32), // placeholder
			size: 1024n,
		});

		const computedHash = Block.calculateHash(block);

		// Should produce a 32-byte hash
		expect(computedHash).toHaveLength(32);

		// Should be deterministic
		const computedHash2 = Block.calculateHash(block);
		expect(computedHash).toEqual(computedHash2);
	});

	it("returns 32-byte hash", () => {
		const header = BlockHeader.from(block1Header);
		const body = BlockBody.from({ transactions: [], ommers: [] });

		const block = Block.from({
			header,
			body,
			hash: new Uint8Array(32),
			size: 1024n,
		});

		const hash = Block.calculateHash(block);
		expect(hash).toHaveLength(32);
	});

	it("produces same hash as BlockHeader.calculateHash", () => {
		const header = BlockHeader.from(block1Header);
		const body = BlockBody.from({ transactions: [], ommers: [] });

		const block = Block.from({
			header,
			body,
			hash: new Uint8Array(32),
			size: 1024n,
		});

		const blockHash = Block.calculateHash(block);
		const headerHash = BlockHeader.calculateHash(header);

		expect(blockHash).toEqual(headerHash);
	});

	describe("PoS blocks (post-merge)", () => {
		it("calculates hash for post-merge block", () => {
			const header = BlockHeader.from({
				...block1Header,
				difficulty: 0n, // PoS
				number: 15537394n,
				gasLimit: 30000000n,
				gasUsed: 29999968n,
				timestamp: 1663224162n,
				baseFeePerGas: 7n,
			});

			const body = BlockBody.from({ transactions: [], ommers: [] });

			const block = Block.from({
				header,
				body,
				hash: new Uint8Array(32),
				size: 1024n,
			});

			const hash = Block.calculateHash(block);
			expect(hash).toHaveLength(32);
		});

		it("calculates hash for Cancun block with all optional fields", () => {
			const header = BlockHeader.from({
				...block1Header,
				difficulty: 0n,
				number: 19426587n,
				timestamp: 1710338135n,
				baseFeePerGas: 30000000000n,
				withdrawalsRoot: Hex.toBytes(
					"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
				),
				blobGasUsed: 131072n,
				excessBlobGas: 0n,
				parentBeaconBlockRoot: new Uint8Array(32),
			});

			const body = BlockBody.from({
				transactions: [],
				ommers: [],
				withdrawals: [],
			});

			const block = Block.from({
				header,
				body,
				hash: new Uint8Array(32),
				size: 2048n,
			});

			const hash = Block.calculateHash(block);
			expect(hash).toHaveLength(32);
		});
	});
});

```
