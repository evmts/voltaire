---
title: '[TS/JS] src/provider/eip6963/getPlatform.test.ts'
source: 'src/provider/eip6963/getPlatform.test.ts'
---

> Auto-generated from test file: src/provider/eip6963/getPlatform.test.ts

```typescript
/**
 * @vitest-environment node
 */
import { afterEach, describe, expect, it } from "vitest";
import { UnsupportedEnvironmentError } from "./errors.js";
import { assertBrowser, getPlatform } from "./getPlatform.js";

// Helper to set globalThis properties for testing platform detection
// biome-ignore lint/suspicious/noExplicitAny: test helper needs to modify globalThis
const setGlobal = (key: string, value: any) => {
	// biome-ignore lint/suspicious/noExplicitAny: test helper needs to modify globalThis
	(globalThis as any)[key] = value;
};

// biome-ignore lint/suspicious/noExplicitAny: Bun global not in types
const getGlobal = (key: string) => (globalThis as any)[key];

describe("getPlatform", () => {
	const originalDispatchEvent = globalThis.dispatchEvent;
	const originalProcess = globalThis.process;
	const originalBun = getGlobal("Bun");

	afterEach(() => {
		// Restore globals
		// Note: getPlatform.js captures `window = globalThis`, so we need to modify
		// globalThis.dispatchEvent directly, not globalThis.window.dispatchEvent
		setGlobal("dispatchEvent", originalDispatchEvent);
		setGlobal("process", originalProcess);
		if (originalBun !== undefined) {
			setGlobal("Bun", originalBun);
		} else {
			setGlobal("Bun", undefined);
		}
	});

	it("returns 'browser' when dispatchEvent is defined on globalThis", () => {
		// The module does: const window = globalThis;
		// Then checks: typeof window.dispatchEvent === "function"
		// So we need to set globalThis.dispatchEvent
		setGlobal("dispatchEvent", () => {});
		setGlobal("Bun", undefined);
		expect(getPlatform()).toBe("browser");
	});

	it("returns 'node' when process.versions.node is defined", () => {
		setGlobal("dispatchEvent", undefined);
		setGlobal("Bun", undefined);
		setGlobal("process", { versions: { node: "18.0.0" } });
		expect(getPlatform()).toBe("node");
	});

	it("returns 'bun' when Bun is defined", () => {
		setGlobal("dispatchEvent", undefined);
		setGlobal("Bun", {});
		expect(getPlatform()).toBe("bun");
	});

	it("returns 'unknown' when no platform detected", () => {
		setGlobal("dispatchEvent", undefined);
		setGlobal("Bun", undefined);
		setGlobal("process", {});
		expect(getPlatform()).toBe("unknown");
	});

	it("prioritizes browser over node", () => {
		setGlobal("dispatchEvent", () => {});
		setGlobal("process", { versions: { node: "18.0.0" } });
		setGlobal("Bun", undefined);
		expect(getPlatform()).toBe("browser");
	});
});

describe("assertBrowser", () => {
	const originalDispatchEvent = globalThis.dispatchEvent;
	const originalBun = getGlobal("Bun");

	afterEach(() => {
		setGlobal("dispatchEvent", originalDispatchEvent);
		if (originalBun !== undefined) {
			setGlobal("Bun", originalBun);
		} else {
			setGlobal("Bun", undefined);
		}
	});

	it("throws UnsupportedEnvironmentError when not in browser", () => {
		setGlobal("dispatchEvent", undefined);
		setGlobal("Bun", undefined);
		expect(() => assertBrowser()).toThrow(UnsupportedEnvironmentError);
	});

	it("does not throw when in browser", () => {
		setGlobal("dispatchEvent", () => {});
		setGlobal("Bun", undefined);
		expect(() => assertBrowser()).not.toThrow();
	});

	it("includes platform name in error", () => {
		setGlobal("dispatchEvent", undefined);
		setGlobal("Bun", undefined);
		try {
			assertBrowser();
		} catch (e) {
			expect((e as UnsupportedEnvironmentError).platform).toBe("node");
		}
	});
});

```
