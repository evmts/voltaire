---
title: '[TS/JS] docs/primitives/transaction/index.test.ts'
source: 'docs/primitives/transaction/index.test.ts'
---

> Auto-generated from test file: docs/primitives/transaction/index.test.ts

```typescript
/**
 * Tests for docs/primitives/transaction/index.mdx
 *
 * Validates that all code examples in the Transaction documentation work correctly.
 */
import { describe, expect, it } from "vitest";

describe("Transaction Documentation - index.mdx", () => {
	describe("Type Enum", () => {
		it("should export transaction type enum", async () => {
			const { Type } = await import("../../../src/primitives/Transaction/index.js");

			expect(Type.Legacy).toBe(0x00);
			expect(Type.EIP2930).toBe(0x01);
			expect(Type.EIP1559).toBe(0x02);
			expect(Type.EIP4844).toBe(0x03);
			expect(Type.EIP7702).toBe(0x04);
		});
	});

	describe("Type Guards", () => {
		it("should have isLegacy type guard", async () => {
			const { isLegacy, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);

			const legacyTx = { type: Type.Legacy };
			expect(isLegacy(legacyTx)).toBe(true);

			const eip1559Tx = { type: Type.EIP1559 };
			expect(isLegacy(eip1559Tx)).toBe(false);
		});

		it("should have isEIP1559 type guard", async () => {
			const { isEIP1559, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);

			const eip1559Tx = { type: Type.EIP1559 };
			expect(isEIP1559(eip1559Tx)).toBe(true);
		});

		it("should have isEIP4844 type guard", async () => {
			const { isEIP4844, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);

			const eip4844Tx = { type: Type.EIP4844 };
			expect(isEIP4844(eip4844Tx)).toBe(true);
		});
	});

	describe("Serialization", () => {
		it("should serialize and deserialize legacy transaction", async () => {
			const { serialize, deserialize, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);
			const { Address } = await import("../../../src/primitives/Address/index.js");

			const legacyTx = {
				type: Type.Legacy,
				nonce: 0n,
				gasPrice: 20000000000n,
				gasLimit: 21000n,
				to: Address("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
				value: 1000000000000000000n,
				data: new Uint8Array(),
				v: 27n,
				r: new Uint8Array(32),
				s: new Uint8Array(32),
			};

			const serialized = serialize(legacyTx);
			expect(serialized).toBeInstanceOf(Uint8Array);

			const deserialized = deserialize(serialized);
			expect(deserialized.type).toBe(Type.Legacy);
		});

		it("should serialize and deserialize EIP-1559 transaction", async () => {
			const { serialize, deserialize, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);
			const { Address } = await import("../../../src/primitives/Address/index.js");

			const eip1559Tx = {
				type: Type.EIP1559,
				chainId: 1n,
				nonce: 0n,
				maxPriorityFeePerGas: 1000000000n,
				maxFeePerGas: 20000000000n,
				gasLimit: 21000n,
				to: Address("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
				value: 1000000000000000000n,
				data: new Uint8Array(),
				accessList: [],
				yParity: 0,
				r: new Uint8Array(32),
				s: new Uint8Array(32),
			};

			const serialized = serialize(eip1559Tx);
			expect(serialized).toBeInstanceOf(Uint8Array);
			// EIP-1559 transactions start with 0x02
			expect(serialized[0]).toBe(0x02);

			const deserialized = deserialize(serialized);
			expect(deserialized.type).toBe(Type.EIP1559);
		});
	});

	describe("Type Detection", () => {
		it("should detect transaction type from serialized bytes", async () => {
			const { serialize, detectType, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);
			const { Address } = await import("../../../src/primitives/Address/index.js");

			const eip1559Tx = {
				type: Type.EIP1559,
				chainId: 1n,
				nonce: 0n,
				maxPriorityFeePerGas: 1000000000n,
				maxFeePerGas: 20000000000n,
				gasLimit: 21000n,
				to: Address("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
				value: 0n,
				data: new Uint8Array(),
				accessList: [],
				yParity: 0,
				r: new Uint8Array(32),
				s: new Uint8Array(32),
			};

			const serialized = serialize(eip1559Tx);
			const detectedType = detectType(serialized);
			expect(detectedType).toBe(Type.EIP1559);
		});
	});

	describe("Hashing", () => {
		it("should compute transaction hash", async () => {
			const { serialize, hash, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);
			const { Address } = await import("../../../src/primitives/Address/index.js");

			const tx = {
				type: Type.EIP1559,
				chainId: 1n,
				nonce: 0n,
				maxPriorityFeePerGas: 1000000000n,
				maxFeePerGas: 20000000000n,
				gasLimit: 21000n,
				to: Address("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
				value: 0n,
				data: new Uint8Array(),
				accessList: [],
				yParity: 0,
				r: new Uint8Array(32),
				s: new Uint8Array(32),
			};

			const txHash = hash(tx);
			expect(txHash).toBeInstanceOf(Uint8Array);
			expect(txHash.length).toBe(32);
		});

		it("should get signing hash", async () => {
			const { getSigningHash, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);
			const { Address } = await import("../../../src/primitives/Address/index.js");

			const tx = {
				type: Type.EIP1559,
				chainId: 1n,
				nonce: 0n,
				maxPriorityFeePerGas: 1000000000n,
				maxFeePerGas: 20000000000n,
				gasLimit: 21000n,
				to: Address("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
				value: 0n,
				data: new Uint8Array(),
				accessList: [],
			};

			const signingHash = getSigningHash(tx);
			expect(signingHash).toBeInstanceOf(Uint8Array);
			expect(signingHash.length).toBe(32);
		});
	});

	describe("Utilities", () => {
		it("should get chain ID", async () => {
			const { getChainId, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);
			const { Address } = await import("../../../src/primitives/Address/index.js");

			const tx = {
				type: Type.EIP1559,
				chainId: 1n,
				nonce: 0n,
				maxPriorityFeePerGas: 1000000000n,
				maxFeePerGas: 20000000000n,
				gasLimit: 21000n,
				to: Address("0x742d35Cc6634C0532925a3b844Bc9e7595f51e3e"),
				value: 0n,
				data: new Uint8Array(),
				accessList: [],
			};

			const chainId = getChainId(tx);
			expect(chainId).toBe(1n);
		});

		it("should check for access list", async () => {
			const { hasAccessList, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);

			// Legacy tx has no access list
			const legacyTx = { type: Type.Legacy };
			expect(hasAccessList(legacyTx)).toBe(false);

			// EIP-1559 can have access list
			const eip1559Tx = {
				type: Type.EIP1559,
				accessList: [],
			};
			expect(hasAccessList(eip1559Tx)).toBe(true);
		});

		it("should check if signed", async () => {
			const { isSigned, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);

			// Unsigned transaction
			const unsignedTx = {
				type: Type.EIP1559,
				chainId: 1n,
				nonce: 0n,
			};
			expect(isSigned(unsignedTx)).toBe(false);

			// Signed transaction
			const signedTx = {
				type: Type.EIP1559,
				chainId: 1n,
				nonce: 0n,
				yParity: 0,
				r: new Uint8Array(32).fill(1),
				s: new Uint8Array(32).fill(1),
			};
			expect(isSigned(signedTx)).toBe(true);
		});

		it("should check if contract creation", async () => {
			const { isContractCreation, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);

			// Contract creation (to is null)
			const createTx = {
				type: Type.EIP1559,
				to: null,
			};
			expect(isContractCreation(createTx)).toBe(true);

			// Regular transfer
			const transferTx = {
				type: Type.EIP1559,
				to: new Uint8Array(20),
			};
			expect(isContractCreation(transferTx)).toBe(false);
		});
	});

	describe("Gas Price", () => {
		it("should get gas price for legacy transaction", async () => {
			const { getGasPrice, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);

			const legacyTx = {
				type: Type.Legacy,
				gasPrice: 20000000000n,
			};

			const gasPrice = getGasPrice(legacyTx);
			expect(gasPrice).toBe(20000000000n);
		});

		it("should get gas price for EIP-1559 transaction with baseFee", async () => {
			const { getGasPrice, Type } = await import(
				"../../../src/primitives/Transaction/index.js"
			);

			const eip1559Tx = {
				type: Type.EIP1559,
				maxPriorityFeePerGas: 1000000000n,
				maxFeePerGas: 20000000000n,
			};

			const baseFee = 10000000000n;
			const gasPrice = getGasPrice(eip1559Tx, baseFee);

			// Effective gas price = min(maxFeePerGas, baseFee + maxPriorityFeePerGas)
			// = min(20000000000, 10000000000 + 1000000000) = 11000000000
			expect(gasPrice).toBe(11000000000n);
		});
	});
});

```
