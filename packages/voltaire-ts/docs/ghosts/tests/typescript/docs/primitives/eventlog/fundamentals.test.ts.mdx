---
title: '[TS/JS] docs/primitives/eventlog/fundamentals.test.ts'
source: 'docs/primitives/eventlog/fundamentals.test.ts'
---

> Auto-generated from test file: docs/primitives/eventlog/fundamentals.test.ts

```typescript
/**
 * Tests for docs/primitives/eventlog/fundamentals.mdx
 * Tests the code examples from the EventLog fundamentals documentation
 */

import { describe, expect, it } from "vitest";

describe("EventLog fundamentals.mdx documentation examples", () => {
	describe("Creating and Parsing Event Logs", () => {
		it("creates Transfer event log with proper structure", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");
			const Hex = await import("../../../src/primitives/Hex/index.js");

			// ERC-20 Transfer event signature
			const TRANSFER_SIG = Hash.from(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);

			// Create topic hashes (addresses are right-aligned in 32-byte topics)
			const fromHash = Hash.from(
				"0x000000000000000000000000a1b2c3d4e5f67890abcdef1234567890abcdef12",
			);
			const toHash = Hash.from(
				"0x000000000000000000000000fedcba0987654321fedcba0987654321fedcba09",
			);

			// Create log
			const log = EventLog.create({
				address: Address.Address(
					"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb2",
				),
				topics: [TRANSFER_SIG, fromHash, toHash],
				data: Hex.toBytes(
					"0x0000000000000000000000000000000000000000000000000de0b6b3a7640000",
				), // 1 ether
				blockNumber: 18000000n,
				logIndex: 5,
			});

			// Access signature
			const signature = EventLog.getTopic0(log);
			expect(signature).toBeDefined();
			expect(Hash.toHex(signature!)).toBe(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);

			// Access indexed parameters
			const indexed = EventLog.getIndexedTopics(log);
			expect(indexed.length).toBe(2);
		});
	});

	describe("Filtering Event Logs - Address Filtering", () => {
		it("filters by single address", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const usdcAddress = Address.Address(
				"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
			);
			const daiAddress = Address.Address(
				"0x6B175474E89094C44Da98b954EedeAC495271d0F",
			);

			const allLogs = [
				EventLog.create({
					address: usdcAddress,
					topics: [Hash.from("0x" + "00".repeat(32))],
					data: new Uint8Array([]),
				}),
				EventLog.create({
					address: daiAddress,
					topics: [Hash.from("0x" + "00".repeat(32))],
					data: new Uint8Array([]),
				}),
			];

			// Single address filter
			// NOTE: Docs show allLogs.filter(log => log.matchesAddress(usdcAddress))
			// Actual API: allLogs.filter(log => EventLog.matchesAddress(log, usdcAddress))
			const usdcLogs = allLogs.filter((log) =>
				EventLog.matchesAddress(log, usdcAddress),
			);
			expect(usdcLogs.length).toBe(1);

			// Multiple addresses (OR logic)
			const stablecoinLogs = allLogs.filter((log) =>
				EventLog.matchesAddress(log, [usdcAddress, daiAddress]),
			);
			expect(stablecoinLogs.length).toBe(2);

			// Using filterLogs
			const filtered = EventLog.filterLogs(allLogs, {
				address: [usdcAddress, daiAddress],
			});
			expect(filtered.length).toBe(2);
		});
	});

	describe("Filtering Event Logs - Topic Filtering", () => {
		it("filters by topics with wildcards and OR logic", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const TRANSFER_SIG = Hash.from(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);
			const userHash = Hash.from(
				"0x000000000000000000000000a1b2c3d4e5f67890abcdef1234567890abcdef12",
			);
			const otherHash = Hash.from("0x" + "99".repeat(32));

			const allLogs = [
				EventLog.create({
					address: Address.Address.zero(),
					topics: [TRANSFER_SIG, otherHash, userHash],
					data: new Uint8Array([]),
				}),
				EventLog.create({
					address: Address.Address.zero(),
					topics: [TRANSFER_SIG, userHash, otherHash],
					data: new Uint8Array([]),
				}),
			];

			// Match specific signature
			// NOTE: Docs show allLogs.filter(log => log.matchesTopics([TRANSFER_SIG]))
			// Actual API: allLogs.filter(log => EventLog.matchesTopics(log, [TRANSFER_SIG]))
			const transfers = allLogs.filter((log) =>
				EventLog.matchesTopics(log, [TRANSFER_SIG]),
			);
			expect(transfers.length).toBe(2);

			// Match signature + indexed parameter (to: userHash)
			const transfersToUser = allLogs.filter((log) =>
				EventLog.matchesTopics(log, [
					TRANSFER_SIG, // topic0: event signature
					null, // topic1: any from address
					userHash, // topic2: specific to address
				]),
			);
			expect(transfersToUser.length).toBe(1);
		});
	});

	describe("Complete Filter", () => {
		it("combines address, topics, and block range", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const usdcAddress = Address.Address(
				"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
			);
			const daiAddress = Address.Address(
				"0x6B175474E89094C44Da98b954EedeAC495271d0F",
			);
			const wethAddress = Address.Address(
				"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",
			);
			const TRANSFER_SIG = Hash.from(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);
			const userAddressHash = Hash.from(
				"0x000000000000000000000000a1b2c3d4e5f67890abcdef1234567890abcdef12",
			);

			const allLogs = [
				EventLog.create({
					address: usdcAddress,
					topics: [
						TRANSFER_SIG,
						Hash.from("0x" + "11".repeat(32)),
						userAddressHash,
					],
					data: new Uint8Array([]),
					blockNumber: 18100000n,
				}),
				EventLog.create({
					address: daiAddress,
					topics: [
						TRANSFER_SIG,
						Hash.from("0x" + "22".repeat(32)),
						userAddressHash,
					],
					data: new Uint8Array([]),
					blockNumber: 17000000n, // out of range
				}),
			];

			const filtered = EventLog.filterLogs(allLogs, {
				address: [usdcAddress, daiAddress, wethAddress],
				topics: [
					TRANSFER_SIG, // Event signature
					null, // from: any
					userAddressHash, // to: user
				],
				fromBlock: 18000000n,
				toBlock: 18500000n,
			});

			expect(filtered.length).toBe(1);

			// Sort chronologically
			const sorted = EventLog.sortLogs(filtered);
			expect(sorted.length).toBe(1);
		});
	});

	describe("Chain Reorganizations", () => {
		it("filters out removed logs", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const allLogs = [
				EventLog.create({
					address: Address.Address.zero(),
					topics: [Hash.from("0x" + "00".repeat(32))],
					data: new Uint8Array([]),
					removed: false,
					blockNumber: 100n,
				}),
				EventLog.create({
					address: Address.Address.zero(),
					topics: [Hash.from("0x" + "00".repeat(32))],
					data: new Uint8Array([]),
					removed: true,
					blockNumber: 101n,
				}),
			];

			// Filter active logs only
			// NOTE: Docs show allLogs.filter(log => !log.isRemoved())
			// Actual API: allLogs.filter(log => !EventLog.isRemoved(log))
			const activeLogs = allLogs.filter((log) => !EventLog.isRemoved(log));
			expect(activeLogs.length).toBe(1);

			// Detect reorg
			// NOTE: Docs show newLogs.filter(log => log.wasRemoved())
			// Actual API: newLogs.filter(log => EventLog.wasRemoved(log))
			const removed = allLogs.filter((log) => EventLog.wasRemoved(log));
			expect(removed.length).toBe(1);
		});
	});

	describe("Anonymous Events", () => {
		it("handles anonymous events correctly", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			const fromHash = Hash.from("0x" + "11".repeat(32));
			const toHash = Hash.from("0x" + "22".repeat(32));
			const tokenIdHash = Hash.from("0x" + "33".repeat(32));

			// Anonymous events: topic0 is first indexed param, NOT signature
			const anonymousLog = EventLog.create({
				address: Address.Address.zero(),
				topics: [fromHash, toHash, tokenIdHash], // All indexed params
				data: new Uint8Array([]),
			});

			// getTopic0 returns first indexed parameter (NOT event signature)
			const topic0 = EventLog.getTopic0(anonymousLog);
			expect(Hash.equals(topic0!, fromHash)).toBe(true);

			// getIndexedTopics returns topic1-topic3 (NOT all params)
			const indexed = EventLog.getIndexedTopics(anonymousLog);
			expect(indexed.length).toBe(2); // param2 and param3
		});
	});

	describe("ERC-20 Transfer Tracking Complete Example", () => {
		it("tracks user balance changes", async () => {
			const EventLog = await import(
				"../../../src/primitives/EventLog/index.js"
			);
			const Address = await import("../../../src/primitives/Address/index.js");
			const Hash = await import("../../../src/primitives/Hash/index.js");

			// Event signature
			const TRANSFER_SIG = Hash.from(
				"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
			);

			const usdcAddress = Address.Address(
				"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",
			);
			const userHash = Hash.from(
				"0x000000000000000000000000a1b2c3d4e5f67890abcdef1234567890abcdef12",
			);
			const otherHash = Hash.from("0x" + "99".repeat(32));

			// Create sample transfer data (32 bytes for uint256 value)
			const valueData = new Uint8Array(32);
			valueData[31] = 100; // value = 100

			const allLogs = [
				// Incoming transfer
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG, otherHash, userHash],
					data: valueData,
					blockNumber: 18100000n,
				}),
				// Outgoing transfer
				EventLog.create({
					address: usdcAddress,
					topics: [TRANSFER_SIG, userHash, otherHash],
					data: valueData,
					blockNumber: 18200000n,
				}),
			];

			// Filter incoming transfers
			const incoming = EventLog.filterLogs(allLogs, {
				address: usdcAddress,
				topics: [
					TRANSFER_SIG,
					null, // from: any
					userHash, // to: user
				],
				fromBlock: 18000000n,
				toBlock: 18500000n,
			});

			// Filter outgoing transfers
			const outgoing = EventLog.filterLogs(allLogs, {
				address: usdcAddress,
				topics: [
					TRANSFER_SIG,
					userHash, // from: user
					null, // to: any
				],
				fromBlock: 18000000n,
				toBlock: 18500000n,
			});

			expect(incoming.length).toBe(1);
			expect(outgoing.length).toBe(1);
		});
	});
});

```
