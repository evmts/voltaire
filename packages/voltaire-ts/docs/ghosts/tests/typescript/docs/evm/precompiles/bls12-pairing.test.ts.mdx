---
title: '[TS/JS] docs/evm/precompiles/bls12-pairing.test.ts'
source: 'docs/evm/precompiles/bls12-pairing.test.ts'
---

> Auto-generated from test file: docs/evm/precompiles/bls12-pairing.test.ts

```typescript
/**
 * Tests for bls12-pairing.mdx documentation examples
 * Validates code examples work correctly with actual API
 */
import { describe, expect, it } from "vitest";
import { PrecompileAddress, execute, bls12Pairing } from "../../../src/evm/precompiles/precompiles.js";
import * as Hardfork from "../../../src/primitives/Hardfork/index.js";

describe("bls12-pairing.mdx documentation examples", () => {
	describe("Overview section", () => {
		it("should perform pairing check on BLS12-381 curve", () => {
			// Doc states: performs a pairing check on the BLS12-381 elliptic curve
			// Empty input (0 pairs) should return success (empty product = 1)
			const input = new Uint8Array(0);
			const result = bls12Pairing(input, 120000n);

			expect(result.success).toBe(true);
			expect(result.output.length).toBe(32);
		});
	});

	describe("Gas Cost section", () => {
		it("should follow formula: 43000 * k + 65000", () => {
			// Doc states: Formula: 43000 * k + 65000 where k = number of point pairs
			const testCases = [
				{ pairs: 0, expectedGas: 65000n },   // 43000*0 + 65000 = 65000
				{ pairs: 1, expectedGas: 108000n },  // 43000*1 + 65000 = 108000
				{ pairs: 2, expectedGas: 151000n },  // 43000*2 + 65000 = 151000
				{ pairs: 4, expectedGas: 237000n },  // 43000*4 + 65000 = 237000
			];

			for (const { pairs, expectedGas } of testCases) {
				// Each pair is 384 bytes (128-byte G1 + 256-byte G2)
				const input = new Uint8Array(384 * pairs);
				const result = bls12Pairing(input, 300000n);
				expect(result.gasUsed).toBe(expectedGas);
			}
		});

		it("should fail with insufficient gas for empty input", () => {
			const input = new Uint8Array(0);
			const result = bls12Pairing(input, 64999n); // Need 65000
			expect(result.success).toBe(false);
			expect(result.error).toBe("Out of gas");
		});

		it("should fail with insufficient gas for 1 pair", () => {
			const input = new Uint8Array(384);
			const result = bls12Pairing(input, 107999n); // Need 108000
			expect(result.success).toBe(false);
			expect(result.error).toBe("Out of gas");
		});
	});

	describe("Input Format section", () => {
		it("should accept input as multiple of 384 bytes", () => {
			// Doc states: Input must be a multiple of 384 bytes (128-byte G1 + 256-byte G2)
			const validSizes = [0, 384, 768, 1152];

			for (const size of validSizes) {
				const input = new Uint8Array(size);
				const pairs = size / 384;
				const gasNeeded = 43000n * BigInt(pairs) + 65000n;
				const result = bls12Pairing(input, gasNeeded + 10000n);
				expect(result.gasUsed).toBe(gasNeeded);
			}
		});

		it("should fail for input not multiple of 384", () => {
			// Doc states: Input length not multiple of 384 -> error
			const invalidSizes = [1, 100, 383, 385, 500];

			for (const size of invalidSizes) {
				const input = new Uint8Array(size);
				const result = bls12Pairing(input, 200000n);
				expect(result.success).toBe(false);
			}
		});

		it("should accept empty input (k=0)", () => {
			// Doc states: Empty input (0 bytes) is valid and returns success
			const input = new Uint8Array(0);
			const result = bls12Pairing(input, 100000n);

			expect(result.success).toBe(true);
			expect(result.output[31]).toBe(1); // Pairing check passes (empty product = 1)
		});
	});

	describe("Output Format section", () => {
		it("should return 32 bytes", () => {
			// Doc states: Total output length: 32 bytes
			const input = new Uint8Array(0);
			const result = bls12Pairing(input, 100000n);

			expect(result.success).toBe(true);
			expect(result.output.length).toBe(32);
		});

		it("should return 1 for successful pairing check", () => {
			// Doc states: Success: 0x0000...0001 (last byte = 1)
			const input = new Uint8Array(0);
			const result = bls12Pairing(input, 100000n);

			expect(result.success).toBe(true);
			expect(result.output[31]).toBe(1);
			// Other bytes should be zero
			expect([...result.output.slice(0, 31)].every((b) => b === 0)).toBe(true);
		});
	});

	describe("Error Conditions section", () => {
		it("should fail with out of gas", () => {
			const input = new Uint8Array(384);
			const result = bls12Pairing(input, 1000n);
			expect(result.success).toBe(false);
		});

		it("should fail for input length not multiple of 384", () => {
			const input = new Uint8Array(100);
			const result = bls12Pairing(input, 200000n);
			expect(result.success).toBe(false);
		});
	});

	describe("Integration with execute function", () => {
		it("should work via execute with PrecompileAddress.BLS12_PAIRING", () => {
			const input = new Uint8Array(0);
			const result = execute(
				PrecompileAddress.BLS12_PAIRING,
				input,
				100000n,
				Hardfork.PRAGUE,
			);

			expect(result.success).toBe(true);
			expect(result.gasUsed).toBe(65000n);
			expect(result.output[31]).toBe(1);
		});

		it("should be available from PRAGUE hardfork", () => {
			// Doc states: Introduced: Prague (EIP-2537)
			const input = new Uint8Array(0);
			const result = execute(
				PrecompileAddress.BLS12_PAIRING,
				input,
				100000n,
				Hardfork.PRAGUE,
			);
			expect(result.success).toBe(true);
		});

		it("hardfork availability via isPrecompile function", async () => {
			// NOTE: execute() does not enforce hardfork availability
			// Use isPrecompile() to check availability
			const { isPrecompile } = await import("../../../src/evm/precompiles/precompiles.js");
			expect(isPrecompile(PrecompileAddress.BLS12_PAIRING, Hardfork.PRAGUE)).toBe(true);
			expect(isPrecompile(PrecompileAddress.BLS12_PAIRING, Hardfork.CANCUN)).toBe(false);
		});
	});

	describe("Security section", () => {
		it("should provide 128-bit security", () => {
			// Doc states: BLS12-381 provides 128-bit security (vs BN254's ~100-bit)
			// This is a documentation check - we verify the precompile is available
			const input = new Uint8Array(0);
			const result = bls12Pairing(input, 100000n);
			expect(result.success).toBe(true);
		});
	});
});

```
