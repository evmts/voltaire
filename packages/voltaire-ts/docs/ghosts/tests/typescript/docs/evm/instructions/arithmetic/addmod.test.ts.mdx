---
title: '[TS/JS] docs/evm/instructions/arithmetic/addmod.test.ts'
source: 'docs/evm/instructions/arithmetic/addmod.test.ts'
---

> Auto-generated from test file: docs/evm/instructions/arithmetic/addmod.test.ts

```typescript
/**
 * Test file for ADDMOD (0x08) documentation examples
 * Tests examples from addmod.mdx
 *
 * NOTE: Stack order is [bottom, ..., top] - pop() returns the last element.
 * For ADDMOD(a, b, N): a is popped first, b second, N third. Result = (a + b) % N.
 * So for (a + b) % N, stack should be [N, b, a].
 */
import { describe, expect, it } from "vitest";

describe("ADDMOD (0x08) - Documentation Examples", async () => {
	const { addmod } = await import("../../../../src/evm/arithmetic/index.js");
	const { Frame } = await import("../../../../src/evm/Frame/index.js");

	function createFrame(stack: bigint[], gasRemaining = 1000000n) {
		const frame = Frame({ gas: gasRemaining });
		frame.stack = [...stack];
		return frame;
	}

	describe("Basic Modular Addition", () => {
		it("(5 + 10) % 3 = 0", () => {
			const frame = createFrame([3n, 10n, 5n]);
			const err = addmod(frame);

			expect(err).toBeNull();
			expect(frame.stack).toEqual([0n]); // 15 % 3 = 0
		});
	});

	describe("Overflow-Safe Addition", () => {
		it("handles MAX + MAX without overflow", () => {
			const MAX_U256 = (1n << 256n) - 1n;
			const frame = createFrame([100n, MAX_U256, MAX_U256]);
			const err = addmod(frame);

			expect(err).toBeNull();
			const expected = (MAX_U256 + MAX_U256) % 100n;
			expect(frame.stack).toEqual([expected]);
		});
	});

	describe("Zero Modulus", () => {
		it("returns 0 when N = 0", () => {
			const frame = createFrame([0n, 10n, 5n]);
			const err = addmod(frame);

			expect(err).toBeNull();
			expect(frame.stack).toEqual([0n]);
		});
	});

	describe("Modulus of 1", () => {
		it("any number mod 1 is 0", () => {
			const frame = createFrame([1n, 888n, 999n]);
			const err = addmod(frame);

			expect(err).toBeNull();
			expect(frame.stack).toEqual([0n]);
		});
	});

	describe("Large Modulus", () => {
		it("no reduction when sum < modulus", () => {
			const frame = createFrame([1000n, 10n, 5n]);
			const err = addmod(frame);

			expect(err).toBeNull();
			expect(frame.stack).toEqual([15n]);
		});
	});

	describe("Edge Cases", () => {
		it("a + 0 mod N", () => {
			const frame = createFrame([17n, 0n, 42n]);
			addmod(frame);
			expect(frame.stack).toEqual([42n % 17n]); // 8n
		});

		it("0 + 0 mod N = 0", () => {
			const frame = createFrame([17n, 0n, 0n]);
			addmod(frame);
			expect(frame.stack).toEqual([0n]);
		});

		it("returns StackUnderflow with insufficient stack", () => {
			const frame = createFrame([5n, 10n]);
			const err = addmod(frame);

			expect(err).toEqual({ type: "StackUnderflow" });
		});

		it("returns OutOfGas when insufficient gas", () => {
			const frame = createFrame([3n, 10n, 5n], 7n);
			const err = addmod(frame);

			expect(err).toEqual({ type: "OutOfGas" });
			expect(frame.gasRemaining).toBe(0n);
		});
	});

	describe("Gas Cost", () => {
		it("consumes 8 gas (GasMidStep)", () => {
			const frame = createFrame([3n, 10n, 5n], 100n);
			const err = addmod(frame);

			expect(err).toBeNull();
			expect(frame.gasRemaining).toBe(92n);
		});
	});
});

```
