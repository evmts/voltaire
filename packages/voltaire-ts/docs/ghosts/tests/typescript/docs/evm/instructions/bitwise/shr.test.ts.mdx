---
title: '[TS/JS] docs/evm/instructions/bitwise/shr.test.ts'
source: 'docs/evm/instructions/bitwise/shr.test.ts'
---

> Auto-generated from test file: docs/evm/instructions/bitwise/shr.test.ts

```typescript
/**
 * Test file for SHR (0x1c) documentation examples
 * Tests examples from shr.mdx
 *
 * NOTE: Stack order is [bottom, ..., top] - pop() returns the last element.
 * For SHR(shift, value): stack should be [value, shift] so pop() returns shift first.
 */
import { describe, expect, it } from "vitest";

describe("SHR (0x1c) - Documentation Examples", async () => {
	const { SHR } = await import("../../../../src/evm/bitwise/index.js");
	const { Frame } = await import("../../../../src/evm/Frame/index.js");

	function createFrame(stack: bigint[], gasRemaining = 1000000n) {
		const frame = Frame({ gas: gasRemaining });
		frame.stack = [...stack];
		return frame;
	}

	describe("Basic Right Shift", () => {
		it("shifts 0xFF00 right by 8 bits", () => {
			const frame = createFrame([0xff00n, 8n]);
			const err = SHR(frame);

			expect(err).toBeNull();
			expect(frame.stack).toEqual([0xffn]);
		});
	});

	describe("Divide by Power of 2", () => {
		it("40 >> 3 = 40 / 8 = 5", () => {
			const frame = createFrame([40n, 3n]);
			SHR(frame);

			expect(frame.stack).toEqual([5n]);
		});
	});

	describe("Zero Shift (Identity)", () => {
		it("shift by 0 returns original value", () => {
			const value = 0x123456n;
			const frame = createFrame([value, 0n]);
			SHR(frame);

			expect(frame.stack).toEqual([value]);
		});
	});

	describe("Maximum Shift (Underflow)", () => {
		it("shift >= 256 results in 0", () => {
			const value = 0xffffffffn;
			const frame = createFrame([value, 256n]);
			SHR(frame);

			expect(frame.stack).toEqual([0n]);
		});

		it("large shift amount results in 0", () => {
			for (const shift of [256n, 257n, 1000n]) {
				const frame = createFrame([0xffffn, shift]);
				SHR(frame);
				expect(frame.stack).toEqual([0n]);
			}
		});
	});

	describe("Extract MSB", () => {
		it("shifts MSB to LSB position", () => {
			const value = 1n << 255n;
			const frame = createFrame([value, 255n]);
			SHR(frame);

			expect(frame.stack).toEqual([1n]);
		});
	});

	describe("Zero Value", () => {
		it("shifting zero yields zero", () => {
			const frame = createFrame([0n, 100n]);
			SHR(frame);

			expect(frame.stack).toEqual([0n]);
		});
	});

	describe("Shift by 1 (Halve)", () => {
		it("shifts right by 1 halves the value (truncated)", () => {
			const frame = createFrame([43n, 1n]);
			SHR(frame);

			expect(frame.stack).toEqual([21n]); // 43/2 = 21.5 truncated
		});
	});

	describe("Truncation", () => {
		it("low bits are discarded", () => {
			const value = 0xffffn;
			const frame = createFrame([value, 4n]);
			SHR(frame);

			expect(frame.stack).toEqual([0xfffn]);
		});
	});

	describe("Logical Shift (Zero-Fill)", () => {
		it("zero-fills on MSB set value", () => {
			const value = 1n << 255n; // MSB set
			const frame = createFrame([value, 1n]);
			SHR(frame);

			// Logical shift: zero-filled, result is positive
			expect(frame.stack).toEqual([1n << 254n]);
		});
	});

	describe("Extract High Bits", () => {
		it("extracts upper portion of value", () => {
			const value = (0x123456n << 128n) | 0xabcdefn;
			const frame = createFrame([value, 128n]);
			SHR(frame);

			expect(frame.stack).toEqual([0x123456n]);
		});
	});

	describe("Edge Cases", () => {
		it("returns StackUnderflow with insufficient stack", () => {
			const frame = createFrame([8n]);
			const err = SHR(frame);

			expect(err).toEqual({ type: "StackUnderflow" });
		});

		it("returns OutOfGas when insufficient gas", () => {
			const frame = createFrame([0xff00n, 8n], 2n);
			const err = SHR(frame);

			expect(err).toEqual({ type: "OutOfGas" });
			expect(frame.gasRemaining).toBe(0n);
		});
	});

	describe("Gas Cost", () => {
		it("consumes 3 gas (GasFastestStep)", () => {
			const frame = createFrame([0xff00n, 8n], 100n);
			const err = SHR(frame);

			expect(err).toBeNull();
			expect(frame.gasRemaining).toBe(97n);
		});
	});
});

```
