---
title: Identity (0x04)
description: Identity function - returns input unchanged
---

# Identity

Identity function that returns its input unchanged. Used for copying data.

## Overview

The Identity precompile provides:
- **Data Copy**: Returns input data as-is
- **Variable Length**: Accepts inputs of any size
- **Memory Copy**: Efficient data duplication
- **Address**: 0x0000000000000000000000000000000000000004
- **Since**: Frontier

**Source**: `src/precompiles/identity.zig`

## Key Functions

### execute

```zig
const precompiles = @import("precompiles");

pub fn execute(
    allocator: std.mem.Allocator,
    input: []const u8,
    gas_limit: u64,
) PrecompileError!PrecompileResult
```

**Parameters:**
- `allocator`: Memory allocator for result
- `input`: Data to copy (any length)
- `gas_limit`: Maximum gas available

**Returns:** Exact copy of input data

**Errors:** `OutOfGas`, `OutOfMemory`

## Gas Costs

**Formula:** `15 + 3 * ceil(input_len / 32)`

- **Base Cost:** 15 gas
- **Per Word:** 3 gas per 32-byte word (rounded up)

**Examples:**
- Empty input (0 bytes): 15 gas
- 32 bytes: 18 gas
- 33 bytes: 21 gas (rounds up to 2 words)
- 64 bytes: 21 gas
- 1000 bytes: 111 gas

This is the cheapest precompile for data operations.

## Examples

### Copy Data

```zig
const std = @import("std");
const precompiles = @import("precompiles");

pub fn copyData() !void {
    const allocator = std.heap.page_allocator;

    const input = &[_]u8{ 1, 2, 3, 4, 5 };
    const result = try precompiles.identity.execute(
        allocator,
        input,
        1000,
    );
    defer result.deinit(allocator);

    // Output equals input
    std.debug.print("Input:  {any}\n", .{input});
    std.debug.print("Output: {any}\n", .{result.output});
}
```

### Efficient Memory Copy

```zig
const std = @import("std");
const precompiles = @import("precompiles");

pub fn efficientCopy(data: []const u8) ![]u8 {
    const allocator = std.heap.page_allocator;

    // Calculate required gas
    const words = (data.len + 31) / 32;
    const required_gas = 15 + 3 * words;

    // Execute identity (cheaper than manual allocation + copy)
    const result = try precompiles.identity.execute(
        allocator,
        data,
        required_gas,
    );

    return result.output;
}
```

### Validate Identity Property

```zig
const std = @import("std");
const precompiles = @import("precompiles");

test "identity preserves data" {
    const allocator = std.testing.allocator;

    const input = &[_]u8{ 0xDE, 0xAD, 0xBE, 0xEF };
    const result = try precompiles.identity.execute(
        allocator,
        input,
        100,
    );
    defer result.deinit(allocator);

    // Verify output equals input
    try std.testing.expectEqualSlices(u8, input, result.output);
}
```

### Empty Input Handling

```zig
const std = @import("std");
const precompiles = @import("precompiles");

test "identity empty input" {
    const allocator = std.testing.allocator;

    const result = try precompiles.identity.execute(
        allocator,
        &[_]u8{},
        15, // Only base cost needed
    );
    defer result.deinit(allocator);

    try std.testing.expectEqual(0, result.output.len);
    try std.testing.expectEqual(15, result.gas_used);
}
```

## Use Cases

### Smart Contract Data Passing

Identity is commonly used to:
- Pass data between contract calls
- Copy memory in assembly code
- Validate precompile infrastructure
- Benchmark gas costs

### Gas-Efficient Copying

For large data:
```zig
// Using identity precompile (cheaper)
const words = data.len / 32;
const gas_cost = 15 + 3 * words;

// vs manual MSTORE loop (more expensive)
const loop_gas = data.len * 6; // ~6 gas per byte
```

## Performance

**Native (ReleaseFast)**: ~10-50 GB/s (memcpy speed)
**WASM (ReleaseFast)**: ~2-10 GB/s

Optimized to use efficient memory copy operations.

## Testing

```bash
zig build test -Dtest-filter=identity
```

Test coverage includes:
- Empty input
- Various input sizes
- Data preservation
- Gas calculation accuracy
- Word boundary cases

## Related

- [Common](/zig/precompiles/common/) - Precompile types
- [SHA256](/zig/precompiles/sha256/) - SHA-256 hash (0x02)
- [RIPEMD160](/zig/precompiles/ripemd160/) - RIPEMD-160 hash (0x03)

## References

- [Yellow Paper](https://ethereum.github.io/yellowpaper/paper.pdf) - Appendix E
- [EVM Opcodes](https://www.evm.codes/) - Gas costs reference
